
function addAwwdaTable(id,row)
{
	resetErrorList();
	if(validateFormFields(paymentRegOTRPeriodYearJson))
	{
		if (validateFormFields(paymentRegOTRPeriodMonthJson,paymentRegOTRAwwdaDetailsJson))
		{
			hideTab('TabView',5);
			resetErrorList();
			incError=0;
			var checkDuplicateFlag=checkDuplicateForAwwda(row);
			if(checkDuplicateFlag==false)
			{
				return false;
			}
			if(removeCommaFrmInput(document.getElementById('in_awwdaTable_9').value)<=0)
			{
				alert(amtPayable);
				return false;
			}
			if(removeCommaFrmInput(document.getElementById('in_awwdaTable_9').value)<=0)
			{
				alert(amtPaid);
				return false;
			}
			if(addConfirm('a_awwdaTable')) 
			{
				if(document.getElementById('a_awwdaTable').innerHTML!="Modify")
				{
					addrow('awwdaTable', '7', '7', '4', 'validateDeleteRowAwwda', 'validateModifyRowIntoAwwdaFunction', 'N','N');
				}
				else
				{
					return true;
				}
			}
		}
		else
		{
			getErrTabToggle('TabView','2');	
			tabview_switch('TabView', '2');
			hideAndShowTable("errorDiv");
			document.getElementById('btnTbl').style.display="none";
			return false;
		}
	}
	else
	{
		getErrTabToggle('TabView','2');	
		tabview_switch('TabView', '2');
		hideAndShowTable("errorDiv");
		document.getElementById('btnTbl').style.display="none";
		return false;
	}
}

function beforeAddAwwda(row)
{

	var checkDuplicateFlag=checkDuplicateForAwwda(row);
	if(document.getElementById('hidIsPartial').value != "Y")
	{
		
	}
	if(checkDuplicateFlag==false)
	{
		return false;
	}
	else
	{
		TotalAmtToPaidAwwda=removeCommaFrmInput(document.getElementById('in_awwdaTable_9').value);
		document.getElementById('hidTotalAmtPaid').value = removeCommaFrmInput(document.getElementById('in_awwdaTable_9').value);
		return true;
	}
}

function afterAddAwwda()
{
	var tmpAmt=removeCommaFrmInput(document.getElementById('txtTotalAmountPayableOTR').value);
	var tmpAmtToPaid=removeCommaFrmInput(document.getElementById('txtTotalAmountPaidOTR').value);
	document.getElementById('txtTotalAmountPaidOTR').value=convertToKenyanShillingFormatVal(removeCommaFrmInput(parseInt(tmpAmtToPaid,10)+parseInt(TotalAmtToPaidAwwda,10)),true); 
	document.getElementById('txtTotalAmountPayableOTR').value=convertToKenyanShillingFormatVal(removeCommaFrmInput(parseInt(tmpAmt,10)+parseInt(document.getElementById('hidTotalAmtPaid').value,10)),true); 
	selectedFlagAwwda=selectedFlagAwwda+1;document.getElementById('cmbTaxPeriodMonth').selectedIndex=0;
	if(removeCommaFrmInput(document.getElementById('txtTotalAmountPayableOTR').value)<0)
	{
		document.getElementById('txtTotalAmountPaidOTR').value=0;
	}
	document.getElementById('in_awwdaTable_3').value=""; 
	document.getElementById('in_awwdaTable_4').value=""; 
	document.getElementById('in_awwdaTable_5').value=""; 
	document.getElementById('in_awwdaTable_6').value=""; 
	document.getElementById('in_awwdaTable_7').value=""; 
	document.getElementById('in_awwdaTable_8').value=""; 
	document.getElementById('in_awwdaTable_9').readOnly=false;document.getElementById('in_awwdaTable_9').className='form101_textfcurr form101_textfcurr_width textonlyRight';
	document.getElementById('cmbTaxPeriodYear').selectedIndex=0; 
	document.getElementById('cmbTaxPeriodMonth').disabled=true;
	/*if(document.getElementById('hidIsPartial').value == "Y" || document.getElementById('hidIsPartial').value == "y" )
	{
		document.getElementById('in_sugarTable_7').readOnly=true;
		document.getElementById('in_sugarTable_8').readOnly=true;
		document.getElementById('in_sugarTable_8').className='readonlyInput form101_textfcurr_width textonlyRight';
		document.getElementById('in_sugarTable_7').className='readonlyInput form101_textfcurr_width textonlyRight';
		document.getElementById('sugarRadio_'+rowNumbmerPartial).checked=false;
		selectedFlagPartial=selectedFlagPartial+1;
	}*/
}

function validateDeleteRowAwwda(tab_str, rowno, cols) 
{

	if(deleteFlagAwwda==1 && modifyFlagAwwda==0 )
	{
		var table = document.getElementById('awwdaTable');  
		var	totalAmt = removeCommaFrmInput(document.getElementById('txtTotalAmountPayableOTR').value);
		var tempAmt = table.rows[rowno].cells[9].innerHTML;
		totalAmt = totalAmt - parseInt(removeCommaFrmInput(tempAmt),"10");
		document.getElementById('txtTotalAmountPayableOTR').value =  totalAmt;
		document.getElementById('txtTotalAmountPayableOTR').value = convertToKenyanShillingFormatVal(document.getElementById("txtTotalAmountPayableOTR").value, true);
		var	totalAmt = removeCommaFrmInput(document.getElementById('txtTotalAmountPaidOTR').value);
		var tempAmt = table.rows[rowno].cells[9].innerHTML;
		totalAmt = totalAmt - parseInt(removeCommaFrmInput(tempAmt),"10");
		document.getElementById('txtTotalAmountPaidOTR').value = convertToKenyanShillingFormatVal(totalAmt, true);
		if(removeCommaFrmInput(document.getElementById('txtTotalAmountPayableOTR').value)<0)
		{
			document.getElementById('txtTotalAmountPaidOTR').value=0;
		}
		selectedFlagAwwda=selectedFlagAwwda-1;
		deleteFlagAwwda = 0;
		if(document.getElementById('hidIsPartial').value == "Y" || document.getElementById('hidIsPartial').value == "y" )
		{
			selectedFlagPartial=selectedFlagPartial-1;
		}
		currentPaymentAwwda();
	}
	else
	{
		deleteFlagAwwda = 0;
	}
}

function validateModifyRowIntoAwwdaFunction(tab_str, cols_1, rowno, cols_2)
{
	modifyFlagAwwda = 1;
	commonModifyFlag=1;
	tempAmtVal = document.getElementById('in_awwdaTable_9').value;
	TotalAmtToPaidAwwda=document.getElementById('in_awwdaTable_9').value;
	var year =parseInt(document.getElementById('in_awwdaTable_4').value.substr(6, document.getElementById('in_awwdaTable_4').value.length),10);
	document.getElementById('cmbTaxPeriodYear').value=year;
	getSelectedMonthOfSelectedYearWeb('cmbTaxPeriodYear','cmbTaxPeriodMonth','false');
	var taxPeriodFrom = document.getElementById('in_awwdaTable_4').value;
	var taxPeriodTo = document.getElementById('in_awwdaTable_5').value;
	document.getElementById('cmbTaxPeriodMonth').value=taxPeriodFrom+"-"+taxPeriodTo;
	document.getElementById('cmbTaxPeriodMonth').disabled=false;

}

function checkDuplicateForAwwda(r,id)
{
	rows=r;
	tabObj1=document.getElementById('awwdaTable');
	var taxPeriodValue;
	var taxPeriod = document.getElementById('cmbTaxPeriodMonth').selectedIndex;
	var taxPeriodMonth =document.getElementById('cmbTaxPeriodMonth')[taxPeriod].text;
	var taxPeriod = document.getElementById('cmbTaxPeriodYear').selectedIndex;
	var taxPeriodYear =document.getElementById('cmbTaxPeriodYear')[taxPeriod].text;
	taxPeriodValue=trim(taxPeriodMonth)+'-'+trim(taxPeriodYear);
	var trInvoiceNo=document.getElementById('in_awwdaTable_7').value;
	if(tabObj1.rows.length==1)
	{
	}
	else
	{

		for (var i=1, n=tabObj1.rows.length; i <n; i++) 
		{  
			if(modifyFlagAwwda==1)
			{
				var modify;
				if(document.all)
				{
					modify=trim(tabObj1.rows[i].cells[2].innerText);
				}
				else
				{
					modify=trim(tabObj1.rows[i].cells[2].textContent,"");
				}
				if((trim(document.getElementById('id_temp_awwdaTable_'+i+'_1').value))=="Delete"  && (trim(tabObj1.rows[i].cells[7].innerHTML)==trInvoiceNo) && (trim(modify)==trim("Modify")))
				{
					alert(alreadyAddedDetials);
					return false;
				}
			}
			else
			{
				if((document.getElementById('id_temp_awwdaTable_'+i+'_1').value)=="Delete" &&  (trim(tabObj1.rows[i].cells[7].innerHTML)==trInvoiceNo))
				{
					alert(alreadyAddedDetials);
					return false;
				}
			}
		}
	}
	return true;

}


function showAwwdaPartialTable(partialDetailArray){
	if(partialDetailArray.length>=1){
		var cntr = 0;
		var tabObj = document.getElementById("in_SplObligHdrTbl_8");
		for(var l = tabObj.rows.length; l >1 ;l--){
			tabObj.deleteRow(l -1);
		}	
		for(var i=0;i<partialDetailArray.length;i++){
			cntr = parseInt(cntr);
			var tabRow = tabObj.insertRow(tabObj.rows.length);
			tabRow.id="awwdaHdrRow_"+cntr;
			var tabCell = new Array();
			for (var j=0;j<12;j++){
				tabCell[j] = tabRow.insertCell(j);
			}
			var pmtSplDetailVO = partialDetailArray[i];
			/*if(document.all)
			{
				var element = document.createElement("<input type = 'radio' onclick = 'onSelectStdHdrRadio(this);'>");
				element.setAttribute("name", "stdRadio");
				element.setAttribute("id", "stdRadio_"+cntr);
				element.setAttribute("value", cntr);					            
				tabCell[0].appendChild(element);

			}
			else{
				var element = document.createElement('input');       
				element.setAttribute('type', 'radio');     
				element.setAttribute('name', 'stdRadio');
				element.setAttribute('id', 'stdRadio_'+cntr);
				element.setAttribute('value', cntr);     
				element.setAttribute("onclick","javascript:onSelectStdHdrRadio(this);");
				tabCell[0].appendChild(element);
			}*/
			
			var element = document.createElement('input');       
			element.type ='radio';
			element.onclick = function () {onSelectAwwdaRadio(this);};
			element.value = cntr;
			element.id = 'awwdaRadio_'+cntr;
			element.name = "awwdaRadio";
			element.className='bordercl';
			tabCell[0].appendChild(element); 

			/*	tabCell[0].innerHTML = cntr+1;
			tabCell[0].style.textAlign="center";
			tabCell[0].style.fontSize="11";*/

			tabCell[1].innerHTML = pmtSplDetailVO.taxPeriod;
			tabCell[1].style.textAlign="center";
			tabCell[1].style.fontSize="11";

			tabCell[2].innerHTML = pmtSplDetailVO.accountNo;
			tabCell[2].style.textAlign="center";
			tabCell[2].style.fontSize="11";

			/*tabCell[3].innerHTML =convertToKenyanShillingFormatValWithDecimal(Math.ceil(pmtSplDetailVO.exFactVal).toFixed(2),true);
			tabCell[3].style.textAlign="center";
			tabCell[3].style.fontSize="11";*/

			tabCell[3].innerHTML = pmtSplDetailVO.invoiceNo;
			tabCell[3].style.textAlign="right";
			tabCell[3].style.fontSize="11";

			tabCell[4].innerHTML = pmtSplDetailVO.trInvoiceNo;
			tabCell[4].style.textAlign="right";
			tabCell[4].style.fontSize="11";

			tabCell[5].innerHTML = pmtSplDetailVO.consumption;
			tabCell[5].style.textAlign="right";
			tabCell[5].style.fontSize="11";

			tabCell[6].innerHTML = convertToKenyanShillingFormatValWithDecimal(Math.ceil(pmtSplDetailVO.calculatedBill).toFixed(2),true);
			tabCell[6].style.textAlign="right";
			tabCell[6].style.fontSize="11";

			tabCell[7].innerHTML = convertToKenyanShillingFormatValWithDecimal(Math.ceil(pmtSplDetailVO.payableAmountAwwda).toFixed(2),true);
			tabCell[7].style.textAlign="right";
			tabCell[7].style.fontSize="11";
			
			tabCell[8].innerHTML = convertToKenyanShillingFormatValWithDecimal(Math.ceil(pmtSplDetailVO.amountPaidAwwda).toFixed(2),true);
			tabCell[8].style.textAlign="right";
			tabCell[8].style.fontSize="11";
			
			tabCell[9].innerHTML = convertToKenyanShillingFormatValWithDecimal(Math.ceil(pmtSplDetailVO.payableAmountAwwda).toFixed(2),true);
			tabCell[9].style.textAlign="right";
			tabCell[9].style.fontSize="11";

			/*var element = document.createElement('input');
			element.type = 'hidden';
			element.value =  pmtSplDetailVO.obilgationHdrId;
			element.width = "0%";
			tabCell[8].appendChild(element);
			tabCell[8].style.display = "none";

			var element = document.createElement('input');
			element.type = 'hidden';
			element.value =  pmtSplDetailVO.obilgationDtlId;
			element.width = "0%";
			tabCell[9].appendChild(element);
			tabCell[9].style.display = "none";
			 */
			var element = document.createElement('input');
			element.type = 'hidden';
			element.value =  pmtSplDetailVO.adjustedType;
			element.width = "0%";
			tabCell[10].appendChild(element);
			tabCell[10].style.display = "none";

			var element = document.createElement('input');
			element.type = 'hidden';
			element.value = convertToKenyanShillingFormatValWithDecimal(Math.ceil(pmtSplDetailVO.adjustedValue).toFixed(2),true);
			element.width = "0%";
			tabCell[11].appendChild(element);
			tabCell[11].style.display = "none";
			
			cntr = cntr+1;
		}
		document.getElementById("navigationTableSplHdr").style.display = '';
		document.getElementById("navigationTableSpltbl").style.display = '';
		document.getElementById("in_SplObligHdrTbl_8").style.display = "";
	}
}

function onSelectAwwdaRadio(obj)
{
	rowNumbmerPartial=obj.value;
	document.getElementById('AwwdaFieldset').style.display = '';
	if(selectedFlagAwwda>0 && document.getElementById('hidIsPartial').value != "Y")
	{
		alert(cntAddPrevLiab);
		document.getElementById('awwdaRadio_'+rowNumbmerPartial).checked=false;
	}
	else
	{
		var taxPayerId=document.getElementById('hidTaxPayerId').value;
		document.getElementById('hidIsPartial').value = "Y";
		var rowNum = obj.value;
		objValue=obj.value;
		var rowRef = document.getElementById("awwdaHdrRow_" + rowNum);
		
        var dateArr;
		if(document.all)
		{
			billPeriodAwwda = rowRef.getElementsByTagName("TD")[1].innerText;
			dateArr = billPeriodAwwda.split("-");
			fromDt = dateArr[0];
			toDt = dateArr[1];
			accountNoAwwda=rowRef.getElementsByTagName("TD")[2].innerText;
			invoiceNoAwwda=rowRef.getElementsByTagName("TD")[3].innerText;
			trInvoiceNoAwwda = rowRef.getElementsByTagName("TD")[4].innerText;
			payableAmountAwwda = rowRef.getElementsByTagName("TD")[7].innerText;
			amountAwwdaPaid = rowRef.getElementsByTagName("TD")[8].innerText;
			adjustmentType = (rowRef.getElementsByTagName("INPUT")[1].value);
			adjustmentValue = (rowRef.getElementsByTagName("INPUT")[2].value);
		}
		else
		{
			billPeriodAwwda = rowRef.getElementsByTagName("TD")[1].innerText;
			dateArr = billPeriodAwwda.split("-");
			fromDt = dateArr[0];
			toDt = dateArr[1];
			accountNoAwwda=rowRef.getElementsByTagName("TD")[2].innerText;
			invoiceNoAwwda=rowRef.getElementsByTagName("TD")[3].innerText;
			trInvoiceNoAwwda = rowRef.getElementsByTagName("TD")[4].innerText;
			payableAmountAwwda = rowRef.getElementsByTagName("TD")[7].innerText;
			amountAwwdaPaid = rowRef.getElementsByTagName("TD")[8].innerText;
			adjustmentType = (rowRef.getElementsByTagName("INPUT")[1].value);
			adjustmentValue = (rowRef.getElementsByTagName("INPUT")[2].value);
		}
		
		startIndexStr="";
		var parentId=null;
		//show partial
		document.getElementById('awwdaDiv').style.display="";


		var year  = fromDt.substring(6);
		document.getElementById("cmbTaxPeriodYear").value = year;
		getSelectedMonthOfSelectedYearWeb('cmbTaxPeriodYear','cmbTaxPeriodMonth','false');
		document.getElementById('hidObligationFromDate').value=fromDt;
		document.getElementById('hidObligationToDate').value=toDt;
		document.getElementById("cmbTaxPeriodMonth").value =fromDt+"-"+toDt;
		
		document.getElementById('in_awwdaTable_3').value = accountNoAwwda;
		document.getElementById('in_awwdaTable_4').value = fromDt;
		document.getElementById('in_awwdaTable_5').value = toDt;
		document.getElementById('in_awwdaTable_6').value = invoiceNoAwwda;
		document.getElementById('in_awwdaTable_7').value = trInvoiceNoAwwda;
		document.getElementById('in_awwdaTable_8').value = payableAmountAwwda;
		document.getElementById('in_awwdaTable_9').value = payableAmountAwwda;
		document.getElementById('in_awwdaTable_10').value = adjustmentType;
		document.getElementById('in_awwdaTable_11').value = adjustmentValue;

	}
}

function currentPaymentAwwda()
{
	if((selectedFlagPartial==0))
	{
		for(var i=4; i<7;i++)
		{
			document.getElementById('in_awwdaTable_'+i).readOnly=false;
			if(document.getElementById('in_awwdaTable_'+i).className=='readonlyInput form101_textfcurr_width textonlyRight' || document.getElementById('in_sugarTable_'+i).className=='form101_textfcurr form101_textfcurr_width textonlyRight')
			{
				document.getElementById('in_awwdaTable_'+i).className='form101_textfcurr form101_textfcurr_width textonlyRight';
			}
			else
			{
				document.getElementById('in_awwdaTable_'+i).className='form101_textfcurr form101_textfcurr_width';
			}
		}
		document.getElementById('cmbTaxPeriodYear').disabled=false;
		//document.getElementById('cmbTaxPeriodMonth').disabled=false;
		document.getElementById('in_awwdaTable_9').readOnly=false;
		document.getElementById('in_awwdaTable_9').className='form101_textfcurr form101_textfcurr_width textonlyRight';
		document.getElementById('in_awwdaTable_5').readOnly=true;
		document.getElementById('in_awwdaTable_5').className='readonlyInput form101_textfcurr_width textonlyRight';
		document.getElementById('hidIsPartial').value = "N";
		clear_Page_data('awwdaTable','7');
		document.getElementById('cmbTaxPeriodYear').selectedIndex=0;
		document.getElementById('cmbTaxPeriodMonth').selectedIndex=0;
		document.getElementById('in_awwdaTable_7').value=0;
		document.getElementById('in_awwdaTable_8').value=0;
		document.getElementById('in_awwdaTable_9').value=0;
		document.getElementById('in_awwdaTable_9').value=0;
		document.getElementById('in_awwdaTable_10').value=0;
		document.getElementById('in_awwdaTable_11').value=0;
	}
}

function confirmForPartialAwwda()
{
	if(document.getElementById('hidIsPartial').value == "Y" || document.getElementById('hidIsPartial').value == "y" )
	{
		if(selectedFlagPartial==0)
		{
			/*commented to remove confirmation popup*/
			/*if (confirm(previousLiabilityAddingAlert))
			{*/
				return addAwwdaTable();
			/*}*/
		}
		else
		{
			return addAwwdaTable();
		}
	}
	else
	{
		return addAwwdaTable();
	}
}

function beforeDeleteAwwda()
{
	if(modifyFlagAwwda==1)
	{
		alert(confirmModifyingOperation);
		return false;
	}
}
function afterDeleteAwwdaFunction()
{
	deleteFlagAwwda = 1;

}

function beforeModifyIntoAwwdaFunction(row)
{
	/*if(addAwwdaTable())
	{
		var checkDuplicateFlag = addAwwdaTable(row);
		if(checkDuplicateFlag==false)
		{
			return false;
		}
		else
		{*/
			totalAmt=removeCommaFrmInput(document.getElementById('txtTotalAmountPayableOTR').value);
			amtToPaidAwwda=removeCommaFrmInput(document.getElementById("txtTotalAmountPaidOTR").value);
			return true;
		/*}
	}
	else
	{
		return false;
	}*/
}
function afterModifyIntoAwwdaFunction()
{
	modifyFlagAwwda = 0;
	commonModifyFlag=0;
	var table = document.getElementById('awwdaTable');  
	totalAmt = parseInt(removeCommaFrmInput(totalAmt),10) + parseInt(removeCommaFrmInput(table.rows[rowno].cells[9].innerHTML),10) - parseInt(removeCommaFrmInput(tempAmtVal),10);
	amtToPaidAwwda = parseInt(removeCommaFrmInput(amtToPaidAwwda),10) + parseInt(removeCommaFrmInput(table.rows[rowno].cells[9].innerHTML),10) - parseInt(removeCommaFrmInput(TotalAmtToPaidAwwda),10);
	document.getElementById('txtTotalAmountPayableOTR').value = convertToKenyanShillingFormatVal(totalAmt, true);
	document.getElementById('txtTotalAmountPaidOTR').value=convertToKenyanShillingFormatVal(amtToPaidAwwda, true);
	/*document.getElementById('cmbTaxPeriodMonth').selectedIndex=0;
	document.getElementById('cmbTaxPeriodYear').selectedIndex=0; 
	document.getElementById('cmbTaxPeriodMonth').disabled=true;*/
	/*if(document.getElementById('hidIsPartial').value == "Y" || document.getElementById('hidIsPartial').value == "y" )
		{
		document.getElementById('in_sugarTable_7').readOnly=true;
		document.getElementById('in_sugarTable_8').readOnly=true;
		document.getElementById('in_sugarTable_8').className='readonlyInput form101_textfcurr_width textonlyRight';
		document.getElementById('in_sugarTable_7').className='readonlyInput form101_textfcurr_width textonlyRight';
		}*/
}

function clearAwwda()
{
	if(clear_table('awwdaTable','7'))
	{
		document.getElementById('in_awwdaTable_3').value="";
		document.getElementById('in_awwdaTable_4').value="";
		document.getElementById('in_awwdaTable_5').value="";
		document.getElementById('in_awwdaTable_6').value="";
		document.getElementById('in_awwdaTable_7').value="";
		document.getElementById('in_awwdaTable_8').value="";
		document.getElementById('in_awwdaTable_9').value="";
		modifyFlagAwwda=0;
		commonModifyFlag=0;
		document.getElementById('cmbTaxPeriodMonth').selectedIndex=0;		
		document.getElementById('cmbTaxPeriodYear').selectedIndex=0; 
		document.getElementById('cmbTaxPeriodMonth').disabled=true;
		/*if(document.getElementById('hidIsPartial').value == "Y" || document.getElementById('hidIsPartial').value == "y" )
		{
			document.getElementById('awwdaRadio_'+rowNumbmerPartial).checked=false;
			document.getElementById('in_awwdaTable_7').readOnly=true;
			document.getElementById('in_awwdaTable_8').readOnly=true;
			document.getElementById('in_awwdaTable_8').className='readonlyInput form101_textfcurr_width textonlyRight';
			document.getElementById('in_awwdaTable_7').className='readonlyInput form101_textfcurr_width textonlyRight';
		}*/
		if(selectedFlagPartial==0)
		{
			document.getElementById('hidIsPartial').value = "N";
		}
		currentPaymentAwwda();
	}
}
function validateAmtPayable(obj){
	var amtPayable=parseInt(removeCommaFrmInput(obj.value),10);
	var valuePayable=parseInt(removeCommaFrmInput(document.getElementById('in_awwdaTable_8').value,10));
	if (amtPayable>valuePayable){
		alert("Please enter an amount less than or equal to the value payable")
		document.getElementById('in_awwdaTable_9').value=document.getElementById('in_awwdaTable_8').value;
		return false;
	}
	
}
