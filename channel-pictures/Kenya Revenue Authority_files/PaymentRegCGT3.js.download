var cgtPartnershipJson={"field":[
                         {"name":"in_cgt1PPartnershipDtlsAddrowTable_3","rule":[{"required":"y","dispName":"PIN of the Partner ","type":"isValAlphaNumericWithoutSpace","minLength":"11","maxLength":"11"}]},
                         {"name":"in_cgt1PPartnershipDtlsAddrowTable_4","rule":[{"required":"y","dispName":"Partner Name ","type":"bussnamewithspecialchrs","minLength":"1","maxLength":"50"}]},
                         {"name":"in_cgt1PPartnershipDtlsAddrowTable_7","rule":[{"required":"y","dispName":"Profit/Loss Sharing Ratio "}]}
                         ]};

var cgtTransfereeDtlsJson={"field":[
                                 {"name":"in_cgtTransfereeAddrowTable_3","rule":[{"required":"y","dispName":"PIN of the Transferee ","type":"isValAlphaNumericWithoutSpace","minLength":"11","maxLength":"11"}]},
                                 {"name":"in_cgtTransfereeAddrowTable_4","rule":[{"required":"y","dispName":"Transferee Name ","type":"bussnamewithspecialchrs","minLength":"1","maxLength":"50"}]},
                                 {"name":"in_cgtTransfereeAddrowTable_5","rule":[{"required":"y","dispName":"Transferee Address ","type":"alphanumericspecialcharacity"}]},
                                 {"name":"in_cgtTransfereeAddrowTable_6","rule":[{"required":"y","dispName":"Email Id","type":"email"}]}
                                 ]};



function addCgt3TransfereeData()
{
	var errorString="";
	var a=1;
	if(document.getElementById('in_cgt3TransfereeAddrowTable_3').value=='' || document.getElementById('in_cgt3TransfereeAddrowTable_3').value==null) {
		errorString=errorString+a+") Please enter PIN of the Transferee \n";
		a++;
	}
	if(document.getElementById('in_cgt3TransfereeAddrowTable_4').value=='' || document.getElementById('in_cgt3TransfereeAddrowTable_4').value==null) {
		errorString=errorString+a+") Please enter Transferee Name \n";
		a++;
	}
	if(document.getElementById('in_cgt3TransfereeAddrowTable_5').value=='' || document.getElementById('in_cgt3TransfereeAddrowTable_5').value==null) {
		errorString=errorString+a+") Please enter Transferee Address \n";
		a++;
	}
	if(document.getElementById('in_cgt3TransfereeAddrowTable_6').value=='' || document.getElementById('in_cgt3TransfereeAddrowTable_6').value==null) {
		errorString=errorString+a+") Please enter Email Id \n";
		a++;
	}
	if(errorString!=""){
		alert(errorString);
	}
	else{
		if(checkDuplicateTransfereeDataCGT3())
		{
			if(confirm("Do you want to add details?"))
			{
				addrow('cgt3TransfereeAddrowTable','4','5','3','','','N','N','','');
			}
		}
	}
}

function checkDuplicateTransfereeDataCGT3()
{
	var pinOfTransferor = document.getElementById('cgt3TransferorPin').value;
	var pinOfTransferee = document.getElementById('in_cgt3TransfereeAddrowTable_3').value;
//	if(pinOfTransferor==pinOfTransferee)
//	{
//		alert("Transferor and Transferee Pin can not be same.");
//		return false;
//	}
	var table = document.getElementById('cgt3TransfereeAddrowTable');
	var rowCount=table.rows.length;
	if(rowCount>5)
	{
		for(var i = 1, n = table.rows.length; i <n; i++) 
		{
			if(table.rows[i].cells[1].textContent!='deleted' || table.rows[i].cells[1].innerText!='deleted'){
				if (document.all) {// for IE
					alert('You can add only 5 Transferee Detail.');
					return false;
				}
				else{
					alert('You can add only 5 Transferee Detail.');
					return false;
				}
			}

		}
	}
	if(table.rows.length==1)
	{
	}
	else{
		for (var i = 1, n = table.rows.length; i <n; i++) 
		{ 
			modify=trim(table.rows[i].cells[2].getElementsByTagName('A')[0].innerHTML);
			if((trim(document.getElementById('id_temp_'+'cgt3TransfereeAddrowTable'+'_'+i+'_1').value))=="Delete" && (modify=="Modify") &&
				(table.rows[i].cells[3].innerHTML==pinOfTransferee))
				{
					alert("You already added this details.");
					return false;
				}
		}
	}
	return true;
}

function validateTransfereeData()
{
	if(!validateFormFields(cgtTransfereeDtlsJson))
	{
		getErrTabToggle('TabView','2');	
		tabview_switch('TabView', '2');
		hideAndShowTable("errorDiv");
		document.getElementById('btnTbl').style.display="none";
		return false;
	}
	checkDuplicateTransfereeData();
}

function onchangeCgt3TranfereePinNumber(obj) {
	var pin = trim(obj.value);
//	if (validatePIN(obj,"")) {
		FetchTaxpayerDetailWithoutValidationSplObl.fetchTaxpayerDetailWithoutValidationSplObl(
				pin,
				function(data) {
					if (data != NULL && data != null) {
						if (data.isDataAvailable == N_FLAG) {
							if (data.isAgent == ERROR
									|| data.isAgent == NO_CALL_MADE) 
							{ 
								alert(errFetchingData);
								document.getElementById('in_cgt3TransfereeAddrowTable_3').focus();
							}
							else if (data.isAgent == NO_DETAILS_FOUND)
							{
								alert(invalidPin);
								
							}
							resetCgt3TransfereePrimaryDetail();
							return false;
						}
						if (data.taxPayerFirstName != null
								|| data.taxPayerId != null) {
							if (data.taxPayerId != null
									|| data.taxPayerId != "") {
								document
								.getElementById('in_cgt3TransfereeAddrowTable_7').value = data.taxPayerId;
							}
							if (data.taxPayerFirstName != null
									|| data.taxPayerFirstName != "") {
								document
								.getElementById('in_cgt3TransfereeAddrowTable_4').value = data.taxPayerFirstName;
							}
							if (data.mobileNumber != null
									|| data.mobileNumber != "") {
								document
								.getElementById('in_cgt3TransfereeAddrowTable_6').value = data.emailId;
							}
							if (data.taxPayerFullAddr != null
									|| data.taxPayerFullAddr != "") {
								dwr.util.setValue(
										'in_cgt3TransfereeAddrowTable_5', data.taxPayerFullAddr);
							}
						}
					} else {
						alert(errFetchingData);
						resetCgt3TransfereePrimaryDetail();
						return false;
					}
				});
		return true;
//	} else {
//		resetCgt3TransfereePrimaryDetail();
//		return false;
//	}
}

function resetCgt3TransfereePrimaryDetail()
{
	document.getElementById('in_cgt3TransfereeAddrowTable_3').value = '';
	document.getElementById('in_cgt3TransfereeAddrowTable_4').value = '';
	document.getElementById('in_cgt3TransfereeAddrowTable_5').value = '';
	document.getElementById('in_cgt3TransfereeAddrowTable_6').value = '';
	document.getElementById('in_cgt3TransfereeAddrowTable_7').value = '';
	document.getElementById('in_cgt3TransfereeAddrowTable_3').focus();
}


function onChangeCgtYearOfPurchase(obj)
{
	obj.value=removeCommaFrmInput(obj.value);
	if(!onlyNumeric(obj))
	{
		alert("Please enter valid Year of Purchase");
		obj.value='';
		return false;
	}
	
	var year = parseInt(obj.value);
	var length = year.toString().length;
	if(length<4){
		alert('Year of purchase should be upto 4 digits.');
		obj.value ='';
		return false;
	}
	else{
		var time = new Date();
		//var arr = time.split("/");
		var curYear = time.getFullYear();
		if(year>curYear)
		{
			alert("Please enter upto Current Year.");
			obj.value ='';
			return false;
		}
	/*	if(2015>year)
		{
			alert("Please enter valid Year of Purchase.");
			obj.value ='';
			return false;
		}*/
	}
	
	return true;
}
function onChangeCheckValueCGT3(obj){
	obj.value=removeCommaFrmInput(obj.value);
	if(!onlyNumeric(obj))
	{
		alert("Please enter numeric value for this field.");
		document.getElementById(obj.id).value=parseInt("0");
		return false;
	}

	var value= obj.value;
	value = parseInt(value,10);
	if(value<=0 || value==null)
	{
		alert("Please enter valid Number for this field.");
		obj.value='';
		document.getElementById(obj.id).value=parseInt("0");
		return false;
	}
	document.getElementById(obj.id).value=convertToKenyanShillingFormatVal(value,true);
	return true;
}

function isLr3NoValid()
{
	var proceed = true;
	var transferorId = document.getElementById("cgt3TransferorTaxPayerId").value;
	var lrNo = document.getElementById("cgt3LrNo").value;
	ValidateLrNoForCGT3.validateLrNoForCGT3(transferorId,lrNo,{async:false,callback: 	
			function(data){if (data != NULL && data != null) {
					if (data.errorMsg != null && data.errorMsg != '') {
						alert(data.errorMsg);
						proceed= false;
					}
				} else {
					alert(errFetchingData);
					proceed= false;
				}
	}});
	return proceed;
}

function validateExemption()
{
	// added for ticket 66829 by k00014045 :: Start 
	var taxpayerType=document.getElementById("hidTaxpayerType").value;
	
	
	if(taxpayerType == "NONINDI" && 
			(document.getElementById("cgtExemptTransaction").value == "CGT3ET17" ||
					document.getElementById("cgtExemptTransaction").value == "CGT3ET3" ||
					document.getElementById("cgtExemptTransaction").value == "CGT3ET4" ||
					document.getElementById("cgtExemptTransaction").value == "CGT3ET8" ||
					document.getElementById("cgtExemptTransaction").value == "CGT3ET15" ||
					document.getElementById("cgtExemptTransaction").value == "CGT3ET16" ||
					document.getElementById("cgtExemptTransaction").value == "CGT3ET18" ||
					document.getElementById("cgtExemptTransaction").value == "CGT3ET19" ||
					document.getElementById("cgtExemptTransaction").value == "CGT3ET22") )
		{
		alert("This transaction is only applicable to individuals");
		document.getElementById("cgtExemptTransaction").value = "-1";
		}
	
	
	// added for ticket 66829 by k00014045 :: End 
	
	if (document.getElementById("cgtExemptTransaction").value == "CGT3ET8")
		{ 
		var amount = removeCommaFrmInput(document.getElementById("cgt3ValOfTransfer").value);
		 amount = parseInt(amount) ;
		if (amount >= 3000000)
			{
		alert ("Please enter 'Transfer Value' less than 3 million Ksh.");
		document.getElementById("cgt3ValOfTransfer").value = "0";
		return false;
	}
		}
	return true;
}
function fetchCGT3TaskStatus(){
	if(document.getElementById("cgtAcknowledgementNo").value!=null && document.getElementById("cgtAcknowledgementNo").value!="" ){
		var proceed=true;
		var paramArray = new Array();
		var ackNo=document.getElementById("cgtAcknowledgementNo").value;
		var taxpayerId=document.getElementById("hidTaxPayerId").value;
		FetchCGT3TaskStatus.fetchCGT3TaskStatus(ackNo,taxpayerId,{async:false,callback: 	
			function(data){if (data != NULL && data != null) {
					if (data.errorMsg != null && data.errorMsg != '') {
						alert(data.errorMsg);
						document.getElementById("cgtAcknowledgementNo").value="";
						proceed=false;
					}
					else if (data.isActive!=null && data.isActive!=""){
						document.getElementById("cgtAcknowledgementNo").value="";
						alert("Amendment cannot be done as Approval Process for the Payment has not been completed");
						proceed=false;
					}
				} else {
					document.getElementById("cgtAcknowledgementNo").value="";
					alert(errFetchingData);
					proceed=false;
				}
	}});
		return proceed;
	}
}