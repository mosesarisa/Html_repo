var cgtPartnershipJson={"field":[
                         {"name":"in_cgt1PPartnershipDtlsAddrowTable_3","rule":[{"required":"y","dispName":"PIN of the Partner ","type":"isValAlphaNumericWithoutSpace","minLength":"11","maxLength":"11"}]},
                         {"name":"in_cgt1PPartnershipDtlsAddrowTable_4","rule":[{"required":"y","dispName":"Partner Name ","type":"bussnamewithspecialchrs","minLength":"1","maxLength":"50"}]},
                                 {"name":"in_cgt1PPartnershipDtlsAddrowTable_7","rule":[{"required":"y","dispName":"Profit/Loss Sharing Ratio "}]}
                         ]};

var cgtTransfereeDtlsJson={"field":[
                                 {"name":"in_cgtTransfereeAddrowTable_3","rule":[{"required":"y","dispName":"PIN of the Transferee ","type":"isValAlphaNumericWithoutSpace","minLength":"11","maxLength":"11"}]},
                                 {"name":"in_cgtTransfereeAddrowTable_4","rule":[{"required":"y","dispName":"Transferee Name ","type":"bussnamewithspecialchrs","minLength":"1","maxLength":"50"}]},
                                 {"name":"in_cgtTransfereeAddrowTable_5","rule":[{"required":"y","dispName":"Transferee Address ","type":"alphanumericspecialcharacity"}]},
                                 {"name":"in_cgtTransfereeAddrowTable_6","rule":[{"required":"y","dispName":"Email Id","type":"email"}]}
                                 ]};



function addrowPartnershipDtls()
{
	var errorString="";
	var i=1;
	if(document.getElementById('in_cgt1PPartnershipDtlsAddrowTable_3').value==""){
		errorString=errorString+i+") Please enter PIN of the Partner \n";
		i++;
	}
	if(document.getElementById('in_cgt1PPartnershipDtlsAddrowTable_4').value==""){
		errorString=errorString+i+") Please enter Partner Name \n";
		i++;
	}
	if(document.getElementById('in_cgt1PPartnershipDtlsAddrowTable_7').value==""){
		errorString=errorString+i+") Please enter Profit/Loss Sharing Ratio \n";
		i++;
	}
	if(errorString!=""){
		alert(errorString);
	}
	else{
		if(checkDuplicatePartnershipData())
		{
			var profiLossRationSumFlag = calcTotalProfitLossRatioCGT1();
			if(profiLossRationSumFlag==false)
			{
				return false;
			}
			if(removeCommaFrmInput(document.getElementById('in_cgt1PPartnershipDtlsAddrowTable_7').value)>0  &&  removeCommaFrmInput(document.getElementById('in_cgt1PPartnershipDtlsAddrowTable_7').value)>0 )
			{

				if(addConfirm('a_cgt1PPartnershipDtlsAddrowTable'))
				{
					if(document.getElementById('a_cgt1PPartnershipDtlsAddrowTable').innerHTML!="Modify")
					{
						addrow('cgt1PPartnershipDtlsAddrowTable','5','6','5','','','N','N','','');
					}
					else
					{
						return true;
					}
				}
				else{
					isFalse=1;
				}
			}
			/*if(confirm("Do you want to add details?"))
			{
				addrow('cgt1PPartnershipDtlsAddrowTable','3','4','3','','','N','N','','');
			}*/
		}
	}
	/*if(checkDuplicatePartnershipData())
	{
		if(confirm("Do you want to add details?"))
		{
			addrow('cgt1PPartnershipDtlsAddrowTable','3','4','3','','','N','N','','');
			//addrow('cgt1PPartnershipDtlsAddrowTable','2','2','1','','','N','N','','');
		}
	}*/
}

function checkDuplicatePartnershipData()
{
	var pinOfPartner = document.getElementById('in_cgt1PPartnershipDtlsAddrowTable_3').value;
	var table = document.getElementById('cgt1PPartnershipDtlsAddrowTable');
	if(table.rows.length==1)
	{
	}
	else{
		for (var i = 1, n = table.rows.length; i <n; i++) 
		{ 
			modify=trim(table.rows[i].cells[2].getElementsByTagName('A')[0].innerHTML);
			if((trim(document.getElementById('id_temp_'+'cgt1PPartnershipDtlsAddrowTable'+'_'+i+'_1').value))=="Delete" && (modify=="Modify") &&
				(table.rows[i].cells[3].innerHTML==pinOfPartner))
				{
					alert("You already added this details.");
					return false;
				}
		}
	}
	return true;
}

function validatePartnershipData()
{
	if(!validateFormFields(cgtPartnershipJson))
	{
		getErrTabToggle('TabView','2');	
		tabview_switch('TabView', '2');
		hideAndShowTable("errorDiv");
		document.getElementById('btnTbl').style.display="none";
		return false;
	}
	checkDuplicatePartnershipData();
}

function addCgtTransfereeData()
{
	var errorString="";
	var a=1;
	if(document.getElementById('in_cgtTransfereeAddrowTable_3').value=='' || document.getElementById('in_cgtTransfereeAddrowTable_3').value==null) {
		errorString=errorString+a+") Please enter PIN of the Transferee \n";
		a++;
	}
	if(document.getElementById('in_cgtTransfereeAddrowTable_4').value=='' || document.getElementById('in_cgtTransfereeAddrowTable_4').value==null) {
		errorString=errorString+a+") Please enter Transferee Name \n";
		a++;
	}
	if(document.getElementById('in_cgtTransfereeAddrowTable_5').value=='' || document.getElementById('in_cgtTransfereeAddrowTable_5').value==null) {
		errorString=errorString+a+") Please enter Transferee Address \n";
		a++;
	}
	if(document.getElementById('in_cgtTransfereeAddrowTable_6').value=='' || document.getElementById('in_cgtTransfereeAddrowTable_6').value==null) {
		errorString=errorString+a+") Please enter Email Id \n";
		a++;
	}
	if(errorString!=""){
		alert(errorString);
	}
	else{
		if(checkDuplicateTransfereeData())
		{
			if(confirm("Do you want to add details?"))
			{
				addrow('cgtTransfereeAddrowTable','4','5','3','','','N','N','','');
			}
		}
	}
}

function checkDuplicateTransfereeData()
{
	var pinOfTransferor = document.getElementById('cgtTransferorPin').value;
	var pinOfTransferee = document.getElementById('in_cgtTransfereeAddrowTable_3').value;
//	if(pinOfTransferor==pinOfTransferee)
//	{
//	alert("Transferor and Transferee Pin can not be same.");
//	return false;
//	}
	var table = document.getElementById('cgtTransfereeAddrowTable');
	var rowCount=table.rows.length;
	/*if(rowCount>1)
	{
		for(var i = 1, n = table.rows.length; i <n; i++) 
		{
			if(table.rows[i].cells[1].textContent!='deleted' || table.rows[i].cells[1].innerText!='deleted'){
				if (document.all) {// for IE
					alert('You can add only 1 Transferee Detail.');
					return false;
				}
				else{
					alert('You can add only 1 Transferee Detail.');
					return false;
				}
			}

		}
	}
	if(table.rows.length==1)
	{
	}
	else{*/
		for (var i = 1, n = table.rows.length; i <n; i++) 
		{ 
			modify=trim(table.rows[i].cells[2].getElementsByTagName('A')[0].innerHTML);
			if((trim(document.getElementById('id_temp_'+'cgtTransfereeAddrowTable'+'_'+i+'_1').value))=="Delete" && (modify=="Modify") &&
				(table.rows[i].cells[3].innerHTML==pinOfTransferee))
				{
					alert("You already added this details.");
					return false;
				}
		}
	return true;
}

function validateTransfereeData()
{
	if(!validateFormFields(cgtTransfereeDtlsJson))
	{
		getErrTabToggle('TabView','2');	
		tabview_switch('TabView', '2');
		hideAndShowTable("errorDiv");
		document.getElementById('btnTbl').style.display="none";
		return false;
	}
	checkDuplicateTransfereeData();
}

function addIncidentalCostOnTransferData()
{	
	var tabObj1 = document.getElementById("cgtIncidentalCostOnTransferAddrowTable");
	//var totalRows = tabObj1.rows.length;
	var count=0;

	for (var i = 1, n = tabObj1.rows.length; i <n; i++) 
	{ 
		var modify;
		modify=trim(tabObj1.rows[i].cells[2].innerText);
		if((trim(document.getElementById('id_temp_'+'cgtIncidentalCostOnTransferAddrowTable'+'_'+i+'_1').value))=="Delete" && (modify=="Modify")) {
			count++;
		}
	}
	if(count==5) {
		alert("You cannot add more than 5 rows.");
		return false;
	}
	else{
		var errorString="";
		var i=1;
		if(document.getElementById('in_cgtIncidentalCostOnTransferAddrowTable_3').value==""){
			errorString=errorString+i+") Please enter Description \n";
			i++;
		}
		if(document.getElementById('in_cgtIncidentalCostOnTransferAddrowTable_4').value==""){
			errorString=errorString+i+") Please enter Value \n";
			i++;
		}
		if(errorString!=""){
			alert(errorString);
		}
		else{
			if(removeCommaFrmInput(document.getElementById('in_cgtIncidentalCostOnTransferAddrowTable_4').value)>0  &&  removeCommaFrmInput(document.getElementById('in_cgtIncidentalCostOnTransferAddrowTable_4').value)>0 )
			{

				if(addConfirm('a_cgtIncidentalCostOnTransferAddrowTable'))
				{
					if(document.getElementById('a_cgtIncidentalCostOnTransferAddrowTable').innerHTML!="Modify")
					{
						 //Added By Himanshu to resolve issues of adding commas to field
						document.getElementById('in_cgtIncidentalCostOnTransferAddrowTable_4').value = convertToKenyanShillingFormatVal(document.getElementById('in_cgtIncidentalCostOnTransferAddrowTable_4').value, true);
						addrow('cgtIncidentalCostOnTransferAddrowTable','2','2','4','','','N','N','');
						calculateNetTransferVal();
						//calcTotalIncidentalCostSecB();
					}
					else
					{
						return true;
					}
				}
				else{
					isFalse=1;
				}
			}
		}
		/*if(validateIncidentalCostOnTransferData())
		{
			if(confirm("Do you want to add details?"))
			{
				addrow('cgtIncidentalCostOnTransferAddrowTable','2','2','4','','','N','N','');
			}

			calculateNetTransferVal();
		}*/
	}
	
}

function addIncidentalCostOnAcquisitionData()
{
	var tabObj1 = document.getElementById("cgtIncidentalCostOnAcquisitionAddrowTable");
	//var totalRows = tabObj1.rows.length;
	var count=0;

	for (var i = 1, n = tabObj1.rows.length; i <n; i++) 
	{ 
		var modify;
		modify=trim(tabObj1.rows[i].cells[2].innerText);
		if((trim(document.getElementById('id_temp_'+'cgtIncidentalCostOnAcquisitionAddrowTable'+'_'+i+'_1').value))=="Delete" && (modify=="Modify")) {
			count++;
		}
	}
	if(count==5) {
		alert("You cannot add more than 5 rows.");
		return false;
	}
	else{
		var errorString="";
		var i=1;
		if(document.getElementById('in_cgtIncidentalCostOnAcquisitionAddrowTable_3').value==""){
			errorString=errorString+i+") Please enter Description \n";
			i++;
		}
		if(document.getElementById('in_cgtIncidentalCostOnAcquisitionAddrowTable_4').value==""){
			errorString=errorString+i+") Please enter Value \n";
			i++;
		}
		if(errorString!=""){
			alert(errorString);
		}
		else{
			if(removeCommaFrmInput(document.getElementById('in_cgtIncidentalCostOnAcquisitionAddrowTable_4').value)>0  &&  removeCommaFrmInput(document.getElementById('in_cgtIncidentalCostOnAcquisitionAddrowTable_4').value)>0 )
			{

				if(addConfirm('a_cgtIncidentalCostOnAcquisitionAddrowTable'))
				{
					if(document.getElementById('a_cgtIncidentalCostOnAcquisitionAddrowTable').innerHTML!="Modify")
					{
						addrow('cgtIncidentalCostOnAcquisitionAddrowTable','2','2','4','','','N','N','');
						calcCgtTotalAmt();
						//calcTotalIncidentalCostSecB();
					}
					else
					{
						return true;
					}
				}
				else{
					isFalse=1;
				}
			}
		}
			/*if(validateIncidentalCostOnAcquisitionData())
			{
				if(confirm("Do you want to add details?"))
				{
					addrow('cgtIncidentalCostOnAcquisitionAddrowTable','2','2','4','','','N','N','');
				}
				calcCgtTotalAmt();
			}*/
	}
}

function onchangeCgt1PPartnerPinNumber(obj) {
	var pin = trim(obj.value);
	pin=pin.toUpperCase();
	obj.value=pin;
	
	if(pin==document.getElementById('txtPin').value) {
		alert('The Partner PIN and the Transferor PIN cannot be the same');
		obj.value='';
		return false;
	}
	if (validatePIN(pin)) {
		FetchTaxpayerDetailWithoutValidationSplObl.fetchTaxpayerDetailWithoutValidationSplObl(
				pin,
				function(data) {
					if (data != NULL && data != null) {
						if (data.isDataAvailable == N_FLAG) {
							if (data.isAgent == ERROR
									|| data.isAgent == NO_CALL_MADE) 
							{ 
								alert(errFetchingData);
							}
							else if (data.isAgent == NO_DETAILS_FOUND)
							{
								alert(invalidPin);
							}
							resetCgt1PPartnerDetail();
							return false;
						}
						if(data.isDataAvailable!=null && data.isDataAvailable=='IpageNotProcessed')
						{
							alert('The entered Partner Pin is not iPage processed.');
							resetCgt1PPartnerDetail();
							return false;
						}
						
						if (data.taxPayerFirstName != null
								|| data.taxPayerId != null) {
							if (data.taxPayerId != null
									|| data.taxPayerId != "") {
								document
								.getElementById('in_cgt1PPartnershipDtlsAddrowTable_8').value = data.taxPayerId;
							}
							if (data.taxPayerFirstName != null
									|| data.taxPayerFirstName != "") {
								document
								.getElementById('in_cgt1PPartnershipDtlsAddrowTable_4').value = data.taxPayerFirstName;
							}
							if (data.taxPayerFullAddr != null
									|| data.taxPayerFullAddr != "") {
								document
								.getElementById('in_cgt1PPartnershipDtlsAddrowTable_5').value = data.taxPayerFullAddr;
							}
							if (data.emailId != null
									|| data.emailId != "") {
								document
								.getElementById('in_cgt1PPartnershipDtlsAddrowTable_6').value = data.emailId;
							}
						}
					} else {
						alert(errFetchingData);
						resetCgt1PPartnerDetail();
						return false;
					}
				});
		return true;
	} else {
		resetCgt1PPartnerDetail();
		return false;
	}
}


function onchangeCgt1TranfereePinNumber(obj) {
	var pin = trim(obj.value);
	if (validatePIN(pin)) {
		FetchTaxpayerDetailWithoutValidationSplObl.fetchTaxpayerDetailWithoutValidationSplObl(
				pin,
				function(data) {
					if (data != NULL && data != null) {
						if (data.isDataAvailable == N_FLAG) {
							if (data.isAgent == ERROR
									|| data.isAgent == NO_CALL_MADE) 
							{ 
								alert(errFetchingData);
							}
							else if (data.isAgent == NO_DETAILS_FOUND)
							{
								alert(invalidPin);
							}
							resetCgt1TransfereePrimaryDetail();
							return false;
						}
						if (data.taxPayerFirstName != null
								|| data.taxPayerId != null) {
							if (data.taxPayerId != null
									|| data.taxPayerId != "") {
								document
								.getElementById('in_cgtTransfereeAddrowTable_7').value = data.taxPayerId;
							}
							if (data.taxPayerFirstName != null
									|| data.taxPayerFirstName != "") {
								document
								.getElementById('in_cgtTransfereeAddrowTable_4').value = data.taxPayerFirstName;
							}
							if (data.mobileNumber != null
									|| data.mobileNumber != "") {
								document
								.getElementById('in_cgtTransfereeAddrowTable_6').value = data.emailId;
							}
							if (data.taxPayerFullAddr != null
									|| data.taxPayerFullAddr != "") {
								dwr.util.setValue(
										'in_cgtTransfereeAddrowTable_5', data.taxPayerFullAddr);
							}
						}
					} else {
						alert(errFetchingData);
						resetCgt1TransfereePrimaryDetail();
						return false;
					}
				});
		return true;
	} else {
		resetCgt1TransfereePrimaryDetail();
		return false;
	}
}

function resetCgt1PPartnerDetail()
{
	document.getElementById('in_cgt1PPartnershipDtlsAddrowTable_3').value = '';
	document.getElementById('in_cgt1PPartnershipDtlsAddrowTable_4').value = '';
	document.getElementById('in_cgt1PPartnershipDtlsAddrowTable_7').value = '';
	document.getElementById('in_cgt1PPartnershipDtlsAddrowTable_5').value = '';
	document.getElementById('in_cgt1PPartnershipDtlsAddrowTable_8').value = '';
	document.getElementById('in_cgt1PPartnershipDtlsAddrowTable_6').value = '';
	document.getElementById('in_cgt1PPartnershipDtlsAddrowTable_3').focus();
}

function resetCgt1TransfereePrimaryDetail()
{
	document.getElementById('in_cgtTransfereeAddrowTable_3').value = '';
	document.getElementById('in_cgtTransfereeAddrowTable_4').value = '';
	document.getElementById('in_cgtTransfereeAddrowTable_5').value = '';
	document.getElementById('in_cgtTransfereeAddrowTable_6').value = '';
	document.getElementById('in_cgtTransfereeAddrowTable_7').value = '';
	document.getElementById('in_cgtTransfereeAddrowTable_3').focus();
}

function calculateNetTransferVal()
{
	var cgtType=document.getElementById('cmbCGTType').value;
	var amt = parseInt(removeCommaFrmInput(document.getElementById('total_cgtIncidentalCostOnTransferAddrowTable_4').value));
	var amt1 =parseInt(removeCommaFrmInput(document.getElementById('cgtValueOfConsideration').value));
	var netTransferAmt= parseInt("0");
	if(amt<0 || amt==null)
	{
		alert("Please enter valid Amount.");
		return false;
	}
	netTransferAmt = amt1 - amt;
	if (cgtType!='-1'&& cgtType=='CGT_1')
	{
	document.getElementById('cgtNetTransferVal').value= convertToKenyanShillingFormatVal(netTransferAmt,false);
		document.getElementById('netTransferValueSummaryCGT1').value = convertToKenyanShillingFormatVal(netTransferAmt,false);
		calcOwnerWiseDiffBeingCapitalGainOrLoss();
	}
	else
	{
		document.getElementById('cgtNetTransferVal').value= convertToKenyanShillingFormatVal(netTransferAmt,false);
	document.getElementById('netTransferValueSummary').value = convertToKenyanShillingFormatVal(netTransferAmt,false);
	}
	calcDiffBeingCapitalGainOrLoss();
	
	return true;
}

function calcCgtTotalAmt()
{
	var amt=parseInt(removeCommaFrmInput(document.getElementById('cgtCostOfEnhancement').value));
	var amt1 =parseInt(removeCommaFrmInput(document.getElementById('cgtCostOnPreservation').value));
	var amt2 = parseInt(removeCommaFrmInput(document.getElementById('total_cgtIncidentalCostOnAcquisitionAddrowTable_4').value));
	var amt3 = parseInt(removeCommaFrmInput(document.getElementById('cgtCostOnAcquisition').value));
	if(isNaN(amt))
		amt= parseInt("0");
	if(isNaN(amt1))
		amt1= parseInt("0");
	if(isNaN(amt2))
		amt2= parseInt("0");
	if(isNaN(amt3))
		amt3= parseInt("0");
	var cgtTotalAmt=parseInt("0");
	cgtTotalAmt =  amt1+amt+amt2+amt3;
	document.getElementById('cgtTotal').value = convertToKenyanShillingFormatVal(cgtTotalAmt,false);
	calcNetAdjustedCost(document.getElementById('cgtTotal'),'total');
	return true;
}

function calcNetAdjustedCost(obj, flag)
{
	var amt = parseInt(removeCommaFrmInput(obj.value));
	if(isNaN(amt))
		amt= parseInt("0");
	var amt2;
	var netAdjustedAmt;
	if(amt<0 || amt==null)
	{
		alert("Please enter valid Amount.");
		obj.value='0';
		return false;
	}
	
	if(flag=='total')
	{
		amt2= parseInt(removeCommaFrmInput(document.getElementById('cgtAllowances').value));
		netAdjustedAmt = amt-amt2;
	}
	else
	{
		amt2= parseInt(removeCommaFrmInput(document.getElementById('cgtTotal').value));
		netAdjustedAmt = amt2-amt;
	}
	
	$('#cgtNetAdjustedCost').val(convertToKenyanShillingFormatVal(netAdjustedAmt,false));
	$('#netAdjustedCostSummary').val(convertToKenyanShillingFormatVal(netAdjustedAmt,false));
	$('#netAdjustedCostSummaryCGT1').val(convertToKenyanShillingFormatVal(netAdjustedAmt,false));
	calcDiffBeingCapitalGainOrLoss();
	return true;
}

function onChangeCgtYearOfPurchase(obj)
{
	obj.value=removeCommaFrmInput(obj.value);
	if(!onlyNumeric(obj))
	{
		alert("Please enter valid Year of Purchase");
		obj.value='';
		return false;
	}
	
	var year = parseInt(obj.value);
	var length = year.toString().length;
	if(length<4){
		alert('Year of purchase should be upto 4 digits.');
		obj.value ='';
		return false;
	}
	else{
		var time = document.getElementById('serverDate').value;
		var arr = time.split("/");
		var curYear = parseInt(arr[2]);
		if(year>curYear)
		{
			alert("Please enter upto Current Year.");
			obj.value ='';
			return false;
		}
		var inputDate = document.getElementById('dateOfTransferCGT1').value;
		var TransDate = inputDate.split("/",3);
		var transYear= TransDate[2];
		if(year>transYear)
		{
			alert("The Year Of Transfer Should Not Be Before The Year Of Purchase");
			dateObj.value = "";
			return false;
		}
		/*	if(2015>year)
		{
			alert("Please enter valid Year of Purchase.");
			obj.value ='';
			return false;
		}*/
	}
	
	return true;
}

function validateIncidentalCostOnTransferData()
{
	if(document.getElementById('in_cgtIncidentalCostOnTransferAddrowTable_3').value=='' || document.getElementById('in_cgtIncidentalCostOnTransferAddrowTable_3').value==null)
	{
		alert("Please enter proper description");
		return false;
	}
	if(document.getElementById('in_cgtIncidentalCostOnTransferAddrowTable_4').value=='' || document.getElementById('in_cgtIncidentalCostOnTransferAddrowTable_4').value==null)
	{
		alert("Please enter proper value");
		return false;
	}
	return true;
}

function validateIncidentalCostOnAcquisitionData()
{
	if(document.getElementById('in_cgtIncidentalCostOnAcquisitionAddrowTable_3').value=='' || document.getElementById('in_cgtIncidentalCostOnAcquisitionAddrowTable_3').value==null)
	{
		alert("Please enter proper description");
		return false;
	}
	if(document.getElementById('in_cgtIncidentalCostOnAcquisitionAddrowTable_4').value=='' || document.getElementById('in_cgtIncidentalCostOnAcquisitionAddrowTable_4').value==null)
	{
		alert("Please enter proper value");
		return false;
	}
	return true;
}

function calcTotalProfitLossRatioCGT1() {
	
	var tabObj1 = document.getElementById('cgtOwnerAddrowTable');
	var profitLossRatioAdded = parseInt(document.getElementById('in_cgtOwnerAddrowTable_5').value,10);
	var totalRatio = 0;
	
	if(tabObj1.rows.length==1)
	{
	}
	else
	{ 	
		for (var i = 1, n = tabObj1.rows.length; i <n; i++) 
		{
			var modify;
			if(document.all)
			{
				modify=trim(tabObj1.rows[i].cells[2].innerText);
			}
			else
			{
				modify=trim(tabObj1.rows[i].cells[2].textContent,"");
			}
			if((trim(document.getElementById('id_temp_'+'cgtOwnerAddrowTable'+'_'+i+'_1').value))=="Delete" && (modify=="Modify"))
			{
				totalRatio = totalRatio + +tabObj1.rows[i].cells[5].innerHTML;
			}
		}
		
		totalRatio += profitLossRatioAdded;
		
		if(totalRatio<=100)
			return true;
		else {
			alert('The total Profit/Loss ration should not be greater than 100%');
			return false;
		}
	}
}

function onChangeProfitLossSharingRatioCGT1(obj) {

	obj.value=removeCommaFrmInput(obj.value);
	if(!onlyNumeric(obj))
	{
		alert("Please enter valid Profit/Loss ratio.");
		obj.value='';
		return false;
	}
	var ratio = obj.value;
	if(ratio<=0 || ratio==null)
	{
		alert("Please enter valid Profit/Loss ratio.");
		obj.value='';
		return false;
	}
	if(ratio>100) {
		alert('You cannot enter Profit/Loss ratio greater than 100%');
		obj.value='';
		return false;
		//document.getElementById('in_CGT2PSecBpaymentsTbl_5').value='';
	}
	document.getElementById('in_cgt1PPartnershipDtlsAddrowTable_7').value=convertToKenyanShillingFormatVal(ratio,true);
	return true;
}

function onChangeCheckValueCGT1(obj){
	obj.value=removeCommaFrmInput(obj.value);
	if(!onlyNumeric(obj))
	{
		alert("Please enter numeric value for this field.");
		document.getElementById(obj.id).value=parseInt("0");
		return false;
	}

	var value= obj.value;
	value = parseInt(value,10);
	if(value<0 || value==null)
	{
		alert("Please enter valid Number for this field.");
		obj.value='';
		document.getElementById(obj.id).value=parseInt("0");
		return false;
	}
	document.getElementById(obj.id).value=convertToKenyanShillingFormatVal(value,true);
	return true;
}

function onChangeValueSecBCGT1() {
	var value = document.getElementById('in_cgtIncidentalCostOnTransferAddrowTable_4').value;
	document.getElementById('in_cgtIncidentalCostOnTransferAddrowTable_4').value = convertToKenyanShillingFormatVal(value,true);
}

function onChangeValueSecCCGT1() {
	var value = document.getElementById('in_cgtIncidentalCostOnAcquisitionAddrowTable_4').value;
	document.getElementById('in_cgtIncidentalCostOnAcquisitionAddrowTable_4').value = convertToKenyanShillingFormatVal(value,true);
}

function onModify(){
	var desc = document.getElementById('in_cgtIncidentalCostOnAcquisitionAddrowTable_3').value;
	var amount = document.getElementById('in_cgtIncidentalCostOnAcquisitionAddrowTable_4').value;
	
	addIncidentalCostOnAcquisitionDataOnModify();
	calcCgtTotalAmt();
	
	return true;
}

function addIncidentalCostOnAcquisitionDataOnModify()
{
	var tabObj1 = document.getElementById("cgtIncidentalCostOnAcquisitionAddrowTable");
	//var totalRows = tabObj1.rows.length;
	var count=0;


	for (var i = 1, n = tabObj1.rows.length; i <n; i++) 
	{ 
		var modify;
		modify=trim(tabObj1.rows[i].cells[2].innerText);
		if((trim(document.getElementById('id_temp_'+'cgtIncidentalCostOnAcquisitionAddrowTable'+'_'+i+'_1').value))=="Delete" && (modify=="Modify")) {
			count++;
		}
	}
		var errorString="";
		var i=1;
		if(document.getElementById('in_cgtIncidentalCostOnAcquisitionAddrowTable_3').value==""){
			errorString=errorString+i+") Please enter Description \n";
			i++;
		}
		if(document.getElementById('in_cgtIncidentalCostOnAcquisitionAddrowTable_4').value==""){
			errorString=errorString+i+") Please enter Value \n";
			i++;
		}
		if(errorString!=""){
			/*alert(errorString);*/
		}
		else{
			if(removeCommaFrmInput(document.getElementById('in_cgtIncidentalCostOnAcquisitionAddrowTable_4').value)>0  &&  removeCommaFrmInput(document.getElementById('in_cgtIncidentalCostOnAcquisitionAddrowTable_4').value)>0 )
			{

				if(addConfirm('a_cgtIncidentalCostOnAcquisitionAddrowTable'))
				{
					if(document.getElementById('a_cgtIncidentalCostOnAcquisitionAddrowTable').innerHTML!="Modify")
					{
						addrow('cgtIncidentalCostOnAcquisitionAddrowTable','2','2','4','','','N','N','');
						calcCgtTotalAmt();
						//calcTotalIncidentalCostSecB();
					}
					else
					{
						return true;
					}
				}
				else{
					isFalse=1;
				}
			}
		
			/*if(validateIncidentalCostOnAcquisitionData())
			{
				if(confirm("Do you want to add details?"))
				{
					addrow('cgtIncidentalCostOnAcquisitionAddrowTable','2','2','4','','','N','N','');
				}
				calcCgtTotalAmt();
			}*/
	}
}

function onDelete(){
	addIncidentalCostOnAcquisitionDataOnModify();
	calcCgtTotalAmt();
}


/*Added by Sanidhya for CGT 1 CR on 18-16-2018*/



function onchangeCgt1OwnerPinNumber(obj) {
	var pin = trim(obj.value);
	pin=pin.toUpperCase();
	obj.value=pin;

	/*if(pin==document.getElementById('txtPin').value) {    uncomment and modify to check whether the pin or owner and trasferor can be same
		alert('The Partner PIN and the Transferor PIN cannot be the same');
		obj.value='';
		return false;
	}*/
	if (validatePIN(pin)) {
		FetchTaxpayerDetailWithoutValidationSplObl.fetchTaxpayerDetailWithoutValidationSplObl(
				pin,
				function(data) {
					if (data != NULL && data != null) {
						if (data.isDataAvailable == N_FLAG) {
							if (data.isAgent == ERROR
									|| data.isAgent == NO_CALL_MADE) 
							{ 
								alert(errFetchingData);
							}
							else if (data.isAgent == NO_DETAILS_FOUND)
							{
								alert(invalidPin);
							}
							resetCgt1OwnerDetail();
							return false;
						}
						if(data.isDataAvailable!=null && data.isDataAvailable=='IpageNotProcessed')
						{
							alert('The entered Owner Pin is not iPage processed.');
							resetCgt1OwnerDetail();
							return false;
						}

						if (data.taxPayerFirstName != null
								|| data.taxPayerId != null) {
							if (data.taxPayerId != null
									|| data.taxPayerId != "") {
								document
								.getElementById('in_cgtOwnerAddrowTable_7').value = data.taxPayerId;
							}
							if (data.taxPayerFirstName != null
									|| data.taxPayerFirstName != "") {
								document
								.getElementById('in_cgtOwnerAddrowTable_4').value = data.taxPayerFirstName;
							}

							fetchOwnerDetailForSummary(pin);
						}
					} else {
						alert(errFetchingData);
						resetCgt1OwnerDetail();
						return false;
					}
				});



		return true;
	} else {
		resetCgt1OwnerDetail();
		return false;
	}
}



function resetCgt1OwnerDetail()
{
	document.getElementById('in_cgtOwnerAddrowTable_3').value = '';
	document.getElementById('in_cgtOwnerAddrowTable_4').value = '';
	document.getElementById('in_cgtOwnerAddrowTable_7').value = '';
	document.getElementById('in_cgtOwnerAddrowTable_5').value = '';
	document.getElementById('in_cgtOwnerAddrowTable_6').value = '';
	document.getElementById('in_cgtOwnerAddrowTable_3').focus();
}




function addCgtOwnerData()
{
	var errorString="";
	var a=1;
	var count=0;
	var cgtType = document.getElementById('cmbCGTType').value;
	var pin=document.getElementById('in_cgtOwnerAddrowTable_3').value;
	var tabObj1=document.getElementById("cgtOwnerAddrowTable");
	//ADDED by Mingu for Ticket 64973 :: START
	var dateOfTransferCGT1 = document.getElementById('dateOfTransferCGT1').value;
	//ADDED by Mingu for Ticket 64973 :: END

	for (var i = 1, n = tabObj1.rows.length; i <n; i++) 
	{ 
		var modify;
		modify=trim(tabObj1.rows[i].cells[2].innerText);
		if((trim(document.getElementById('id_temp_'+'cgtOwnerAddrowTable'+'_'+i+'_1').value))=="Delete" && (modify=="Modify")) {
			count++;
		}
	}
	if(count>=5) {
		alert("You cannot add more than 5 rows.");
		return false;
	}else{



		if(document.getElementById('in_cgtOwnerAddrowTable_3').value=='' || document.getElementById('in_cgtOwnerAddrowTable_3').value==null) {
			errorString=errorString+a+") Please enter PIN of the Owner \n";
			a++;
		}
		if(document.getElementById('in_cgtOwnerAddrowTable_5').value=='' || document.getElementById('in_cgtOwnerAddrowTable_5').value==null) {
			errorString=errorString+a+") Please enter Owner Ratio \n";
			a++;
		}
		else if (document.getElementById('in_cgtOwnerAddrowTable_5').value>100)
		{
			errorString=errorString+a+") Ratio cannot be more than 100% \n";
			a++;
		}
		//ADDED by Mingu for Ticket 64973 :: START
		else if (dateOfTransferCGT1 == "")
		{
			errorString=errorString+a+") Please Enter the Date of Transfer \n";
			a++;
		}
		//ADDED by Mingu for Ticket 64973 :: END
		else if (document.getElementById('in_cgtOwnerAddrowTable_6').value == null|| document.getElementById('in_cgtOwnerAddrowTable_6').value == "" || document.getElementById('in_cgtOwnerAddrowTable_6').value <0)
		{
			errorString=errorString+a+") Please enter valid owner's loss brought forward \n";
			a++;
		}



		if(errorString!=""){
			alert(errorString);
		}
		else{
			if(checkDuplicatePartnershipData())
			{


				//fetchOwnerDetailForSummary(pin);

				var profiLossRationSumFlag = calcTotalProfitLossRatioCGT1();
				if(profiLossRationSumFlag==false)
				{
					return false;
				}
				if (checkDuplicateOwnerData())
				{
					if(removeCommaFrmInput(document.getElementById('in_cgtOwnerAddrowTable_5').value)>0  &&  removeCommaFrmInput(document.getElementById('in_cgtOwnerAddrowTable_5').value)>0 )
					{

						if(addConfirm('a_cgtOwnerAddrowTable'))
						{
							if(document.getElementById('a_cgtOwnerAddrowTable').innerHTML!="Modify")
							{
								setDataInSummaryAddRowTableForCGT1();
								addrow('cgtOwnerAddrowTable','4','5','3','','','N','N','','');
								// added by sanidhya for adding details in summary of owner table
								//addrow('cgt1SummaryAddrowTable','7','8','3','','','Y','Y','','');
							}
							else
							{
								return true;
							}
						}
						else{
							isFalse=1;
						}
					}
				}
			}
		}
	}
}




function checkDuplicateOwnerData()
{
	var pinOfOwner = document.getElementById('in_cgtOwnerAddrowTable_3').value;
	var table = document.getElementById('cgtOwnerAddrowTable');
	if(table.rows.length==1)
	{
	}
	else{
		for (var i = 1, n = table.rows.length; i <n; i++) 
		{ 
			modify=trim(table.rows[i].cells[2].getElementsByTagName('A')[0].innerHTML);
			if((trim(document.getElementById('id_temp_'+'cgtOwnerAddrowTable'+'_'+i+'_1').value))=="Delete" && (modify=="Modify") &&
					(table.rows[i].cells[3].innerHTML==pinOfOwner))
			{
				alert("You already added this details.");
				return false;
			}
		}
	}
	return true;
}



function fetchOwnerDetailForSummary(pin)
{
	var taxPayerIdOwner=document.getElementById('in_cgtOwnerAddrowTable_7').value;

	var cgtType = document.getElementById('cmbCGTType').value;

	FetchCapitalLossBroughtForwardCGT2.fetchCapitalLossBroughtForwardCGT2(taxPayerIdOwner,cgtType,{async:false,callback: function(data){

		if(data != 'null' &&  data != null){

			if(data.isDataAvailable == "Y"){
				document.getElementById('isFirstCgtPmt').value=0;
				document.getElementById('in_cgtOwnerAddrowTable_6').value = convertToKenyanShillingFormatVal(data.capitalLossBroughtForward,false);
				document.getElementById('in_cgtOwnerAddrowTable_6').readOnly=true;
				document.getElementById('in_cgtOwnerAddrowTable_6').className='readonlyInput form101_textfcurr_width textonlyRight';
			}
			else {

				if(data.firstCgtPmt == true) {
					document.getElementById('isFirstCgtPmt').value=1;
					document.getElementById('in_cgtOwnerAddrowTable_6').readOnly=false;
					document.getElementById('in_cgtOwnerAddrowTable_6').className='form101_textfcurr form101_textfcurr_width textonlyRight';

				}
				else {
					document.getElementById('isFirstCgtPmt').value=0;
					document.getElementById('in_cgtOwnerAddrowTable_6').value = '0';
					document.getElementById('in_cgtOwnerAddrowTable_6').readOnly=true;
					document.getElementById('in_cgtOwnerAddrowTable_6').className='readonlyInput form101_textfcurr_width textonlyRight';
				}
			}
		}
		else if(data == 'null' || data == null){
			document.getElementById('in_cgtOwnerAddrowTable_6').readOnly=false;
			document.getElementById('in_cgtOwnerAddrowTable_6').className='form101_textfcurr form101_textfcurr_width textonlyRight';
		}
	}
	});


}




function setDataInSummaryAddRowTableForCGT1()
{
	document.getElementById('in_cgt1SummaryAddrowTable_3').value=document.getElementById('in_cgtOwnerAddrowTable_4').value;/*Owner Name*/
	document.getElementById('in_cgt1SummaryAddrowTable_4').value=0.00;/*Difference being Capital Gain or (Loss) (A-B) (C)*/
	document.getElementById('in_cgt1SummaryAddrowTable_5').value=document.getElementById('in_cgtOwnerAddrowTable_6').value;/* Capital Loss brought forward, if any (D)*/	
	document.getElementById('in_cgt1SummaryAddrowTable_6').value=0.00;/*Capital Loss Carry Forwarded and Setoff (E)*/
	document.getElementById('in_cgt1SummaryAddrowTable_7').value=0.00;/*Difference being the Net Capital Gain or (Loss) (C-D+E) (F)*/
	document.getElementById('in_cgt1SummaryAddrowTable_8').value=0.00;/*Capital Gains tax @5% of F*/
	document.getElementById('in_cgt1SummaryAddrowTable_9').value=document.getElementById('in_cgtOwnerAddrowTable_6').value;/*Capital Loss carried forward*/
	document.getElementById('in_cgt1SummaryAddrowTable_10').value=document.getElementById('in_cgtOwnerAddrowTable_7').value;/*Taxpayer_id*/
}

function calcOwnerWiseDiffBeingCapitalGainOrLoss()
{
	var netTransferValueSummaryCGT1= removeCommaFrmInput(document.getElementById('netTransferValueSummaryCGT1').value)*1;
	var netAdjustedValueSummaryCGT1= removeCommaFrmInput(document.getElementById('netAdjustedCostSummaryCGT1').value)*1;
	var countSummary=document.getElementById("cgt1SummaryAddrowTable").rows.length;
	var ownerwiseCalc=0;
	if (countSummary>1 && netTransferValueSummaryCGT1>"0")
	{	
		var count=1;


		for (count=1;count<countSummary;count++)
		{

			var ratio=document.getElementById("id_td_cgtOwnerAddrowTable_"+count+"_5").innerHTML;

			ownerwiseCalc=(ratio/100)*netTransferValueSummaryCGT1;
			
			//document.getElementById("id_td_cgt1SummaryAddrowTable_"+count+"_4").innerHTML=convertToKenyanShillingFormatVal(ownerwiseCalc,false);
		}
		var netAdjustedCostSummaryCGT1 = document.getElementById('netAdjustedCostSummaryCGT1').value;
		var netTransferValueSummaryCGT1 = document.getElementById('netTransferValueSummaryCGT1').value;

		if((netAdjustedCostSummaryCGT1!=null && netAdjustedCostSummaryCGT1!='') && (netTransferValueSummaryCGT1!=null && netTransferValueSummaryCGT1!='')) {
			netAdjustedCostSummaryCGT1 = removeCommaFrmInput(netAdjustedCostSummaryCGT1);
			netTransferValueSummaryCGT1 = removeCommaFrmInput(netTransferValueSummaryCGT1);
			netAdjustedCostSummaryCGT1 = parseInt(netAdjustedCostSummaryCGT1,10);
			netTransferValueSummaryCGT1 = parseInt(netTransferValueSummaryCGT1,10);
			var diffBeingCapitalGainOrLoss = netTransferValueSummaryCGT1 - netAdjustedCostSummaryCGT1;
			document.getElementById('diffBeingCapitalGainOrLossCGT1').value = convertToKenyanShillingFormatVal(diffBeingCapitalGainOrLoss,true);
			setDataInSummaryAddRowTableForCGT1OnChangeInOtherFields();
			calcOwnerWiseDiffBeingNetCapitalGain();
			
		}
	}


}



function calcOwnerWiseDiffBeingNetCapitalGain()
{
	var netTransferValueSummaryCGT1= removeCommaFrmInput(document.getElementById('netTransferValueSummaryCGT1').value)*1;
	var countSummary=document.getElementById("cgt1SummaryAddrowTable").rows.length;
	var valC=0;
	var valD=0;
	var valE=0;
	var ownerWiseDiffBeingNetCapitalGain=0;
	if (countSummary>1 && netTransferValueSummaryCGT1>"0")
	{	
		var count=1;
		for (count=1;count<countSummary;count++)
		{
			valC=removeCommaFrmInput(document.getElementById("id_td_cgt1SummaryAddrowTable_"+count+"_4").innerHTML);
			valD=removeCommaFrmInput(document.getElementById("id_td_cgt1SummaryAddrowTable_"+count+"_5").innerHTML);
			valE=removeCommaFrmInput(document.getElementById("id_td_cgt1SummaryAddrowTable_"+count+"_6").innerHTML);
			ownerWiseDiffBeingNetCapitalGain=valD- +valC - +valE;
			 ownerWiseDiffBeingNetCapitalGain=ownerWiseDiffBeingNetCapitalGain*-1;
			document.getElementById("id_td_cgt1SummaryAddrowTable_"+count+"_7").innerHTML=convertToKenyanShillingFormatVal(ownerWiseDiffBeingNetCapitalGain,false);
		}

		calcOwnerWiseCGTAndCapitalLossForward();
	}


}


function calcOwnerWiseCGTAndCapitalLossForward()
{
	var netTransferValueSummaryCGT1= removeCommaFrmInput(document.getElementById('netTransferValueSummaryCGT1').value)*1;
	var countSummary=document.getElementById("cgt1SummaryAddrowTable").rows.length;
	if (countSummary>1 && netTransferValueSummaryCGT1>"0")
	{	
		var count=1;
		for (count=1;count<countSummary;count++)
		{
			var valF= removeCommaFrmInput(document.getElementById("id_td_cgt1SummaryAddrowTable_"+count+"_7").innerHTML)*1;
			if (valF>=0)
			{
				document.getElementById("id_td_cgt1SummaryAddrowTable_"+count+"_8").innerHTML=convertToKenyanShillingFormatVal(Math.ceil((0.05*valF)));
				document.getElementById("id_td_cgt1SummaryAddrowTable_"+count+"_9").innerHTML=0.00;
			}
			else
			{
				document.getElementById("id_td_cgt1SummaryAddrowTable_"+count+"_8").innerHTML=0.00;
				document.getElementById("id_td_cgt1SummaryAddrowTable_"+count+"_9").innerHTML=valF;
			}

		}
	}


}

function setDataInSummaryAddRowTableForCGT1OnChangeInOtherFields()
{
	var countSummary=document.getElementById("cgtOwnerAddrowTable");
	var countSummary2=document.getElementById("cgt1SummaryAddrowTable").rows.length;
	var summaryOwner=document.getElementById("cgt1SummaryAddrowHiddenTable");
	var count=1;
	var cgtType = document.getElementById('cmbCGTType').value;
	var isAmended = "true";
	var ackNo = document.getElementById('cgtAcknowledgementNo').value;
//	for (count=1;count<countSummary;count++)
//	{
//		fn_ActDelete("cgt1SummaryAddrowTable",count,"8","7");
//
//	}
	if(countSummary2>1){
	clear_table_data("cgt1SummaryAddrowTable");
	}

	//ADDED by Mingu for Ticket 64973 :: START
	var dateOfTransferCGT1 = document.getElementById('dateOfTransferCGT1').value;
	if(dateOfTransferCGT1 != null && dateOfTransferCGT1 != ""){
		for (count=1;count<countSummary.rows.length;count++){
			var ownerAdRowString=document.getElementById("id_cgtOwnerAddrowTable_"+ count).value;
			var array=ownerAdRowString.split("****");
			var taxPayerId=array[5];
			var taxpayerIdString=taxPayerId.split("@@");
			var taxPayerIdTransferor=taxpayerIdString[0];
			
			
			//var taxPayerIdTransferor=countSummary.rows[count].cells[6].innerHTML;
		
		
			if(document.getElementById('isAmended').value=='Y'){
				FetchCapitalLossBroughtForwardAndSetOff.fetchCapitalLossBroughtForwardAndSetOff(taxPayerIdTransferor,cgtType,isAmended,ackNo,{async:false,callback: function(data){
					if(data != 'null' &&  data != null){

						if(countSummary.rows[count].cells[1].textContent!='deleted' || countSummary.rows[count].cells[1].innerText!='deleted' ){
							var ratio=(parseFloat(document.getElementById('id_td_cgtOwnerAddrowTable_'+count+'_5').innerHTML))/100;

							document.getElementById('in_cgt1SummaryAddrowTable_3').value=document.getElementById('id_td_cgtOwnerAddrowTable_'+count+'_4').innerHTML; /*Owner Name*/

							document.getElementById('in_cgt1SummaryAddrowTable_4').value= convertToKenyanShillingFormatVal(removeCommaFrmInput(document.getElementById('diffBeingCapitalGainOrLossCGT1').value)*(ratio),false);

							document.getElementById('in_cgt1SummaryAddrowTable_5').value= document.getElementById('cgtOwnerAddrowTable').rows[count].cells[6].innerHTML.split("<")[0];

							document.getElementById('in_cgt1SummaryAddrowTable_6').value=data.capitalLossCarryForwardedAndSetoff;

							var amount= parseFloat(removeCommaFrmInput(document.getElementById('in_cgt1SummaryAddrowTable_5').value)) - parseFloat(removeCommaFrmInput(document.getElementById('in_cgt1SummaryAddrowTable_4').value)) - parseFloat(removeCommaFrmInput(document.getElementById('in_cgt1SummaryAddrowTable_6').value));
							amount=amount*-1;

							document.getElementById('in_cgt1SummaryAddrowTable_7').value=convertToKenyanShillingFormatVal(amount,false);

							//ADDED by Mingu for Ticket 64973 :: START
							var isAllowedSplRate = document.getElementById('isAllowedSplRate').value;
							var cgtSpecialRate = document.getElementById('cgtSpecialRate').value;
							var cgtRate = parseInt(cgtSpecialRate)/100;
							//commented  for wrong alert :: 18/07/2023
							//alert("cgtRate is::"+cgtRate);
							if(isAllowedSplRate == "Y"){
								if (Math.ceil(cgtRate*(parseFloat(removeCommaFrmInput(amount))))>0)//Changed from 5% to 15% by Mingu for Finance Act 2022/23 changes
								{
									document.getElementById('in_cgt1SummaryAddrowTable_8').value=convertToKenyanShillingFormatVal(Math.ceil(cgtRate*(parseFloat(removeCommaFrmInput(amount)))),false);//Changed from 5% to 15% by Mingu for Finance Act 2022/23 changes
									document.getElementById('in_cgt1SummaryAddrowTable_9').value=0.00;
								}
							}
							//ADDED by Mingu for Ticket 64973 :: end
							else if (isAllowedSplRate == "N" && Math.ceil(0.15*(parseFloat(removeCommaFrmInput(amount))))>0)//Changed from 5% to 15% by Mingu for Finance Act 2022/23 changes
							{
								document.getElementById('in_cgt1SummaryAddrowTable_8').value=convertToKenyanShillingFormatVal(Math.ceil(0.15*(parseFloat(removeCommaFrmInput(amount)))),false);//Changed from 5% to 15% by Mingu for Finance Act 2022/23 changes
								document.getElementById('in_cgt1SummaryAddrowTable_9').value=0.00;
							}else{
								document.getElementById('in_cgt1SummaryAddrowTable_8').value=0.00;
								document.getElementById('in_cgt1SummaryAddrowTable_9').value=parseFloat(removeCommaFrmInput(document.getElementById('in_cgt1SummaryAddrowTable_5').value))- parseFloat(removeCommaFrmInput(document.getElementById('in_cgt1SummaryAddrowTable_4').value))-parseFloat(removeCommaFrmInput(document.getElementById('in_cgt1SummaryAddrowTable_6').value));
							}
							document.getElementById('in_cgt1SummaryAddrowTable_10').value=document.getElementById('cgtOwnerAddrowTable').rows[count].innerHTML.split('@@')[4].split('****')[1];/*Taxpayer_id*/
							addrow('cgt1SummaryAddrowTable','7','8','3','','','Y','Y','','');
							}
						
					
						
					}
				}
				});
			}
				
			
			else{
				if(countSummary.rows[count].cells[1].textContent!='deleted' || countSummary.rows[count].cells[1].innerText!='deleted' ){
					var ratio=(parseFloat(document.getElementById('id_td_cgtOwnerAddrowTable_'+count+'_5').innerHTML))/100;

					document.getElementById('in_cgt1SummaryAddrowTable_3').value=document.getElementById('id_td_cgtOwnerAddrowTable_'+count+'_4').innerHTML; /*Owner Name*/

					document.getElementById('in_cgt1SummaryAddrowTable_4').value= convertToKenyanShillingFormatVal(removeCommaFrmInput(document.getElementById('diffBeingCapitalGainOrLossCGT1').value)*(ratio),false);

					document.getElementById('in_cgt1SummaryAddrowTable_5').value= document.getElementById('cgtOwnerAddrowTable').rows[count].cells[6].innerHTML.split("<")[0];

					document.getElementById('in_cgt1SummaryAddrowTable_6').value=0;

					var amount= parseFloat(removeCommaFrmInput(document.getElementById('in_cgt1SummaryAddrowTable_5').value)) - parseFloat(removeCommaFrmInput(document.getElementById('in_cgt1SummaryAddrowTable_4').value)) - parseFloat(removeCommaFrmInput(document.getElementById('in_cgt1SummaryAddrowTable_6').value));
					amount=amount*-1;

					document.getElementById('in_cgt1SummaryAddrowTable_7').value=convertToKenyanShillingFormatVal(amount,false);
					
					//ADDED by Mingu for Ticket 64973 :: START
					var isAllowedSplRate = document.getElementById('isAllowedSplRate').value;
					var cgtSpecialRate = document.getElementById('cgtSpecialRate').value;
					var cgtRate = parseInt(cgtSpecialRate)/100;
					/*if(isAllowedSplRate == "Y"){
						if (Math.ceil(cgtRate*(parseFloat(removeCommaFrmInput(amount))))>0)//Changed from 5% to 15% by Mingu for Finance Act 2022/23 changes
						{
							document.getElementById('in_cgt1SummaryAddrowTable_8').value=convertToKenyanShillingFormatVal(Math.ceil(cgtRate*(parseFloat(removeCommaFrmInput(amount)))),false);//Changed from 5% to 15% by Mingu for Finance Act 2022/23 changes
							document.getElementById('in_cgt1SummaryAddrowTable_9').value=0.00;
						}
					}
					*///ADDED by Mingu for Ticket 64973 :: end
					if (Math.ceil(cgtRate*(parseFloat(removeCommaFrmInput(amount))))>0)//Changed from 5% to 15% by Mingu for Finance Act 2022/23 changes
					{
						document.getElementById('in_cgt1SummaryAddrowTable_8').value=convertToKenyanShillingFormatVal(Math.ceil(cgtRate*(parseFloat(removeCommaFrmInput(amount)))),false);//Changed from 5% to 15% by Mingu for Finance Act 2022/23 changes
						document.getElementById('in_cgt1SummaryAddrowTable_9').value=0.00;
					}else{
						document.getElementById('in_cgt1SummaryAddrowTable_8').value=0.00;
						document.getElementById('in_cgt1SummaryAddrowTable_9').value=parseFloat(removeCommaFrmInput(document.getElementById('in_cgt1SummaryAddrowTable_5').value))- parseFloat(removeCommaFrmInput(document.getElementById('in_cgt1SummaryAddrowTable_4').value))-parseFloat(removeCommaFrmInput(document.getElementById('in_cgt1SummaryAddrowTable_6').value));
					}
					document.getElementById('in_cgt1SummaryAddrowTable_10').value=document.getElementById('cgtOwnerAddrowTable').rows[count].innerHTML.split('@@')[4].split('****')[1];/*Taxpayer_id*/
					addrow('cgt1SummaryAddrowTable','7','8','3','','','Y','Y','','');
					}
				
			}
			
		
		}
		calculateNetCGTPayable();

	}
	else{
		alert("please Enter The date of Transfer");
		return false;
	}
	//ADDED by Mingu for Ticket 64973 :: END
}


function calculateNetCGTPayable()
{
	var countSummary=document.getElementById("cgt1SummaryAddrowTable").rows.length;
	var amt=0;
	var count;
	for (count=1;count<countSummary;count++)
	{

		amt+=parseFloat(removeCommaFrmInput(document.getElementById('id_td_cgt1SummaryAddrowTable_'+count+'_8').innerHTML));
		document.getElementById('netCGTPayableCGT1Summary').value=convertToKenyanShillingFormatVal(amt,false);
		document.getElementById('txtTotalAmountPaidOblig').value=document.getElementById('netCGTPayableCGT1Summary').value;
		document.getElementById('capitalGainTax').value=document.getElementById('netCGTPayableCGT1Summary').value;

	}
}


function verifyRatioForCGT1()
{
	var ratio=0;
	var newRatio=document.getElementById("").value;
	var count;
	var countSummary=document.getElementById("cgtOwnerAddrowTable").rows.length;
	if (countSummary>1)
	{
		for (count=1;count<countSummary;count++)
		{
			ratio = ratio + (parseFloat(document.getElementById('id_td_cgtOwnerAddrowTable_'+count+'_5').innerHTML));
		}
	}
	if ((ratio+newRatio)>100)
	{
		alert ("Sum of Ratio cannot be greater than 100%");
		return false;
	}
	else
		return true;

}

function allowCurrentAndPastDate(dateObj)
{
	if(!checkdate(dateObj))
	{
		return false;
	}
	var inputDate = dateObj.value;
//	var serverDateArray = serverDate.split("/");
//	var curdate = new Date(serverDateArray[2],serverDateArray[1]-1,serverDateArray[0]);

	var curdate = null;
/*	var inputDate = dateObj.value;
	var TransDate = inputDate.split("/",3);
	var year= TransDate[2];
	if(year<2015)
	{
		alert("Transfer Date Should be on or after 1st January 2015");
		dateObj.value = "";
		return false;
	}
*/
	dateOfTransferLbl=document.getElementById('dateOfTransferLbl1').value;
	//currentDate=request.getAttribute("currentDate", date);
	if(null!=dateOfTransferLbl){
		var serverDateArray = dateOfTransferLbl.split("/");
		curdate  = new Date(serverDateArray[2],serverDateArray[1]-1,serverDateArray[0]);
	}else{
		curdate = new Date();
	}
	var curmonth=parseInt(curdate.getMonth()+1);
	if (curmonth<10) curmonth= '0'+curmonth;
	var curyear=parseInt(curdate.getFullYear());
	var curday=parseInt(curdate.getDate());
	if (curday<10) curday= '0'+curday;
	var todayDate = curday+"/"+curmonth+"/"+curyear;

	//if(Date.parse(todayDate) != Date.parse(inputDate)){
	if(todayDate != inputDate){
		if(fnCompareDates(todayDate,inputDate))
		{
			alert("Date should not be future date");
			dateObj.value = "";
			return false;
		}
	}
	return true;
}

/*
function checkDuplicateOwnerData()
{
	var pinOfOwner = document.getElementById('in_cgtOwnerAddrowTable_3').value;
//	if(pinOfTransferor==pinOfTransferee)
//	{
//		alert("Transferor and Transferee Pin can not be same.");
//		return false;
//	}
	var table = document.getElementById('cgtOwnerAddrowTable');
	var rowCount=table.rows.length;
	if(rowCount>1)
	{
		for(var i = 1, n = table.rows.length; i <n; i++) 
		{
			if(table.rows[i].cells[1].textContent!='deleted' || table.rows[i].cells[1].innerText!='deleted'){
				if (document.all) {// for IE
					alert('You can add only 1 Transferee Detail.');
					return false;
				}
				else{
					alert('You can add only 1 Transferee Detail.');
					return false;
				}
			}

		}
	}
	if(table.rows.length==1)
	{
	}
	else{
	for (var i = 1, n = table.rows.length; i <n; i++) 
	{ 
		modify=trim(table.rows[i].cells[2].getElementsByTagName('A')[0].innerHTML);
		if((trim(document.getElementById('id_temp_'+'cgtOwnerAddrowTable'+'_'+i+'_1').value))=="Delete" && (modify=="Modify") &&
				(table.rows[i].cells[3].innerHTML==pinOfOwner))
		{
			alert("You already added this details.");
			return false;
		}
	}
	return true;
}*/


function afterDeletecgtIncidentalCostOnTransferAddrowTable(rowno){
	var table = document.getElementById('cgtIncidentalCostOnTransferAddrowTable');  
	var	totalAmt = removeCommaFrmInput(document.getElementById('cgtNetTransferVal').value);
	var tempAmt = table.rows[rowno].cells[4].innerHTML;
	totalAmt = +totalAmt + +parseFloat(removeCommaFrmInput(tempAmt),"10");
	document.getElementById('cgtNetTransferVal').value =  totalAmt;
	document.getElementById('cgtNetTransferVal').value = convertToKenyanShillingFormatVal(document.getElementById("cgtNetTransferVal").value, true);
		
	
}
function afterModifycgtIncidentalCostOnTransferAddrowTable(){
	var table = document.getElementById('cgtIncidentalCostOnTransferAddrowTable');  
	var	totalAmt = removeCommaFrmInput(document.getElementById('cgtNetTransferVal').value);
	for(var countCGT1OwnerData=1;countCGT1OwnerData<table.rows.length;countCGT1OwnerData++){
		if(table.rows[countCGT1OwnerData].cells[2].textContent=='Modifying'){
	var tempAmt = table.rows[countCGT1OwnerData].cells[4].innerHTML;
	totalAmt = +totalAmt + +parseFloat(removeCommaFrmInput(tempAmt),"10");
	document.getElementById('cgtNetTransferVal').value =  totalAmt;
	document.getElementById('cgtNetTransferVal').value = convertToKenyanShillingFormatVal(document.getElementById("cgtNetTransferVal").value, true);
		}
	}
	calculateNetTransferVal();
}

function afterDeleteCgtOwnerAddrowTable(rowno){
	setDataInSummaryAddRowTableForCGT1OnChangeInOtherFields();
}
function beforeModifyCgtOwnerAddrowTable(){
	
	var profiLossRationSumFlag = calcTotalProfitLossRatioCGT1();
	if(profiLossRationSumFlag==false)
	{
		return false;
	}
}

function beforeAddCgtOwnerAddrowTable(){
	var profiLossRationSumFlag = calcTotalProfitLossRatioCGT1();
	if(profiLossRationSumFlag==false)
	{
		return false;
	}
}
function afterModifyCgtOwnerAddrowTable(){

	setDataInSummaryAddRowTableForCGT1OnChangeInOtherFields();
	
	
}
function afterAddCgtOwnerAddrowTable(){
	document.getElementById("in_cgtOwnerAddrowTable_6").readOnly=false;
	
	setDataInSummaryAddRowTableForCGT1OnChangeInOtherFields();
	
}
function allowCurrentAndPastDateCgt1(dateObj){
var yearOfPurchase = document.getElementById('cgtYearOfPurchase').value;
if(yearOfPurchase == '' || yearOfPurchase == ' ' || yearOfPurchase == null)
{
	alert("Please Enter Year Of Purchase First Before Entering Date of Transfer");
	dateObj.value = "";
	return false;
}
if(!checkdate(dateObj))
{
	return false;
}
//var serverDateArray = serverDate.split("/");
//var curdate = new Date(serverDateArray[2],serverDateArray[1]-1,serverDateArray[0]);
var curdate = null;
var inputDate = dateObj.value;
var TransDate = inputDate.split("/",3);
var year= TransDate[2];
if(yearOfPurchase>year)
{
	alert("The Date Of Transfer Should Not Be Before The Year Of Purchase");
	dateObj.value = "";
	return false;
}
if(year<2015)
{
	alert("Transfer Date Should be on or after 1st January 2015");
	dateObj.value = "";
	return false;
}

var noOfDays=parseInt(document.getElementById('noODaysForDateOfTransfer').value);
dateOfTransferLbl=document.getElementById('dateOfTransferCGT1').value;
//currentDate=request.getAttribute("currentDate", date);
if(null!=dateOfTransferLbl){
	var serverDateArray = dateOfTransferLbl.split("/");
	curdate  = new Date(serverDateArray[2],serverDateArray[1]-1,serverDateArray[0]);
}else{
	curdate = new Date();
}
var todayDateNow=new Date();
var todayDate = new Date(todayDateNow);
todayDate.setDate(todayDate.getDate() + noOfDays);

var curmonth=parseInt(todayDate.getMonth()+1);
if (curmonth<10) curmonth= '0'+curmonth;
var curyear=parseInt(todayDate.getFullYear());
var curday=parseInt(todayDate.getDate());
if (curday<10) curday= '0'+curday;
var todayDateFormatted = curday+"/"+curmonth+"/"+curyear;
//if(Date.parse(todayDate) != Date.parse(inputDate)){
if(todayDateFormatted != dateOfTransferLbl){
	if(!(fnCompareDates(dateOfTransferLbl,todayDateFormatted)))
	{
		alert("Please enter Date of Transfer within " +noOfDays + "  days of current date.");
		dateObj.value = "";
		return false;
	}
}
return true;
}
//START :added by Bhavana for CGT1 and CGT1P JS changes


function onChangeOwnerLossBroughtForward(){
	var value = document.getElementById('in_cgtOwnerAddrowTable_6').value;
	document.getElementById('in_cgtOwnerAddrowTable_6').value = convertToKenyanShillingFormatVal(value,true);
}