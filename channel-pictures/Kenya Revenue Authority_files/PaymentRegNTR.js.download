
function fetchNtrDetails(){
	FetchNtrDetails.fetchNtrDetails(function(data){
		if(data!=null && data !='null'){
			dwr.util.removeAllOptions('cmbNTR'); 
			dwr.util.addOptions('cmbNTR',data,'bclNtrMstId','taxName');
		}

	});
	return true;

}
function fetchNtrAmount(period)
{
	if(period == -1 ||period =="" ||period ==" ")
	{
		alert(taxPeriod);
		document.getElementById('txtTotalAmountPaidNTR').value = 0;
		return false;
	}
	value =document.getElementById("cmbTaxSubHead").value;
	if(period == -1 ||period =="" ||period ==" ")
	{
		document.getElementById('txtTotalAmountPaidNTR').value = 0;
		return false;
	}
	document.getElementById("hidRefId").value=value;
	document.getElementById("hidObligationId").value=value;
	var taxPeriod=document.getElementById("cmbTaxPeriod").value;
	var taxPeriodArr = taxPeriod.split("-");
	var frmDate = taxPeriodArr[0];
	var toDate = taxPeriodArr[1];
	if(value==exciseObligationId)
	{
		document.getElementById('paymentRegExciseLicenseDiv').style.display='';

		/*var checkDuplicateFlag = checkDuplicateForExcise(row);
		if(checkDuplicateFlag==false)
		{
			return false;
		}*/
		FetchNtrAmount.fetchNtrAmount(value,{async:false,callback:function(data)
			{

			if(data!=null)
			{
				var amountPaid = convertToKenyanShillingFormatVal(Math.ceil(data.totalAmountTobePaid), true);
				if(amountPaid<=0)
				{
					document.getElementById('hidObligationFromDate').value=frmDate;
					document.getElementById('hidObligationToDate').value=toDate;
				}
				else
				{
					document.getElementById('in_NTRExciseDetailAddRowTable_7').value = amountPaid;
					document.getElementById('hidObligationFromDate').value=frmDate;
					document.getElementById('hidObligationToDate').value=toDate;
					hideTab('TabView',5);
					incError=0;
				}

				document.getElementById('hidObligationId').value=value;
			}
			}});
	}
	else
	{
		document.getElementById('txtTotalAmountPaidNTR').value = "0";
		document.getElementById('paymentRegExciseLicenseDiv').style.display = 'none';

		//document.getElementById('NTRExciseDetailFieldSet').style.display='none';

		FetchNtrAmount.fetchNtrAmount(value,{async:false,callback:function(data)

			{
			var taxPayerId=document.getElementById('hidTaxPayerId').value;

			if(isAlreadyPaid(taxPayerId,value,frmDate,toDate))
			{
				if(data!=null)
				{
					var amountPaid = convertToKenyanShillingFormatVal(Math.ceil(data.totalAmountTobePaid), true);
					if(amountPaid<=0)
					{
						alert(noAmtForSelectedNTR);
						document.getElementById('txtTotalAmountPaidNTR').value = 0;
						document.getElementById('hidObligationFromDate').value=frmDate;
						document.getElementById('hidObligationToDate').value=toDate;
					}
					else
					{
						document.getElementById('txtTotalAmountPaidNTR').readOnly = true;
						document.getElementById('txtTotalAmountPaidNTR').value = amountPaid;
						document.getElementById('hidObligationFromDate').value=frmDate;
						document.getElementById('hidObligationToDate').value=toDate;
						hideTab('TabView',5);
						incError=0;
					}
					document.getElementById('hidObligationId').value=value;
				}
			}	
			}});
	}
}
function savePaymentDetailNTR()
{
	resetErrorList();
	/*resetErrorList();
	if(isWithoutLogin == "Y" || isWithoutLogin =="y"){
		validateCaptcha = validateCaptchaForPayment("captcahText_taxObl","captcha_img_NTR");//this method returns true according to right captcha validation
	}
	else{
		validateCaptcha = true;// for inside login captcha validation is not required so it is set true explicitly  (&& validateCaptcha)
	}

	if(validateCaptcha)*/{// in ntr there is no provision for outside login , though i have just put it...in case in future this is to be included then we don't need to write code for that.
		if(document.getElementById("paymentRegExciseLicenseDiv").style.display=='')
		{
			if(validateFormFields(paymentRegTaxHeadJson,paymentRegTaxDetailsJson,paymentRegPmtTtypeJson))
			{
			//	if(document.getElementById("in_NTRExciseDetailAddRowTable_4").value== "PMTFEE" )
				{
					if(selectedExciseFlag>0)
					{
						if(removeCommaFrmInput(document.getElementById("txtTotalAmountPaidNTR").value)>0)
						{
							hideTab('TabView',5);
							resetErrorList();
							incError=0;
							if(saveConfirm())
							{
								document.getElementById('cmdSaveOblig').disabled=true;
								document.getElementById('cmdClearOblig').disabled=true;
								document.getElementById("txtTotalAmountPaidNTR").value = removeCommaFrmInput(document.getElementById("txtTotalAmountPaidNTR").value);
								document.paymentRegForm.action="paymentRegistration.htm?actionCode=saveObligationDetail";
								document.paymentRegForm.submit();
							}
						}
						else
						{
							alert(totalAmtGreaterThenZero);
							return false;
						}
					}
					else
					{
						alert(recordForPayment);
						return false;
					}
				}
			//	if(document.getElementById("in_NTRExciseDetailAddRowTable_4").value== "PMTDML" )
				/*{
					if(selectedExciseFlag>0)
					{
						if(removeCommaFrmInput(document.getElementById("txtTotalAmountPaidNTR").value)>0)
						{
							hideTab('TabView',5);
							resetErrorList();
							incError=0;
							if(saveConfirm())
							{
								document.getElementById('cmdSaveOblig').disabled=true;
								document.getElementById('cmdClearOblig').disabled=true;
								document.getElementById("txtTotalAmountPaidNTR").value = removeCommaFrmInput(document.getElementById("txtTotalAmountPaidNTR").value);
								document.paymentRegForm.action="paymentRegistration.htm?actionCode=saveObligationDetail";
								document.paymentRegForm.submit();
							}
						}
						else
						{
							alert(totalAmtGreaterThenZero);
							return false;
						}
					}
					else
					{
						alert("Please add atleast one comodity details");
						return false;
					}
				}*/
				/*else {
					alert("Please select Registration Type ");
					return false;
				}*/

			}
			else
			{
				getErrTabToggle('TabView','2');	
				tabview_switch('TabView', '2');
				hideAndShowTable("errorDiv");
				document.getElementById('btnTbl').style.display="none";
			}
		}
		else
		{
			if(validateFormFields(paymentRegTaxHeadJson,paymentRegTaxDetailsJson,paymentRegPmtTtypeJson,paymentRegTaxPeriodDetailsJson,paymentRegNtrPaymentDetailsJson))
			{
				// if(validateFormFields(paymentRegNtrDetailsJson,paymentRegNtrPaymentDetailsJson,paymentRegNtrPeriodDetailsJson))
				{
					hideTab('TabView',5);
					resetErrorList();
					incError=0;
					if(removeCommaFrmInput(document.getElementById('txtTotalAmountPaidNTR').value)>0)
					{
						if(saveConfirm())
						{
							document.getElementById('cmdSaveOblig').disabled=true;
							document.getElementById('cmdClearOblig').disabled=true;
							document.getElementById("txtTotalAmountPaidNTR").value = removeCommaFrmInput(document.getElementById("txtTotalAmountPaidNTR").value);
							document.paymentRegForm.action="paymentRegistration.htm?actionCode=saveObligationDetail";
							document.paymentRegForm.submit();
						}
					}
					else
					{
						alert(totalAmtGreaterThenZero);
						return false;
					}
				}
				/*else
				{
					getErrTabToggle('TabView','2');	
					tabview_switch('TabView', '2');
					hideAndShowTable("errorDiv");
					document.getElementById('btnTbl').style.display="none";
				}*/
			}
			else
			{
				getErrTabToggle('TabView','2');	
				tabview_switch('TabView', '2');
				hideAndShowTable("errorDiv");
				document.getElementById('btnTbl').style.display="none";
			}
		}

	}

}

/*function totalAmountPaidNTR(val){	
	var amtPaid = document.getElementById('txtTotalAmountPaidNTR').value;
	document.getElementById('txtTotalAmountPaidNTR').value = convertToKenyanShillingFormatVal(amtPaid,true);

}*/
function onChangeCmbNtrPeriod(value){
	if (value == "-1" ||value == "" ||value == " "){
		return false ;
	}
	else{



		var date=value.split("-");
		var frmDate=date[0];
		var toDate=date[1];
		document.getElementById('hidObligationFromDate').value=frmDate;
		document.getElementById('hidObligationToDate').value=toDate;

	}

}

function getFistAndNextYearWebForNtr()
{
	document.getElementById('txtTotalAmountPaidNTR').value=0;
	document.getElementById('cmbTaxPeriod').disabled=false;
	var ntrValue = document.getElementById('cmbTaxSubHead').value;
	if(ntrValue =="-1" ||ntrValue == "" ||ntrValue ==" "){
		alert(validNTRType);
		document.getElementById('txtTotalAmountPaidNTR').value = 0;
		document.getElementById('cmbTaxPeriod').selectedIndex = 0;
		clear_table_data('NTRExciseDetailAddRowTable');
		clear_Page_data('NTRExciseDetailAddRowTable', '4');
		document.getElementById('cmbTaxPeriod').selectedIndex=0;
		document.getElementById('in_NTRExciseDetailAddRowTable_5').value=0;
		document.getElementById('in_NTRExciseDetailAddRowTable_4').selectedIndex=0;
		document.getElementById('paymentRegExciseLicenseDiv').style.display="none";
		modifyFlagExciseLicenseFee=0;
		commonModifyFlag=0;
		selectedExciseFlag=0;
		return false;
	}
	else
	{
		var noOfPrevYear=0;
		var noOfNextYear=1;
		var currentYear=true;

		if(ntrValue!=exciseObligationId)
		{
			document.getElementById('paymentRegExciseLicenseDiv').style.display="none";
			clear_table_data('NTRExciseDetailAddRowTable');
			clear_Page_data('NTRExciseDetailAddRowTable', '4');
			document.getElementById('cmbTaxPeriod').selectedIndex=0;
			document.getElementById('in_NTRExciseDetailAddRowTable_5').value=0;
			document.getElementById('in_NTRExciseDetailAddRowTable_4').selectedIndex=0;
			modifyFlagExciseLicenseFee=0;
			commonModifyFlag=0;
			selectedExciseFlag=0;
		}

		GetFistAndNextYearWeb.getFistAndNextYearWeb(noOfPrevYear,noOfNextYear,currentYear,{async:false,callback: function(data) {
			if(data!=null){
				if(data.length>1){
					dwr.util.removeAllOptions('cmbTaxPeriod');
					var oOption = document.createElement("OPTION"); 
					oOption.text="--Select--"; 
					oOption.value="-1"; 
					document.getElementById("cmbTaxPeriod").add(oOption); 
					dwr.util.addOptions('cmbTaxPeriod',data,'fromDate','toDate');
				}
				else{
					alert(errFetchingPeriod);
					//document.getElementById('cmbNtrPeriod').disabled=true;
				}
			}
		}});

	}


}
function clearFormNtr()
{
	var x = confirm (clrData);
	if(x)
	{
		requiredFieldsAfterCleaer();
		document.getElementById("CmbTaxPeriodLabelTd").style.display="none";
		document.getElementById("CmbTaxPeriodTd").style.display="none";
		document.getElementById("tdCmbTaxPeriodYear").style.display="none";
		document.getElementById("noTaxPeriodTd").style.display="";
		document.getElementById("noTaxPeriodTd1").style.display="";
		document.getElementById('paymentTaxObligForm').style.display='none';
		document.getElementById('paymentRegSpecObligationForm').style.display='none';
		document.getElementById('paymentRegNTRForm').style.display='none';
		document.getElementById('totalAmountPaidFieldSet').style.display='none';
		document.getElementById('paymentRegExciseLicenseDiv').style.display='none';
		document.getElementById('paymentRTGSFieldSet').style.display = 'none';
		document.getElementById('txtTotalAmountPaidNTR').value = 0;
		selectedExciseFlag=0;
		clear_table_data('NTRExciseDetailAddRowTable');
		clear_Page_data('NTRExciseDetailAddRowTable','4');
		document.getElementById('in_NTRExciseDetailAddRowTable_5').value=0;
		//document.getElementById('btnTbl').style.display='none';
		modifyFlagExciseLicenseFee=0;
		commonModifyFlag=0;
		tabview_switch('TabView',1);
		resetErrorList();
		hideTab('TabView',2);
		incError=0;	
		return true;
	}
	else
	{
		return false;
	}	
}

function validateNtrPeriodDtls(id)
{
	var rtnFlag;
	if(document.getElementById("paymentRegExciseLicenseDiv").style.display=='')
	{
		rtnFlag =validateFormFieldOnEvent(id,paymentRegNtrPeriodDetailsJson);
		{
			getErrTabToggle('TabView','2');	
			if(!rtnFlag)
			{
				tabview_switch('TabView', '2');
				hideAndShowTable("errorDiv");
				document.getElementById('btnTbl').style.display="none";
			}

			return rtnFlag;	
		}
	}
	else
	{
		rtnFlag = validateFormFieldOnEvent(id,paymentRegNtrPeriodDetailsJson);
		{
			getErrTabToggle('TabView','2');	
			if(!rtnFlag)
			{
				tabview_switch('TabView', '2');
				hideAndShowTable("errorDiv");
				document.getElementById('btnTbl').style.display="none";
			}

			return rtnFlag;	
		}
	}

}
function validateNtrTypeDtls(id)
{
	var rtnFlag;
	if(document.getElementById("paymentRegExciseLicenseDiv").style.display=='')
	{
		rtnFlag =validateFormFieldOnEvent(id,paymentRegExciseDetailsJson);
		{
			getErrTabToggle('TabView','2');	
			if(!rtnFlag)
			{
				tabview_switch('TabView', '2');
				hideAndShowTable("errorDiv");
				document.getElementById('btnTbl').style.display="none";
			}

			return rtnFlag;	
		}
	}
	else
	{
		rtnFlag = validateFormFieldOnEvent(id, paymentRegNtrDetailsJson);
		{
			getErrTabToggle('TabView','2');	
			if(!rtnFlag)
			{
				tabview_switch('TabView', '2');
				hideAndShowTable("errorDiv");
				document.getElementById('btnTbl').style.display="none";
			}

			return rtnFlag;	
		}
	}

}
function validateNtrDtls(id)
{
	var rtnFlag;
	if(document.getElementById("paymentRegExciseLicenseDiv").style.display=='')
	{
		rtnFlag =validateFormFieldOnEvent(id,paymentRegExciseDetailsJson,paymentRegNtrPaymentDetailsJson);
		{

			getErrTabToggle('TabView','2');	
			if(!rtnFlag)
			{
				document.getElementById('in_NTRExciseDetailAddRowTable_5').value="0";
				document.getElementById('tdExciseLicenseNo1').style.display='none';
				document.getElementById('tdExciseLicenseNo2').style.display='none';
				tabview_switch('TabView', '2');
				hideAndShowTable("errorDiv");
				document.getElementById('btnTbl').style.display="none";
			}

			return rtnFlag;	
		}
	}
	else
	{
		rtnFlag = validateFormFieldOnEvent(id,paymentRegNtrPaymentDetailsJson);
		{
			getErrTabToggle('TabView','2');	
			if(!rtnFlag)
			{
				tabview_switch('TabView', '2');
				hideAndShowTable("errorDiv");
				document.getElementById('btnTbl').style.display="none";
			}

			return rtnFlag;	
		}
	}

}

function isAlreadyPaid(taxPayedId,obligationId,fromDate,toDate)
{
	var flag= true;
	IsAlreadyPaid.isAlreadyPaid(taxPayedId,obligationId,fromDate,toDate,{async:false,callback:function(data)
		{
		if(data!=null)
		{
			if(data=="Y" ||data=="y")
			{
				alert(paymentMade);
				flag=false;
			}
			else

			{
				flag=true;
			}
		}

		}});
	return flag;
}
function validateExciseNoDtls(id)
{
	var rtnFlag;
	if(document.getElementById("in_NTRExciseDetailAddRowTable_5").value=="NEW")
	{
		rtnFlag =validateFormFieldOnEvent(id,ackLicenseNoJson);
		{

			getErrTabToggle('TabView','2');	
			if(!rtnFlag)
			{
				//document.getElementById('in_NTRExciseDetailAddRowTable_5').value="0";
				tabview_switch('TabView', '2');
				hideAndShowTable("errorDiv");
				document.getElementById('btnTbl').style.display="none";
			}

			return rtnFlag;	
		}
	}
	else
	{
		rtnFlag = validateFormFieldOnEvent(id,exciseLicenseNoJson);
		{
			getErrTabToggle('TabView','2');	
			if(!rtnFlag)
			{
				//	document.getElementById('in_NTRExciseDetailAddRowTable_5').value="0";
				tabview_switch('TabView', '2');
				hideAndShowTable("errorDiv");
				document.getElementById('btnTbl').style.display="none";
			}

			return rtnFlag;
		}
	}

}
function clearDetailsOfExciseFee()
{ 	
	var taxObligationValue= document.getElementById('cmbTaxSubHead')[specialTaxObligation].value;
	if(taxObligationValue ==exciseObligationId && selectedExciseFlag>0)
	{
		if(confirm (clearDataConfirm))
		{
			selectedExciseFlag=0;
			clear_Page_data('NTRExciseDetailAddRowTable','7');
			modifyFlagExciseLicenseFee=0;
			commonModifyFlag=0;
			document.getElementById('cmbTaxPeriod').selectedIndex=0;
			document.getElementById('in_NTRExciseDetailAddRowTable_4').selectedIndex=0; 
			clear_table_data('NTRExciseDetailAddRowTable');
			document.getElementById('in_NTRExciseDetailAddRowTable_6').value="";
			document.getElementById('in_NTRExciseDetailAddRowTable_5').value="";
			document.getElementById('in_NTRExciseDetailAddRowTable_7').value="";
			document.getElementById('txtTotalAmountPaidNTR').value=0; 
			flagPassFromIf="y";
			return false;
		}
		else
		{
			document.getElementById('cmbTaxSubHead').selectedIndex=specialTaxObligation;
			return true;
		}
	}
	selectedExciseFlag=0;
	selectedExciseFlag=0;
	clear_Page_data('NTRExciseDetailAddRowTable','7');
	modifyFlagExciseLicenseFee=0;
	commonModifyFlag=0;
	document.getElementById('cmbTaxPeriod').selectedIndex=0;
	document.getElementById('in_NTRExciseDetailAddRowTable_4').selectedIndex=0; 
	clear_table_data('NTRExciseDetailAddRowTable');
	document.getElementById('in_NTRExciseDetailAddRowTable_6').value="";
	document.getElementById('in_NTRExciseDetailAddRowTable_5').value="";
	document.getElementById('in_NTRExciseDetailAddRowTable_7').value="";
}