var agencyJson={"field":[{"name":"txtAgencyNo","rule":[{"required":"y","dispName":"Agency No  ","type":"onlyalphanumeric"}]},
                         //{"name":"txtTaxPayerPinAgency","rule":[{"required":"y","dispName":"Taxpayer PIN ","type":"onlyalphanumeric","maxLength":"11"}]} , 
                        /* {"name":"cmbTaxTypeAgency","rule":[{"required":"y","dispName":"Obligation Type"}*/
]};

function clearPreviousDtls()
{
	var tableData = document.getElementById('agencyFormDetailsTable');
	var rowCount = tableData.rows.length;
	
	for (var x=rowCount-1; x>0; x--) {
		tableData.deleteRow(x);
	
	} 			
	/*document.getElementById('txtTaxPayerFirstNameAgency').value="";		
	document.getElementById('txtTaxPayerFullAddrAgency').value="";
	document.getElementById('txtTaxPayerPinAgency').value="";
	var list1 = document.getElementById('cmbTaxTypeAgency');

	var j;
    for(j=list1.options.length-1;j>=1;j--)
    {
    	list1.remove(j);
    }
	
	var list = document.getElementById("cmbTaxPeriodAgency");

	var i;
    for(i=list.options.length-1;i>=1;i--)
    {
    	list.remove(i);
    }
*/
}
function onchangeTxtAgencyNo(obj){
	if(modifyFlagAGENCY==1)
	{
		alert(confirmModifyingOperation);
		return false;
	}
	clearPreviousDtls();
	
	var agencyNoticeNo = obj.value;
	if(agencyNoticeNo == null || agencyNoticeNo==""){
		alert(validAgencyNoticeNo);
		return false;
	}
	var taxpayerId = 0; 
	var agentId = 0;
	
	FetchAgencyNoticeDtlFromDNE.fetchAgencyNoticeDtlFromDNE(agencyNoticeNo,taxpayerId,agentId,DNE_NOTICE_TYPE_AGENCY, {async:false,callback:function(data){
		
		if(data != NULL &&  data != null){
			
			if(data.isDataAvailable == N_FLAG){
				
				if(data.isAgent == ERROR ||data.isAgent == NO_CALL_MADE){ // Handled Scenario : 1) if no call made from Controller to impl 2) impl to facade
					alert(errFetchingData);
				}
				else if(data.isAgent == NO_DETAILS_FOUND){// Handled Scenario : 1) call made to facade with invalid PIN
					alert(validAgencyNoticeNo);
				}
				else if(data.isAgent == "NOLIABILITY"){// Handled Scenario : 1) call made to facade with invalid PIN
					alert(noOutstandingLiability);
				}
				document.getElementById('txtAgencyNo').value="";
				/*document.getElementById('txtTaxPayerPinAgency').value = "";
				document.getElementById('hidTaxPayerIdAgncy').value = "";
				document.getElementById('txtTaxPayerFirstNameAgency').value="";
				document.getElementById('hidTaxPayerTelNoAgency').value="";
				document.getElementById('txtTaxPayerFullAddrAgency').value="";
				document.getElementById('cmbTaxTypeAgency').length=1;
				document.getElementById('cmbTaxTypeAgency').selectedIndex=0;
				document.getElementById('cmbTaxTypeAgency').disabled=true;*/
				document.getElementById('txtTotalAmountPaidOblig').value = 0;
				document.getElementById('hidAmtForAgencyAndAuction').value = 0;
				document.getElementById('txtAgencyNo').focus();
				return false;
				
			} else {
				/*var taxPayerId= document.getElementById('hidTaxPayerId').value;
				if(taxPayerId!=data.agentId){
					alert("Please enter valid notice number.");
					document.getElementById('txtAgencyNo').value="";
					return false;
				}*/
				document.getElementById('hidTaxPayerIdAgncy').value = data.taxPayerIdAgncy;
				/*document.getElementById('txtTaxPayerPinAgency').value = data.taxPayerPinAgency;
				document.getElementById('hidTaxPayerIdAgncy').value = data.taxPayerId;
				document.getElementById('txtTaxPayerFirstNameAgency').value=data.taxPayerFirstName;
				document.getElementById('hidTaxPayerTelNoAgency').value=data.mobileNumber;
				dwr.util.setValue('txtTaxPayerFullAddrAgency',data.taxPayerFullAddr);
				document.getElementById('cmbTaxTypeAgency').length=1;
				document.getElementById('cmbTaxTypeAgency').disabled=false;
				
				
				for(var i=0;i<data.allObligationsMapList.length;i++){
					var oOption=document.createElement("option");
					oOption.text=data.allObligationsMapList[i].value;
					oOption.value=data.allObligationsMapList[i].key;									
					document.getElementById("cmbTaxTypeAgency").add(oOption);
				}*/
				//document.getElementById('cmbTaxSubHead').value = document.getElementById("cmbTaxTypeAgency").value;
				//document.getElementById('cmbTaxSubHead').text = document.getElementById("cmbTaxTypeAgency").text;
				
//				document.getElementById('cmbTaxTypeAgency').selectedIndex=1;
//				document.getElementById('cmbTaxTypeAgency').disabled=true;
				//document.getElementById('txtTotalAmountPaidOblig').value =Math.ceil(data.amountPayable);
				document.getElementById('hidAmtForAgencyAndAuction').value =Math.ceil(data.amountPayable);
			
	            
				document.getElementById('periodListJSON').value =data.periodListJSON;
				//document.getElementById('camDefaulterList').value =data.camDefaulterList;
				document.getElementById('camDefaulterListJSON').value =data.camDefaulterListJSON;
				totalAmountPaid('txtTotalAmountPaidOblig'); 
				var amount=document.getElementById('hidAmtForAgencyAndAuction').value;
				document.getElementById('txtTotalAmountPaidOblig').value =Math.ceil(amount);
				document.getElementById('amountPayableForAgencyNotice').value =Math.ceil(amount);
				
			} 
		}
		else{
			alert(errFetchingData);
			
			document.getElementById('txtAgencyNo').value="";
			/*document.getElementById('txtTaxPayerPinAgency').value = "";
			document.getElementById('hidTaxPayerIdAgncy').value = "";
			document.getElementById('txtTaxPayerFirstNameAgency').value="";
			document.getElementById('hidTaxPayerTelNoAgency').value="";
			document.getElementById('txtTaxPayerFullAddrAgency').value="";
			document.getElementById('cmbTaxTypeAgency').length=1;
			document.getElementById('cmbTaxTypeAgency').selectedIndex=0;
			document.getElementById('cmbTaxTypeAgency').disabled=true;*/
			document.getElementById('txtTotalAmountPaidOblig').value = 0;
			document.getElementById('hidAmtForAgencyAndAuction').value = "";
			document.getElementById('txtAgencyNo').focus();
			return false;
		}

	}});
	return true;
}

function onchangeTaxPayerPinAgency(obj){
	var pin = trim(obj.value);
	if(validPIN(obj)){
		FetchTaxpayerDetailWithoutValidation.fetchTaxpayerDetailWithoutValidation(pin, {async:false,callback:function(data){
			if(data != NULL &&  data != null){ 
				if(data.isDataAvailable == N_FLAG){
					if(data.isAgent == ERROR ||data.isAgent == NO_CALL_MADE){ // Handled Scenario : 1) if no call made from Controller to impl 2) impl to facade
						alert(errFetchingData);
					}
					/*else if(data.isAgent == NO_DETAILS_FOUND){// Handled Scenario : 1) call made to facade with invalid PIN
						alert(validTpPIN);
					}
					document.getElementById('txtTaxPayerPinAgency').value="";
					document.getElementById('txtTaxPayerFirstNameAgency').value="";
					document.getElementById('txtTaxPayerFullAddrAgency').value="";
					return false;*/
				}
				if(data.taxPayerFirstName != null || data.taxPayerId != null){
					document.getElementById('hidTaxPayerIdAgncy').value = data.taxPayerId;
					document.getElementById('txtTaxPayerFirstNameAgency').value=data.taxPayerFirstName;
					document.getElementById('hidTaxPayerTelNoAgency').value=data.mobileNumber;
					dwr.util.setValue('txtTaxPayerFullAddrAgency',data.taxPayerFullAddr);
					document.getElementById('cmbTaxTypeAgency').length=1;
					document.getElementById('cmbTaxTypeAgency').disabled=false;
					for (var i=0; i < data.allObligationsMapList.length; i++) 
					{
						var oOption=document.createElement("option");
						optionId=data.allObligationsMapList[i].key;
						optionValue=data.allObligationsMapList[i].value;

						if(optionId!="IT" && optionId!="VAT" && optionId!="EXCISE")
						{
							
						}
						else
						{
							oOption.disabled=true;
							oOption.style.textAlign="center";
						}
						
						oOption.text=optionValue;
						oOption.value=optionId;
						oOption.title=optionValue;

						document.getElementById("cmbTaxTypeAgency").add(oOption);
					}
				}
				if(data.taxPayerFirstName == NULL || data.taxPayerFirstName == null){
					alert(validTpPIN);
					/*document.getElementById('txtTaxPayerPinAgency').value="";
					document.getElementById('txtTaxPayerFirstNameAgency').value="";
					document.getElementById('txtTaxPayerFullAddrAgency').value="";*/
					return false;
				}
			}
			else{
				alert(errFetchingData);
			/*	document.getElementById('txtTaxPayerPinAgency').value="";
				document.getElementById('txtTaxPayerFirstNameAgency').value="";
				document.getElementById('txtTaxPayerFullAddrAgency').value="";*/
				return false;
			}

		}});
		return true;
	}
	else{//if PIN format is not valid
		/*document.getElementById('txtTaxPayerPinAgency').value="";
		document.getElementById('txtTaxPayerFirstNameAgency').value="";
		document.getElementById('txtTaxPayerFullAddrAgency').value="";*/
		return false;
	}
}

function validateAgencyDtls(id)
{
	//resetErrorList();
/*	if(document.getElementById('txtTaxPayerPinAgency').value=='' || document.getElementById('txtTaxPayerPinAgency').value==null)
	{
		document.getElementById('txtTaxPayerFirstNameAgency').value='';
		document.getElementById('txtTaxPayerFullAddrAgency').value='';
	}*/
	var rtnFlag = validateFormFieldOnEvent(id,agencyJson);
	getErrTabToggle('TabView','2');
	if(!rtnFlag)
	{
		document.getElementById('txtAgencyNo').value="";
		/*document.getElementById('txtTaxPayerPinAgency').value = "";
		document.getElementById('hidTaxPayerIdAgncy').value = "";
		document.getElementById('txtTaxPayerFirstNameAgency').value="";
		document.getElementById('hidTaxPayerTelNoAgency').value="";
		document.getElementById('txtTaxPayerFullAddrAgency').value="";
		document.getElementById('cmbTaxTypeAgency').length=1;
		document.getElementById('cmbTaxTypeAgency').selectedIndex=0;
		document.getElementById('cmbTaxTypeAgency').disabled=true;*/
		document.getElementById('txtTotalAmountPaidOblig').value = 0;
		document.getElementById('txtAgencyNo').focus();
		tabview_switch('TabView', '2');
		hideAndShowTable("errorDiv");
		document.getElementById('btnTbl').style.display="none";
	}
	return rtnFlag;
	
	
}

function resetTaxPeriodCombo(){
	
	if(document.getElementById('cmbTaxHead').value==AGENCY_NOTICE){
	//var list = document.getElementById("cmbTaxPeriodAgency");

	var i;
    for(i=list.options.length-1;i>=1;i--)
    {
    	list.remove(i);
    }
	}
	else if (document.getElementById('cmbTaxHead').value==AUCTION_NOTICE)
		{
		var list = document.getElementById("cmbTaxPeriodAuction");

		var i;
	    for(i=list.options.length-1;i>=1;i--)
	    {
	    	list.remove(i);
	    }
		}
	}


function clearObligationDtlTbl(){
	document.getElementById('agencyFormDetailsTable').style.display='none';
	document.getElementById('showAgencyFormTable').style.display='none';
	
	document.getElementById('taxObligationTable').style.display='none';
	document.getElementById('showTaxObligationTable').style.display='none';
	document.getElementById('AgencyObligationDetailFieldSet').style.display='none';
	document.getElementById('txtTotalAmountPaidOblig').value == 0;
	document.getElementById('txtTotalAmountPaidOblig').readonly=false;
}

function onchangecmbTaxTypeAgency(obj)
{
	if(modifyFlagAGENCY==0){
	resetTaxPeriodCombo();
	
	}	
	clearObligationDtlTbl();
	setOtrParamForCSV();
	document.getElementById('hidObligationId').value=obj;
	var obligationId=obj;
	var noticeType=DNE_NOTICE_TYPE_AGENCY;
	var noticeNo=document.getElementById('txtAgencyNo').value;
	var agencyMapKey;
	var agencyMapValue;
	FetchAgencyNoticePeriodDtlFromDNE.fetchAgencyNoticePeriodDtlFromDNE(noticeNo,obligationId,noticeType, {async:false,callback:function(data){
if(data != NULL &&  data != null){
			
			if(data.isDataAvailable == N_FLAG){
				
				if(data.isAgent == ERROR ||data.isAgent == NO_CALL_MADE){ // Handled Scenario : 1) if no call made from Controller to impl 2) impl to facade
					alert(errFetchingData);
				}
				else if(data.isAgent == NO_DETAILS_FOUND){// Handled Scenario : 1) call made to facade with invalid PIN
					alert(validAgencyNoticeNo);
				}
				else if(data.isAgent == "NOLIABILITY"){// Handled Scenario : 1) call made to facade with invalid PIN
					alert(noOutstandingLiability);
				}
				document.getElementById('txtAgencyNo').value="";
				/*document.getElementById('txtTaxPayerPinAgency').value = "";
				document.getElementById('hidTaxPayerIdAgncy').value = "";
				document.getElementById('txtTaxPayerFirstNameAgency').value="";
				document.getElementById('hidTaxPayerTelNoAgency').value="";
				document.getElementById('txtTaxPayerFullAddrAgency').value="";
				document.getElementById('cmbTaxTypeAgency').length=1;
				document.getElementById('cmbTaxTypeAgency').selectedIndex=0;
				document.getElementById('cmbTaxTypeAgency').disabled=true;
*/				document.getElementById('txtTotalAmountPaidOblig').value = 0;
				document.getElementById('hidAmtForAgencyAndAuction').value = 0;
				document.getElementById('txtAgencyNo').focus();
				return false;
				
			} else {
				
			/*if (data != null && data != '') {
				//dwr.util.removeAllOptions('mfgPin');
				for(var j=0;j<data.length;j++)
					{
					var oOption=document.createElement("option");
					oOption.value=data[j].toDate;
					oOption.text=data[j].fromDate;					
					document.getElementById('cmbTaxPeriodAgency').add(oOption);
					//document.getElementById('hidcnfirmedDt').value = data[j].periodListJSON;
					
					
				for (var i=0; i < data.length; i++){
					agencyMapKey=oOption.value;
					agencyMapValue= data[j].periodListJSON;
					AllObligationsMap[agencyMapKey] = agencyMapValue;
				}
			}	
			} else {
				alert("Tax Period is  not Avialable.");
				
			}
				
				totalAmountPaid('txtTotalAmountPaidOblig'); 
				
			
		}
		else{
			alert(errFetchingData);
			
			document.getElementById('txtAgencyNo').value="";
			/*document.getElementById('txtTaxPayerPinAgency').value = "";
			document.getElementById('hidTaxPayerIdAgncy').value = "";
			document.getElementById('txtTaxPayerFirstNameAgency').value="";
			document.getElementById('hidTaxPayerTelNoAgency').value="";
			document.getElementById('txtTaxPayerFullAddrAgency').value="";
			document.getElementById('cmbTaxTypeAgency').length=1;
			document.getElementById('cmbTaxTypeAgency').selectedIndex=0;
			document.getElementById('cmbTaxTypeAgency').disabled=true;
			document.getElementById('txtTotalAmountPaidOblig').value = 0;
			document.getElementById('hidAmtForAgencyAndAuction').value = "";
			document.getElementById('txtAgencyNo').focus();
			return false;
		}*/
	}
}}});	
}




function onSelectliabilityRadioAgencyAuction(obj)
{
	//exciseAmtValidation(obj.value);
	document.getElementById('agencyFormDetailsTable').style.display = '';
	document.getElementById('AgencyObligationDetailFieldSet').style.display = ''; 
	document.getElementById('showAgencyFormTable').style.display = '';
	document.getElementById('showTaxObligationTable').style.display = 'none';
	var rowNum = obj.value;
	objValue=obj.value;
	cntrForHide=objValue;
	var i;
	if (obj.value != document.getElementById('hidRadioValue').value && document.getElementById('hidRadioValue').value != '')
	{
		document.getElementById('actualLiabilityAmount_'+document.getElementById('hidRadioValue').value).value = document.getElementById('hidActualLiabilityAmount').value;
		document.getElementById('actualLiabilityAmount_'+document.getElementById('hidRadioValue').value).readOnly = true;
		document.getElementById('actualLiabilityAmount_'+document.getElementById('hidRadioValue').value).className='readonlyInput form101_textfcurr_width textonlyRight';
		document.getElementById('imgShowIntrest_'+document.getElementById('hidRadioValue').value).src = "${pageContext.request.contextPath}/themes/images/plus-sign.jpg";
		document.getElementById('imgShowIntrest_'+document.getElementById('hidRadioValue').value).style.visibility = 'hidden';
		document.getElementById('imgShowPenalty_'+document.getElementById('hidRadioValue').value).src = "${pageContext.request.contextPath}/themes/images/plus-sign.jpg";
		document.getElementById('imgShowPenalty_'+document.getElementById('hidRadioValue').value).style.visibility = 'hidden';
		document.getElementById('imgShowFine_'+document.getElementById('hidRadioValue').value).src = "${pageContext.request.contextPath}/themes/images/plus-sign.jpg";
		document.getElementById('imgShowFine_'+document.getElementById('hidRadioValue').value).style.visibility = 'hidden';
		document.getElementById('imgShowPayment_'+document.getElementById('hidRadioValue').value).src = "${pageContext.request.contextPath}/themes/images/plus-sign.jpg";
		document.getElementById('imgShowPayment_'+document.getElementById('hidRadioValue').value).style.visibility = 'hidden';
		document.getElementById('hidRadioValue').value = objValue;
		document.getElementById('hidActualLiabilityAmount').value = document.getElementById('actualLiabilityAmount_' + objValue).value;
		document.getElementById('actualLiabilityAmount_'+objValue).readOnly = false;
		document.getElementById('actualLiabilityAmount_'+objValue).className='form101_textfcurr form101_textfcurr_width textonlyRight';
		document.getElementById('imgShowIntrest_'+objValue).style.visibility = 'visible';
		document.getElementById('imgShowPenalty_'+objValue).style.visibility = 'visible';
		document.getElementById('imgShowFine_'+objValue).style.visibility = 'visible';
		document.getElementById('imgShowPayment_'+objValue).style.visibility = 'visible';

	} 
	else{
		document.getElementById('actualLiabilityAmount_'+objValue).readOnly = false;
		document.getElementById('actualLiabilityAmount_'+objValue).className='form101_textfcurr form101_textfcurr_width textonlyRight';
		document.getElementById('hidRadioValue').value = objValue;
		document.getElementById('hidActualLiabilityAmount').value =  document.getElementById('actualLiabilityAmount_'+objValue).value;
		document.getElementById('imgShowIntrest_'+objValue).style.visibility = 'visible';
		document.getElementById('imgShowPenalty_'+objValue).style.visibility = 'visible';
		document.getElementById('imgShowFine_'+objValue).style.visibility = 'visible';
		document.getElementById('imgShowPayment_'+objValue).style.visibility = 'visible';
	}

	var rowRef = document.getElementById("LiabilityRow_" + rowNum);

	{
		var obligationId = (rowRef.getElementsByTagName("INPUT")[2].value);
		document.getElementById("in_agencyFormDetailsTable_7").value=obligationId;

		var fromDate = (rowRef.getElementsByTagName("INPUT")[3].value);
		document.getElementById("in_agencyFormDetailsTable_9").value=fromDate;

		var toDate = (rowRef.getElementsByTagName("INPUT")[4].value);
		document.getElementById("in_agencyFormDetailsTable_10").value=toDate;

		var hdrId = (rowRef.getElementsByTagName("INPUT")[5].value);
		document.getElementById("in_agencyFormDetailsTable_8").value=hdrId;

		var obligationType = (rowRef.getElementsByTagName("INPUT")[6].value);
		document.getElementById("in_agencyFormDetailsTable_11").value=obligationType;

		var confirmedDate=document.getElementById("confirmedDebtDate").value;
		document.getElementById("in_agencyFormDetailsTable_12").value=confirmedDate;
		
		var taxPeriodDisp = rowRef.getElementsByTagName("TD")[1].textContent;
		document.getElementById("hidTaxPeriod").value=taxPeriodDisp;
		document.getElementById("in_agencyFormDetailsTable_4").value=taxPeriodDisp;

		var obligationId=document.getElementById('cmbTaxSubHead').value;
				
			document.getElementById("CmbTaxPeriodLabelTd").style.display="none";
			document.getElementById("CmbTaxPeriodTd").style.display="none";
			document.getElementById("tdCmbTaxPeriodYear").style.display="none";
			document.getElementById("noTaxPeriodTd").style.display="none";
			document.getElementById("noTaxPeriodTd1").style.display="none";
			document.getElementById('cmbTaxPeriod').value=document.getElementById('in_agencyFormDetailsTable_9').value+"-"+document.getElementById('in_agencyFormDetailsTable_10').value;
			document.getElementById('cmbTaxPeriod').value = document.getElementById('cmbTaxPeriodAgency').value ;
			document.getElementById('cmbTaxPeriod').text = document.getElementById('cmbTaxPeriodAgency').text ;
			
		var taxPayable = rowRef.getElementsByTagName("INPUT")[1].value;
		
		taxPayable=	convertToKenyanShillingFormatValWithDecimal(parseInt(removeCommaFrmInput(taxPayable),10).toFixed(2),true);				
		document.getElementById("in_agencyFormDetailsTable_5").value=taxPayable;

		var amountPaid = (rowRef.getElementsByTagName("INPUT")[1].value);
		document.getElementById("hid_agencyFormDetailsTable_6").value=amountPaid;
		document.getElementById("in_agencyFormDetailsTable_6").value=document.getElementById("hid_agencyFormDetailsTable_6").value;
	}

	if(paymentDetailDTOArr[rowNum].paymentFineDtlDTOList!= null){
		var cntr = 0;
		var tabObj= document.getElementById("tblFineList");
		for(i = tabObj.rows.length; i >1 ;i--){
			tabObj.deleteRow(i -1);
		}
		
		for(i=0;i<paymentDetailDTOArr[rowNum].paymentFineDtlDTOList.length;i++){
			cntr = parseInt(cntr) + 1;
			var tabRow = tabObj.insertRow(tabObj.rows.length);
			var tabCell = new Array();
			for (var j=0;j<4;j++){
				tabCell[j] = tabRow.insertCell(j);
			}
			tabCell[0].innerHTML = cntr;
			tabCell[0].style.textAlign="center";
			tabCell[0].style.fontSize="11";

			tabCell[1].innerHTML = paymentDetailDTOArr[rowNum].paymentFineDtlDTOList[i].jvId;
			tabCell[1].style.textAlign="center";
			tabCell[1].style.fontSize="11";

			tabCell[2].innerHTML = paymentDetailDTOArr[rowNum].paymentFineDtlDTOList[i].imposeDt;
			tabCell[2].style.textAlign="center";
			tabCell[2].style.fontSize="11";

			tabCell[3].innerHTML = convertToKenyanShillingFormatValWithDecimal((paymentDetailDTOArr[rowNum].paymentFineDtlDTOList[i].amount).toFixed(2),true);
			tabCell[3].style.textAlign="right";
			tabCell[3].style.fontSize="11";
			
		}

	}

	if(paymentDetailDTOArr[rowNum].paymentInterestDtlDTOList!= null){
		var cntr = 0;
		var tabObj= document.getElementById("tblIntrestList");
		for(i = tabObj.rows.length; i >1 ;i--){
			tabObj.deleteRow(i -1);
		}
		for(i=0;i<paymentDetailDTOArr[rowNum].paymentInterestDtlDTOList.length;i++){
			cntr = parseInt(cntr) + 1;
			var tabRow = tabObj.insertRow(tabObj.rows.length);
			var tabCell = new Array();
			for (var j=0;j<4;j++){
				tabCell[j] = tabRow.insertCell(j);
			}
			tabCell[0].innerHTML = cntr;
			tabCell[0].style.textAlign="center";
			tabCell[0].style.fontSize="11";

			tabCell[1].innerHTML = convertToKenyanShillingFormatValWithDecimal((paymentDetailDTOArr[rowNum].paymentInterestDtlDTOList[i].liabilityAmount).toFixed(2),true);
			tabCell[1].style.textAlign="right";
			tabCell[1].style.fontSize="11";

			tabCell[2].innerHTML = paymentDetailDTOArr[rowNum].paymentInterestDtlDTOList[i].interestImposedDate;
			tabCell[2].style.textAlign="center";
			tabCell[2].style.fontSize="11";

			tabCell[3].innerHTML = convertToKenyanShillingFormatValWithDecimal((paymentDetailDTOArr[rowNum].paymentInterestDtlDTOList[i].interestAmount).toFixed(2),true);
			tabCell[3].style.textAlign="right";
			tabCell[3].style.fontSize="11";
		}
	}

	if(paymentDetailDTOArr[rowNum].paymentPenaltyDtlDTOList!= null){
		var cntr = 0;
		var tabObj= document.getElementById("tblPenaltyList");
		for(i = tabObj.rows.length; i >1 ;i--){
			tabObj.deleteRow(i -1);
		}

		for(i=0;i<paymentDetailDTOArr[rowNum].paymentPenaltyDtlDTOList.length;i++){
			cntr = parseInt(cntr) + 1;
			var tabRow = tabObj.insertRow(tabObj.rows.length);
			var tabCell = new Array();
			for (var j=0;j<4;j++){
				tabCell[j] = tabRow.insertCell(j);
			}
			tabCell[0].innerHTML = cntr;
			tabCell[0].style.textAlign="center";
			tabCell[0].style.fontSize="11";

			tabCell[1].innerHTML = paymentDetailDTOArr[rowNum].paymentPenaltyDtlDTOList[i].penaltySection;
			tabCell[1].style.textAlign="center";
			tabCell[1].style.fontSize="11";

			tabCell[2].innerHTML = paymentDetailDTOArr[rowNum].paymentPenaltyDtlDTOList[i].imposeDtStr;
			tabCell[2].style.textAlign="center";
			tabCell[2].style.fontSize="11";

			tabCell[3].innerHTML = convertToKenyanShillingFormatValWithDecimal((paymentDetailDTOArr[rowNum].paymentPenaltyDtlDTOList[i].amount).toFixed(2),true);
			tabCell[3].style.textAlign="right";
			tabCell[3].style.fontSize="11";
		}

	}

	if(paymentDetailDTOArr[rowNum].paymentTaxDtlDTOList!= null){
		var cntr = 0;
		var tabObj= document.getElementById("tblPaymentList");
		for(i = tabObj.rows.length; i >1 ;i--){
			tabObj.deleteRow(i -1);
		}

		for(i=0;i<paymentDetailDTOArr[rowNum].paymentTaxDtlDTOList.length;i++){
			cntr = parseInt(cntr) + 1;
			var tabRow = tabObj.insertRow(tabObj.rows.length);
			var tabCell = new Array();
			for (var j=0;j<3;j++){
				tabCell[j] = tabRow.insertCell(j);
			}
			tabCell[0].innerHTML = cntr;
			tabCell[0].style.textAlign="center";
			tabCell[0].style.fontSize="11";

			tabCell[1].innerHTML = paymentDetailDTOArr[rowNum].paymentTaxDtlDTOList[i].paymentDateStr;
			tabCell[1].style.textAlign="center";
			tabCell[1].style.fontSize="11";

			tabCell[2].innerHTML = convertToKenyanShillingFormatValWithDecimal((paymentDetailDTOArr[rowNum].paymentTaxDtlDTOList[i].amount).toFixed(2),true);
			tabCell[2].style.textAlign="right";
			tabCell[2].style.fontSize="11";
		}

	}
			document.getElementById("tblPenaltyList").style.display="none";	  
 			document.getElementById("tblIntrestList").style.display="none";	
 		 	document.getElementById('tblFineList').style.display="none";	
				document.getElementById("tblPaymentList").style.display="none";			 
}

function addDetailsOfAgencyAuction(row)
{
	  
	var checkDuplicateFlag = checkDuplicateForObligation(row,'agencyFormDetailsTable');
	if(document.getElementById('cmbTaxHead').value==AGENCY_NOTICE){
		if(document.getElementById("cmbTaxTypeAgency").selectedIndex!=0)
		{
			if(checkDuplicateFlag==false)
			{
				return false;
			}
			if( document.getElementById("LiablibilityTbl").rows.length==2)
			{
				objValue=0;
			}
			if(document.getElementById('liabilityRadio_'+objValue).checked==false)
			{
				alert(atleastOneTaxPeriod);
				return false;
			}

			if (document.getElementById('actualLiabilityAmount_'+objValue).value<='0')
			{
				alert(amtGreaterThanZero);
				return false;
			}
			else
			{
				if(document.getElementById('actualLiabilityAmount_0')!=null && document.getElementById('actualLiabilityAmount_0').value!='')
				{
					document.getElementById('in_agencyFormDetailsTable_6').value = document.getElementById('actualLiabilityAmount_0').value;
				}
				onChangeAmtToBePaidAgency();
				if(addConfirm('a_agencyFormDetailsTable'))
				{
					if(document.getElementById('a_agencyFormDetailsTable').innerHTML!="Modify")
					{
						addrow('agencyFormDetailsTable', '4', '10','3','validateDeleteRowIntoagencyFormDetailsTable','validateModifyRowIntoagencyFormDetailsTable','N','N');
					}
					else
					{
						return true;
					}
				}

			}
		}
		else
		{
			alert(validObligation);
			return false;
		}
		
	}
	
	else if (document.getElementById('cmbTaxHead').value==AUCTION_NOTICE)
		{

		if(document.getElementById("cmbTaxTypeAuction").selectedIndex!=0)
		{
			if(checkDuplicateFlag==false)
			{
				return false;
			}
			if( document.getElementById("LiablibilityTbl").rows.length==2)
			{
				objValue=0;
			}
			if(document.getElementById('liabilityRadio_'+objValue).checked==false)
			{
				alert(atleastOneTaxPeriod);
				return false;
			}

			if (document.getElementById('actualLiabilityAmount_'+objValue).value<='0')
			{
				alert(amtGreaterThanZero);
				return false;
			}
			else
			{
				if(document.getElementById('actualLiabilityAmount_0')!=null && document.getElementById('actualLiabilityAmount_0').value!='')
				{
					document.getElementById('in_agencyFormDetailsTable_6').value = document.getElementById('actualLiabilityAmount_0').value;
				}
				onChangeAmtToBePaidAgency();
				if(addConfirm('a_agencyFormDetailsTable'))
				{
					if(document.getElementById('a_agencyFormDetailsTable').innerHTML!="Modify")
					{
						addrow('agencyFormDetailsTable', '4', '10','3','validateDeleteRowIntoauctionFormDetailsTable','validateModifyRowIntoauctionFormDetailsTable','N','N');
					}
					else
					{
						return true;
					}
				}

			}
		}
		else
		{
			alert(validObligation);
			return false;
		}
		
	
		}
	
}


function validateDeleteRowIntoagencyFormDetailsTable(tab_str, rowno, cols) 
{
	if(deleteFlagAGENCY==1 && modifyFlagAGENCY==0)
	{
		var table = document.getElementById('agencyFormDetailsTable');  
		var	totalAmt = removeCommaFrmInput(document.getElementById('txtTotalAmountPaidOblig').value);
		var tempAmt = table.rows[rowno].cells[6].innerHTML;
		totalAmt = totalAmt - parseInt(removeCommaFrmInput(tempAmt),"10");
		document.getElementById('txtTotalAmountPaidOblig').value =  totalAmt;
		document.getElementById('txtTotalAmountPaidOblig').value = convertToKenyanShillingFormatVal(document.getElementById("txtTotalAmountPaidOblig").value, true);

		if(document.getElementById('cmbTaxSubHead').value==NSSF){
			selectedFlagNSSF=selectedFlagNSSF-1;
		}else{
			selectedFlagAGENCY=selectedFlagAGENCY-1;
		}
		deleteFlagTaxOblig = 0;
	}
	else
	{
		deleteFlagTaxOblig = 0;
	}
}
function validateModifyRowIntoagencyFormDetailsTable(tab_str, rowno, cols) 
{
	modifyFlagAGENCY = 1;
	commonModifyFlag=1;
	var obligationId;
	if(document.getElementById('cmbTaxSubHead').value!=NSSF){
		document.getElementById('cmbTaxHead').value=document.getElementById('in_agencyFormDetailsTable_11').value;
		commonModifyFlag=0;
		onChangeCmbTaxHead(document.getElementById('cmbTaxHead'));
		commonModifyFlag=1;
	}
	obligationId=document.getElementById('in_agencyFormDetailsTable_7').value;
	
	var list1 = document.getElementById("cmbTaxTypeAgency");

	var j;
    for(j=list1.options.length-1;j>=1;j--)
    {
    	list1.remove(j);
    }
    var oOption = document.createElement("option");
    oOption.text = document.getElementById('in_agencyFormDetailsTable_3').value;
    oOption.value = obligationId;
    oOption.selected="selected";
    document.getElementById("cmbTaxTypeAgency").add(oOption);
    
	//document.getElementById('cmbTaxPeriodAgency').value="";
	var list = document.getElementById("cmbTaxPeriodAgency");

	var i;
    for(i=list.options.length-1;i>=1;i--)
    {
    	list.remove(i);
    }
    var option = document.createElement("option");
    option.text = document.getElementById('in_agencyFormDetailsTable_4').value;
    option.value = document.getElementById('in_agencyFormDetailsTable_9').value+"-"+document.getElementById('in_agencyFormDetailsTable_10').value;
    option.selected="selected";
    document.getElementById("cmbTaxPeriodAgency").add(option);
    
    
	//document.getElementById('cmbTaxPeriodAgency').value=document.getElementById('in_agencyFormDetailsTable_9').value+"-"+document.getElementById('in_agencyFormDetailsTable_10').value;
	var taxPeriod=document.getElementById('cmbTaxPeriodAgency').value;
	onChangeOfTaxPeriodAgencyAuction(taxPeriod);

}


function beforeDeleteIntoagencyFormDetailsTable()
{
	if(modifyFlagAGENCY==1)
	{
		alert(confirmModifyingOperation);
		return false;
	}
}
function beforeAddIntoagencyFormDetailsTable(row)
{
	var checkDuplicateFlag = checkDuplicateForObligation(row,'agencyFormDetailsTable');

	startIndexValue=document.getElementById('startIndex').value;
	startIndexValue=startIndexValue-5;
	if(startIndexValue<0)
	{
		startIndexValue='0';
	}
	if(document.getElementById('cmbTaxHead').value==AGENCY_NOTICE){
	

		if(checkDuplicateFlag==false)
		{
			return false;
		}
		else
		{
			document.getElementById('agencyFormDetailsTable').style.display = "";
			var cmbTaxTypeIndex = document.getElementById('cmbTaxTypeAgency').selectedIndex;
			var taxTypeName =  document.getElementById('cmbTaxTypeAgency')[cmbTaxTypeIndex].text;
			document.getElementById('in_agencyFormDetailsTable_3').value = taxTypeName;	
			var obligationId=document.getElementById('cmbTaxTypeAgency').value;
			document.getElementById('in_agencyFormDetailsTable_11').value=document.getElementById('cmbTaxHead').value;
			if(obligationId==VATCode||obligationId==payeeCode||obligationId==exciseTaxOblCode || obligationId==NSSF)
			{				
				var taxPeriod = document.getElementById('cmbTaxPeriodAgency').selectedIndex;		
				var taxPeriodValue =document.getElementById('cmbTaxPeriodAgency')[taxPeriod].text;
				
				document.getElementById('in_agencyFormDetailsTable_4').value = taxPeriodValue;	
			}else{
				var taxPeriod = document.getElementById('cmbTaxPeriodAgency').selectedIndex;
				var taxPeriodValue =document.getElementById('cmbTaxPeriodAgency')[taxPeriod].text;
				document.getElementById('in_agencyFormDetailsTable_4').value = taxPeriodValue;	
			}
			return true;
		}

		
	}	
	else if(document.getElementById('cmbTaxHead').value==AUCTION_NOTICE)
		{

		

		if(checkDuplicateFlag==false)
		{
			return false;
		}
		else
		{
			document.getElementById('agencyFormDetailsTable').style.display = "";
			var cmbTaxTypeIndex = document.getElementById('cmbTaxTypeAuction').selectedIndex;
			var taxTypeName =  document.getElementById('cmbTaxTypeAuction')[cmbTaxTypeIndex].text;
			document.getElementById('in_agencyFormDetailsTable_3').value = taxTypeName;	
			var obligationId=document.getElementById('cmbTaxTypeAuction').value;
			document.getElementById('in_agencyFormDetailsTable_11').value=document.getElementById('cmbTaxHead').value;
			if(obligationId==VATCode||obligationId==payeeCode||obligationId==exciseTaxOblCode || obligationId==NSSF)
			{				
				var taxPeriod = document.getElementById('cmbTaxPeriodAuction').selectedIndex;		
				var taxPeriodValue =document.getElementById('cmbTaxPeriodAuction')[taxPeriod].text;
				
				document.getElementById('in_agencyFormDetailsTable_4').value = taxPeriodValue;	
			}else{
				var taxPeriod = document.getElementById('cmbTaxPeriodAuction').selectedIndex;
				var taxPeriodValue =document.getElementById('cmbTaxPeriodAuction')[taxPeriod].text;
				document.getElementById('in_agencyFormDetailsTable_4').value = taxPeriodValue;	
			}
			return true;
		}

		
	
		}
	
}


function afterAddIntoagencyFormDetailsTable()
{	
	if(document.getElementById('cmbTaxHead').value==AGENCY_NOTICE){
     var table1 =document.getElementById('agencyFormDetailsTable');
	var totalAmountPaid =removeCommaFrmInput( document.getElementById('txtTotalAmountPaidOblig').value);
//	var amountPaid = document.getElementById('actualLiabilityAmount_'+0).value;
	var amountPaid =removeCommaFrmInput( document.getElementById('hid_agencyFormDetailsTable_6').value);
	totalAmountPaid = parseInt(totalAmountPaid,10) + parseInt(amountPaid,10);
	document.getElementById('txtTotalAmountPaidOblig').value = convertToKenyanShillingFormatVal(Math.ceil(totalAmountPaid), true);
	document.getElementById('liabilityRadio_'+objValue).checked=false;
	document.getElementById('actualLiabilityAmount_'+ document.getElementById('hidRadioValue').value).value = document.getElementById('hidActualLiabilityAmount').value;
	document.getElementById('actualLiabilityAmount_'+ document.getElementById('hidRadioValue').value).readOnly = true;
	document.getElementById('actualLiabilityAmount_'+ document.getElementById('hidRadioValue').value).className='readonlyInput form101_textfcurr_width textonlyRight';
	document.getElementById('in_agencyFormDetailsTable_6').value = document.getElementById('actualLiabilityAmount_'+0).value;
	document.getElementById('imgShowIntrest_'+ document.getElementById('hidRadioValue').value).style.visibility = 'hidden';
	document.getElementById('imgShowPenalty_'+ document.getElementById('hidRadioValue').value).style.visibility = 'hidden';
	document.getElementById('imgShowFine_'+ document.getElementById('hidRadioValue').value).style.visibility = 'hidden';
	document.getElementById('imgShowPayment_'+ document.getElementById('hidRadioValue').value).style.visibility = 'hidden';
	document.getElementById('startIndex').value=startIndexValue;
	document.getElementById('showAgencyFormTable').style.display='none';
	
	document.getElementById('in_agencyFormDetailsTable_11').value=Obligation_Type_Tax;

	if(document.getElementById('cmbTaxTypeAgency').value==NSSF){
		selectedFlagNSSF=selectedFlagNSSF+1;
	}else{
		selectedFlagAGENCY=selectedFlagAGENCY+1;
	    }
	}
	else if(document.getElementById('cmbTaxHead').value==AUCTION_NOTICE){
	

	     var table1 =document.getElementById('agencyFormDetailsTable');
		var totalAmountPaid =removeCommaFrmInput( document.getElementById('txtTotalAmountPaidOblig').value);
	//	var amountPaid = document.getElementById('actualLiabilityAmount_'+0).value;
		var amountPaid =removeCommaFrmInput( document.getElementById('hid_agencyFormDetailsTable_6').value);
		totalAmountPaid = parseInt(totalAmountPaid,10) + parseInt(amountPaid,10);
		document.getElementById('txtTotalAmountPaidOblig').value = convertToKenyanShillingFormatVal(Math.ceil(totalAmountPaid), true);
		document.getElementById('liabilityRadio_'+objValue).checked=false;
		document.getElementById('actualLiabilityAmount_'+ document.getElementById('hidRadioValue').value).value = document.getElementById('hidActualLiabilityAmount').value;
		document.getElementById('actualLiabilityAmount_'+ document.getElementById('hidRadioValue').value).readOnly = true;
		document.getElementById('actualLiabilityAmount_'+ document.getElementById('hidRadioValue').value).className='readonlyInput form101_textfcurr_width textonlyRight';
		document.getElementById('in_agencyFormDetailsTable_6').value = document.getElementById('actualLiabilityAmount_'+0).value;
		document.getElementById('imgShowIntrest_'+ document.getElementById('hidRadioValue').value).style.visibility = 'hidden';
		document.getElementById('imgShowPenalty_'+ document.getElementById('hidRadioValue').value).style.visibility = 'hidden';
		document.getElementById('imgShowFine_'+ document.getElementById('hidRadioValue').value).style.visibility = 'hidden';
		document.getElementById('imgShowPayment_'+ document.getElementById('hidRadioValue').value).style.visibility = 'hidden';
		document.getElementById('startIndex').value=startIndexValue;
		document.getElementById('showAgencyFormTable').style.display='none';
		
		document.getElementById('in_agencyFormDetailsTable_11').value=Obligation_Type_Tax;

		if(document.getElementById('cmbTaxTypeAuction').value==NSSF){
			selectedFlagNSSF=selectedFlagNSSF+1;
		}else{
			selectedFlagAUCTION=selectedFlagAUCTION+1;
		    }
		
	}
	selectedLiablity=0;
	if(document.getElementById("tblFineList").style.display=="")
	{
		document.getElementById("tblFineList").style.display="none";
		changeImgNew(document.getElementById("imgShowFine_"+cntrForHide),3);
	}
	if(document.getElementById("tblIntrestList").style.display=="")
	{
		document.getElementById("tblIntrestList").style.display="none";
		changeImgNew(document.getElementById("imgShowIntrest_"+cntrForHide),1);
	}
	if(document.getElementById("tblPaymentList").style.display=="")
	{
		document.getElementById("tblPaymentList").style.display="none";
		changeImgNew(document.getElementById("imgShowPayment_"+cntrForHide),4);
	}
	if(document.getElementById("tblPenaltyList").style.display=="")
	{
		document.getElementById("tblPenaltyList").style.display="none";
		changeImgNew(document.getElementById("imgShowPenalty_"+cntrForHide),2);
	}

	document.getElementById("LiablibilityTbl").style.display = 'none';	
	document.getElementById("navigationFieldset").style.display = 'none';
        	

}

function afterDeleteIntoagencyFormDetailsTable()
{
	if(document.getElementById('cmbTaxHead').value==AUCTION_NOTICE){
		deleteFlagAUCTION = 1;
	}
	else if(document.getElementById('cmbTaxHead').value==AGENCY_NOTICE){
		deleteFlagAGENCY = 1;
	}
	
}

function afterModifyIntoagencyFormDetailsTable() 
{
	modifyFlagAGENCY = 0;
	commonModifyFlag=0;
	modifyFlagAUCTION = 0;
	var table= document.getElementById('agencyFormDetailsTable');
	document.getElementById('in_agencyFormDetailsTable_3').value = document.getElementById('hidObligationId').value; 
	var amnt=document.getElementById('actualLiabilityAmount_'+0).value;
	document.getElementById('actualLiabilityAmount_'+0).readOnly=true;
	document.getElementById('actualLiabilityAmount_'+0).className='readonlyInput form101_textfcurr_width textonlyRight';
	//var tmpAmt=removeCommaFrmInput(document.getElementById('hid_agencyFormDetailsTable_6').value);
	var tmpAmt=removeCommaFrmInput(document.getElementById('txtTotalAmountPaidOblig').value);
	document.getElementById('txtTotalAmountPaidOblig').value = document.getElementById('hidActualLiabilityAmount').value;
	document.getElementById('txtTotalAmountPaidOblig').readOnly=false;
	document.getElementById('txtTotalAmountPaidOblig').className='form101_textfcurr form101_textfcurr_width textonlyRight';
	if(document.all)
	{
		document.getElementById('txtTotalAmountPaidOblig').value=convertToKenyanShillingFormatVal(parseInt(tmpAmt,10)+parseInt(removeCommaFrmInput(table.rows[rowno].cells[6].innerText),"10")-parseInt(removeCommaFrmInput(document.getElementById('hid_agencyFormDetailsTable_6').value),10),true); 
	}
	else
	{
		document.getElementById('txtTotalAmountPaidOblig').value=convertToKenyanShillingFormatVal(parseInt(tmpAmt,10)+parseInt(removeCommaFrmInput(amnt),"10")-parseInt(removeCommaFrmInput(document.getElementById('hid_agencyFormDetailsTable_6').value),10),true);
	}
	document.getElementById('txtTotalAmountPaidOblig').readOnly=true; 
	document.getElementById('hid_agencyFormDetailsTable_6').value= document.getElementById('txtTotalAmountPaidOblig').value ;
	//table.rows[rowno].cells[6].innerText=document.getElementById('actualLiabilityAmount_'+0).value;
	document.getElementById('txtTotalAmountPaidOblig').className='readonlyInput form101_textfcurr_width textonlyRight';
	document.getElementById('imgShowFine_'+0).style.visibility = 'hidden';
	document.getElementById('imgShowPenalty_'+0).style.visibility = 'hidden';
	document.getElementById('imgShowIntrest_'+0).style.visibility = 'hidden';
	document.getElementById('imgShowPayment_'+0).style.visibility = 'hidden';  
	document.getElementById('tblPenaltyList').style.display = 'none'; 
	document.getElementById('tblFineList').style.display = 'none';
	document.getElementById('tblIntrestList').style.display = 'none';
	document.getElementById('tblPaymentList').style.display = 'none';
	document.getElementById("LiablibilityTbl").style.display = 'none';	
	document.getElementById("navigationFieldset").style.display = 'none';
	document.getElementById('showAgencyFormTable').style.display='none';
	document.getElementById('startIndex').value=startIndexValue;
}

function clearObligDetailsAgencyAuction()
{
	if(clear_table('agencyFormDetailsTable', '9'))
	{
		modifyFlagAGENCY=0;
		commonModifyFlag=0;
		clear_table_data("LiablibilityTbl");
		document.getElementById('navigationFieldset').style.display = 'none';
		document.getElementById('LiablibilityTbl').style.display = 'none';
		document.getElementById('navigationTable').style.display = 'none';
				
		var list = document.getElementById("cmbTaxPeriodAgency");

		var i;
	    for(i=list.options.length-1;i>=1;i--)
	    {
	    	list.remove(i);
	    }
		document.getElementById('cmbTaxPeriodAgency').selectedIndex='0';
		document.getElementById('cmbTaxTypeAgency').selectedIndex='0';		
		document.getElementById('showAgencyFormTable').style.display = 'none';

	}
}


function fetchObligationDTLAgency(taxPeriod)
{
	if(taxPeriod=='-1')
	{
		clear_table_data("tblPenaltyList");
		clear_table_data("tblFineList");
		clear_table_data("tblIntrestList");
		clear_table_data("tblPaymentList");
		clear_table_data("LiablibilityTbl");
		fetchTotalLiabilityDetailsWeb(true);
		return false;
	}
	
	var i;
	var taxPeriodArr = taxPeriod.split("-");
	var frmDate = taxPeriodArr[0];
	var toDate = taxPeriodArr[1];
	var obligationId=document.getElementById('cmbTaxSubHead').value;
	if(obligationId>5 && obligationId!=12){
		if(!(validateDateForobligRegDate(frmDate,obligationId))){
			alert("Taxperiod should be after Taxpayer Registration Date");
			document.getElementById('cmbTaxPeriod').selectedIndex=0;
			return false;
		}
	}
	var taxPayerId=document.getElementById('hidTaxPayerId').value;
	var paymentType=document.getElementById('cmbPaymentType').value;

	//values set for installment
	var taxPeriodDisp;			
	for(var i=0;i<document.getElementById("cmbTaxPeriod").options.length;i++){
		if(taxPeriod==document.getElementById('cmbTaxPeriod').options[i].value){
			taxPeriodDisp = document.getElementById('cmbTaxPeriod').options[i].text;
		}
	}
	document.getElementById('in_installmentTable_10').value = frmDate;
	document.getElementById('in_installmentTable_11').value = toDate;

	//values set for Advance Tax
	document.getElementById('in_advanceTaxTable_7').value = frmDate;
	document.getElementById('in_advanceTaxTable_8').value = toDate;
	
	
	if(paymentType == "TIP")
	{
		var taxPeriodArr = taxPeriod.split("-");
		var frmDate = taxPeriodArr[0];
		var toDate = taxPeriodArr[1];
		document.getElementById('hidObligationFromDate').value = frmDate;
		document.getElementById('hidObligationToDate').value = toDate;
		getFistAndNextYearWebForInstallment();
		return false;
	}
	if(paymentType == "TAP")
		{
			var obligationId=document.getElementById('cmbTaxSubHead').value;
			if(obligationId==VATCode||obligationId==payeeCode||obligationId==exciseTaxOblCode)
			{
				var taxPeriodArr = taxPeriod.split("-");
				var frmDate = taxPeriodArr[0];
				var toDate = taxPeriodArr[1];
				document.getElementById('hidObligationFromDate').value = frmDate;
				document.getElementById('hidObligationToDate').value = toDate;
				return false;
			}
			else
			{
				var taxPeriodArr = taxPeriod.split("-");
				var frmDate = taxPeriodArr[0];
				var toDate = taxPeriodArr[1];
				document.getElementById('hidObligationFromDate').value = frmDate;
				document.getElementById('hidObligationToDate').value = toDate;
				return false;
			}
		}
	

	else
		{
			document.getElementById('hidRadioValue').value=0;
			document.getElementById('txtTotalAmountPaidOblig').readOnly=true;
			document.getElementById('txtTotalAmountPaidOblig').className='readonlyInput form101_textfcurr_width textonlyRight';
			FetchObligationDetail.fetchObligationDetail(taxPayerId,obligationId,frmDate,toDate,{async:false,callback: function(data){
				if(data != null){	
					document.getElementById('hidPaymentDetailDTOList').value = data;
					var paymentDetailDtlDTOList = data;
					document.getElementById("navigationFieldset").style.display = '';
					document.getElementById("navigationTable").style.display = 'none';
					document.getElementById("LiablibilityTbl").style.display = '';
					document.getElementById("goBtn").disabled = true;
					if(paymentDetailDtlDTOList!= null){	
						document.getElementById('startIndex').value 		= paymentDetailDtlDTOList[0].startIndex;
						document.getElementById('endIndex').value 			= paymentDetailDtlDTOList[0].endIndex;
						document.getElementById('pageNo').value 			= paymentDetailDtlDTOList[0].pageNo;
						document.getElementById('totalRecords').value 		= paymentDetailDtlDTOList[0].totalRecords;
						document.getElementById('totalPagesId').value 		= paymentDetailDtlDTOList[0].totalPages;
						document.getElementById('recordsPerPage').value 	= paymentDetailDtlDTOList[0].recordsPerPage;
						document.getElementById('startIndexUpdate').value 	= paymentDetailDtlDTOList[0].startIndexUpdate;
						document.getElementById('oldStartIndex').value 		= paymentDetailDtlDTOList[0].oldStartIndex;
						document.getElementById('lastStartIndex').value 	= paymentDetailDtlDTOList[0].lastStartIndex;
						document.getElementById('maxResult').value 			= paymentDetailDtlDTOList[0].maxResult;
										
						document.getElementById('totalRecordsTd').innerHTML = "Total No. of Records " ;
						document.getElementById('totalRecordsTd').style.textAlign="center";
						document.getElementById('totalRecordsTd').style.fontWeight="bold";
						document.getElementById('totalRecordsTd').innerHTML+=document.getElementById('totalRecords').value;
						
						document.getElementById('recordsFromToTd').innerHTML = "Records From ";
						document.getElementById('recordsFromToTd').style.textAlign="center";
						document.getElementById('recordsFromToTd').style.fontWeight="bold";
						document.getElementById('recordsFromToTd').innerHTML+=document.getElementById('oldStartIndex').value+"";
						document.getElementById('recordsFromToTd').innerHTML+="To ";
						document.getElementById('recordsFromToTd').innerHTML+=document.getElementById('endIndex').value;

						document.getElementById('pageNoTd').innerHTML = "PageNo ";
						document.getElementById('pageNoTd').style.textAlign="center";
						document.getElementById('pageNoTd').style.fontWeight="bold";
						document.getElementById('pageNoTd').innerHTML+=document.getElementById('pageNo').value+"";
						document.getElementById('pageNoTd').innerHTML+="of ";
						document.getElementById('pageNoTd').innerHTML+=document.getElementById('totalPagesId').value;
						
						var cntr = 0;
						var tabObj = document.getElementById("LiablibilityTbl");
						for(var l = tabObj.rows.length; l >1 ;l--){
							tabObj.deleteRow(l -1);
						}
						for(var i=0;i<paymentDetailDtlDTOList.length;i++)
						{
							cntr = parseInt(cntr);
							var tabRow = tabObj.insertRow(tabObj.rows.length);
							tabRow.id="LiabilityRow_"+cntr;
							var tabCell = new Array();
							for (var j=0;j<14;j++){
								tabCell[j] = tabRow.insertCell(j);
							}
							
							var paymentDetailDTO = paymentDetailDtlDTOList[i];
							paymentDetailDTOArr[i] = paymentDetailDtlDTOList[i];
						
				            {
						 		var element = document.createElement('input');       
								element.type ='radio';
								element.onclick = function () {onSelectliabilityRadio(this);};
								element.value = cntr;
								element.id = 'liabilityRadio_'+cntr;
								element.name = "liabilityRadio";
								tabCell[0].appendChild(element);
						 		 
						 		tabCell[0].appendChild(element);

						 		tabCell[1].innerHTML = paymentDetailDTO.taxPeriod;
								tabCell[1].style.textAlign="center";
								tabCell[1].style.fontSize="11";

								tabCell[2].innerHTML = convertToKenyanShillingFormatValWithDecimal((paymentDetailDTO.actualPrincipalAmount).toFixed(2),true);
								tabCell[2].style.textAlign="right";
								tabCell[2].style.fontSize="11";
								var elementInterestImg = document.createElement("img");
								//Assign different attributes to the element.     
								elementInterestImg.src="${pageContext.request.contextPath}/themes/images/plus-sign.jpg";     
								elementInterestImg.name= "actualPrincipalAmount_img"+cntr;
								elementInterestImg.id= "actualPrincipalAmount_img"+cntr;
								elementInterestImg.style.visibility='hidden';
								tabCell[2].appendChild(elementInterestImg);
								
								tabCell[3].innerHTML = convertToKenyanShillingFormatValWithDecimal((paymentDetailDTO.actualFineAmount).toFixed(2),true);
								tabCell[3].style.textAlign="right";
								tabCell[3].style.fontSize="11";
								tabCell[3].innerHTML = tabCell[3].innerHTML +"  ";
								
								var elementFineImg = document.createElement("img");
								//Assign different attributes to the element.     
								elementFineImg.src="${pageContext.request.contextPath}/themes/images/plus-sign.jpg";     
								elementFineImg.alt="Click here to view Fine Detail";     
								elementFineImg.name= "imgShowFine_"+cntr;
								elementFineImg.id="imgShowFine_"+cntr;
								elementFineImg.onclick = function () {return changeImgNew(this,3);};
								elementFineImg.style.visibility='hidden';
								tabCell[3].appendChild(elementFineImg);

								tabCell[4].innerHTML = convertToKenyanShillingFormatValWithDecimal((paymentDetailDTO.actualPenaltyAmount).toFixed(2),true);
								tabCell[4].style.textAlign="right";
								tabCell[4].style.fontSize="11";
								tabCell[4].innerHTML = tabCell[4].innerHTML +"  ";
								      
								var elementPenaltyImg = document.createElement("img");
								//Assign different attributes to the element.     
								elementPenaltyImg.src= "${pageContext.request.contextPath}/themes/images/plus-sign.jpg";     
								elementPenaltyImg.alt= "Click here to view Penalty Detail";     
								elementPenaltyImg.name ="imgShowPenalty_"+cntr;
								elementPenaltyImg.id ="imgShowPenalty_"+cntr;
								elementPenaltyImg.onclick=function (){return changeImgNew(this,2);};
								elementPenaltyImg.style.visibility='hidden';
								tabCell[4].appendChild(elementPenaltyImg);

								
								tabCell[5].innerHTML = convertToKenyanShillingFormatValWithDecimal((paymentDetailDTO.actualInterestAmount).toFixed(2),true);
								tabCell[5].style.textAlign="right";
								tabCell[5].style.fontSize="11";
								tabCell[5].innerHTML = tabCell[5].innerHTML +"  ";

								var elementInterestImg = document.createElement("img");
								//Assign different attributes to the element.     
								elementInterestImg.src= "${pageContext.request.contextPath}/themes/images/plus-sign.jpg";     
								elementInterestImg.alt= "Click here to view Intrest Detail";     
								elementInterestImg.name= "imgShowIntrest_"+cntr;
								elementInterestImg.id="imgShowIntrest_"+cntr;
								elementInterestImg.onclick=function (){return changeImgNew(this,1);};
								elementInterestImg.style.visibility='hidden';
								tabCell[5].appendChild(elementInterestImg);

								tabCell[6].innerHTML = convertToKenyanShillingFormatValWithDecimal((paymentDetailDTO.actualPaymentAmount).toFixed(2),true);
								tabCell[6].style.textAlign="right";
								tabCell[6].style.fontSize="11";
								tabCell[6].innerHTML = tabCell[6].innerHTML +"  ";

								var elementPenaltyImg = document.createElement("img");
								//Assign different attributes to the element.     
								elementPenaltyImg.src= "${pageContext.request.contextPath}/themes/images/plus-sign.jpg";     
								elementPenaltyImg.alt= "Click here to view payment Detail"; 
								elementPenaltyImg.name= "imgShowPayment_"+cntr;
								elementPenaltyImg.id= "imgShowPayment_"+cntr;
								elementPenaltyImg.onclick=function(){return changeImgNew(this,4);};
								elementPenaltyImg.style.visibility='hidden';
								tabCell[6].appendChild(elementPenaltyImg);
								tabCell[6].style.display="none";

								tabCell[7].innerHTML = convertToKenyanShillingFormatValWithDecimal((paymentDetailDTO.actualLiabilityAmount).toFixed(2),true); 
								tabCell[7].style.textAlign="right";
								tabCell[7].style.fontSize="11";

								
								var elementTextBox = document.createElement("input");
								elementTextBox.type ='text';
								elementTextBox.onchange = function () {if(checkNssfAmount()){onChangeAmtToBePaidAgency()};};
								elementTextBox.name='actualLiabilityAmount_'+cntr;
								elementTextBox.id='actualLiabilityAmount_'+cntr;
								
								if(paymentDetailDTO.actualLiabilityAmount>0)
								{
									elementTextBox.setAttribute("value", convertToKenyanShillingFormatVal(Math.ceil((paymentDetailDTO.actualLiabilityAmount).toFixed(2)),true));
								}
								else
								{
									elementTextBox.setAttribute("value", "0");
								}     
								elementTextBox.readOnly="readOnly";
								elementTextBox.className='readonlyInput form101_textfcurr_width textonlyRight';
								elementTextBox.setAttribute('maxlength', 15);
								elementTextBox.style.textAlign = 'right'; 
								tabCell[8].appendChild(elementTextBox);
								tabCell[8].style.textAlign="right";
								tabCell[8].style.fontSize="11";
			                 }

					      var element = document.createElement('input');
		  		          element.type = 'hidden';
		                  element.value =  paymentDetailDTO.obligationId;
		                  element.width = "0%";
		                  tabCell[9].appendChild(element);
		                  tabCell[9].style.display = "none";

		                  var element = document.createElement('input');
		  		          element.type = 'hidden';
		                  element.value =  paymentDetailDTO.fromDate;
		                  element.width = "0%";
		                  tabCell[10].appendChild(element);
		                  tabCell[10].style.display = "none";

		                  var element = document.createElement('input');
		  		          element.type = 'hidden';
		                  element.value =  paymentDetailDTO.toDate;
		                  element.width = "0%";
		                  tabCell[11].appendChild(element);
		                  tabCell[11].style.display = "none";

		                  var element = document.createElement('input');
		  		          element.type = 'hidden';
		                  element.value =  paymentDetailDTO.taxLiabilityhdrId;
		                  element.width = "0%";
		                  tabCell[12].appendChild(element);
		                  tabCell[12].style.display = "none";

		                  var element = document.createElement('input');
		  		          element.type = 'hidden';
		                  element.value =  "TAX";
		                  element.width = "0%";
		                  tabCell[13].appendChild(element);
		                  tabCell[13].style.display = "none";
		                  var  tabObj1=document.getElementById('agencyFormDetailsTable');
		  				if(tabObj1.rows.length==1)
		  				{
		  				}
		  				else
		  				{
		  					for (var i=1, n=tabObj1.rows.length; i <n; i++) 
		  					{  
		  						if((document.getElementById('id_agencyFormDetailsTable_'+i+'_2').innerHTML)=="Modifying")
		  						{
			  						document.getElementById('showAgencyFormTable').style.display='';
		  							document.getElementById('actualLiabilityAmount_'+cntr).readOnly = false;
		  							document.getElementById('actualLiabilityAmount_'+cntr).className='form101_textfcurr form101_textfcurr_width textonlyRight';
		  							document.getElementById('hidRadioValue').value =cntr;
		  							document.getElementById('hidActualLiabilityAmount').value = document.getElementById('actualLiabilityAmount_' + cntr).value;
		  							document.getElementById('imgShowIntrest_' + cntr).style.visibility = 'visible';
		  							document.getElementById('imgShowPenalty_' + cntr).style.visibility = 'visible';
		  							document.getElementById('imgShowFine_' + cntr).style.visibility = 'visible';
		  							document.getElementById('imgShowPayment_' + cntr).style.visibility = 'visible';

		  							document.getElementById('in_agencyFormDetailsTable_11').value=document.getElementById('cmbTaxHead').value;
		  							document.getElementById('AgencyObligationDetailFieldSet').style.display = '';
		  							document.getElementById('showAgencyFormTable').style.display = ''; 
		  							var hidActualLiabilityAmount=removeCommaFrmInput(document.getElementById('hidActualLiabilityAmount').value);
		  							document.getElementById('in_agencyFormDetailsTable_5').value = convertToKenyanShillingFormatValWithDecimal(parseInt(hidActualLiabilityAmount,10).toFixed(2),true);
		  							document.getElementById('in_agencyFormDetailsTable_6').value = document.getElementById('actualLiabilityAmount_' + cntr).value;
		  							
		  							document.getElementById('liabilityRadio_'+cntr).checked=true;
		  							document.getElementById('actualLiabilityAmount_'+cntr).readOnly=false;
		  							document.getElementById('actualLiabilityAmount_'+cntr).className='form101_textfcurr form101_textfcurr_width textonlyRight';
		  							if(document.all)
			  						{
			  							document.getElementById('actualLiabilityAmount_'+cntr).value= tabObj1.rows[i].cells[6].innerText;
		  							document.getElementById('hid_agencyFormDetailsTable_6').value= tabObj1.rows[i].cells[6].innerText; 
		  							document.getElementById('in_agencyFormDetailsTable_6').value=tabObj1.rows[i].cells[6].innerText; 
			  						}
		  							else
			  						{
		  								document.getElementById('actualLiabilityAmount_'+cntr).value= tabObj1.rows[i].cells[6].textContent;
			  							document.getElementById('hid_agencyFormDetailsTable_6').value= tabObj1.rows[i].cells[6].textContent; 
			  							document.getElementById('in_agencyFormDetailsTable_6').value=tabObj1.rows[i].cells[6].textContent;
			  						}
		  							return true;
		  						}
		  					}
		  				
		  				}
		  				document.getElementById('liabilityRadio_'+cntr).checked=true;
						onSelectliabilityRadio(document.getElementById('liabilityRadio_'+cntr));
						  cntr = cntr+1;
						}
					}
					validatePaginationLast();
					validatePaginationFirst();
				}
			}});
			
		return true;
		
	}
	
}


function onChangeAmtToBePaidAgency()
{
	 if (document.getElementById('cmbTaxHead').value==AGENCY_NOTICE){
	if(modifyFlagAGENCY==1)
	{
		objValue=0;
	}
	var val=document.getElementById('actualLiabilityAmount_'+objValue).value;
	var str = "0123456789,";
	for(var j = 0; j < val.length; j++)
	{
		if(str.indexOf(val.charAt(j)) == -1)
		{
			val = "";
			document.getElementById('actualLiabilityAmount_'+objValue).value="0";
			alert(enterNumeric);
			return false;
		}
	}
	document.getElementById('actualLiabilityAmount_'+objValue).value=convertToKenyanShillingFormatVal(removeCommaFrmInput(val), true);

	document.getElementById('in_agencyFormDetailsTable_6').value =convertToKenyanShillingFormatVal(removeCommaFrmInput(val), true);
	if(modifyFlagAGENCY!=1)
	{
		document.getElementById('hid_agencyFormDetailsTable_6').value=document.getElementById('in_agencyFormDetailsTable_6').value;
	}
}
	 else if (document.getElementById('cmbTaxHead').value==AUCTION_NOTICE){
			if(modifyFlagAUCTION==1)
			{
				objValue=0;
			}
			var val=document.getElementById('actualLiabilityAmount_'+objValue).value;
			var str = "0123456789,";
			for(var j = 0; j < val.length; j++)
			{
				if(str.indexOf(val.charAt(j)) == -1)
				{
					val = "";
					document.getElementById('actualLiabilityAmount_'+objValue).value="0";
					alert(enterNumeric);
					return false;
				}
			}
			document.getElementById('actualLiabilityAmount_'+objValue).value=convertToKenyanShillingFormatVal(removeCommaFrmInput(val), true);

			document.getElementById('in_agencyFormDetailsTable_6').value =convertToKenyanShillingFormatVal(removeCommaFrmInput(val), true);
			if(modifyFlagAUCTION!=1)
			{
				document.getElementById('hid_agencyFormDetailsTable_6').value=document.getElementById('in_agencyFormDetailsTable_6').value;
			}
		}
	 
	
}

//added for allowing partial payment in Agency notice as specified in mail 

function onChangeTaxPeriodAgencyNotice(){
	var amount=document.getElementById('hidAmtForAgencyAndAuction').value;
	document.getElementById('txtTotalAmountPaidOblig').value =Math.ceil(amount);
	document.getElementById('amountPayableForAgencyNotice').value =Math.ceil(amount);
}

function onChangeAmountToBePaidAgencyNotice(amountToBePaid){
	document.getElementById('txtTotalAmountPaidOblig').value =Math.ceil(amountToBePaid);
	if(parseFloat(document.getElementById('amountPayableForAgencyNotice').value)<parseFloat(amountToBePaid)){
		alert("Amount payable should be less than equal to amount to be paid.");
		document.getElementById('amountToBePaidForAgencyNotice').value=0;

		return false;
	}
	
}

function savePaymentDetailAgencyNotice(){
	
	
	
		
			if(removeCommaFrmInput(document.getElementById("txtTotalAmountPaidOblig").value)>0)
			{
				
				if(saveConfirm())
				{
					document.getElementById('cmdSaveOblig').disabled=true;
					document.getElementById('cmdClearOblig').disabled=true;
					document.getElementById("txtTotalAmountPaidOblig").value = removeCommaFrmInput(document.getElementById("txtTotalAmountPaidOblig").value);
					document.paymentRegForm.action="paymentRegistration.htm?actionCode=saveObligationDetail";
					document.paymentRegForm.submit();
				}
			}
			else
			{
				alert(totalAmtGreaterThenZero);
				return false;
			}
		}
		
	


	

