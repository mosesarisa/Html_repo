
var selectedFlagMinimum=0;
var deleteFlagMinimum = 0;
var modifyFlagMinimum=0;
var amtToPaidMinimum=0;
var TotalAmtToPaidMinimum=0;
var minimumJson={"field":[{"name":"in_MinimumTable_5","rule":[{"required":"y","dispName":"Amount Paid","type":"amount"}]},
                              {"name":"in_MinimumTable_7","rule":[{"required":"n","dispName":"Estimated Tax Value ","type":"amount"}]}
]};

var monthNames = new Array("Jan","Jan", "Feb", "Mar",  "Apr", "May", "Jun", "Jul", "Aug", "Sep",  "Oct", "Nov", "Dec");

function beforeAddIntoMinimumTable(row)
{

	var checkDuplicateFlag = checkDuplicateForObligation(row,'MinimumTable');
	if(checkDuplicateFlag==false)
	{
		return false;
	}
	else
	{
		document.getElementById('in_MinimumTable_12').value = Obligation_Type_Tax;
		var taxPeriod=document.getElementById('cmbTaxPeriod').selectedIndex;
		var taxPeriodValue= document.getElementById('cmbTaxPeriod')[taxPeriod].text;
		document.getElementById('in_MinimumTable_4').value = taxPeriodValue;
		document.getElementById('in_MinimumTable_14').value=document.getElementById('cmbTaxPeriod').value;
		document.getElementById('in_MinimumTable_8').value=document.getElementById('cmbTaxSubHead').value;
		TotalAmtToPaidMinimum=removeCommaFrmInput(document.getElementById('in_MinimumTable_5').value);
		var taxTypeIndex = document.getElementById('cmbTaxSubHead').selectedIndex;
		var taxTypeName =  document.getElementById('cmbTaxSubHead')[taxTypeIndex].text;
		document.getElementById('in_MinimumTable_3').value = taxTypeName;
	}
}


function afterAddIntoMinimumTable()
{
	document.getElementById('in_MinimumTable_12').value = Obligation_Type_Tax;
	document.getElementById('in_MinimumTable_9').value = 0;
	document.getElementById('in_MinimumTable_7').value=0;
	document.getElementById('in_MinimumTable_5').value="";
	var tmpAmtToPaid=removeCommaFrmInput(document.getElementById('txtTotalAmountPaidOblig').value);
	document.getElementById('txtTotalAmountPaidOblig').value=convertToKenyanShillingFormatVal(removeCommaFrmInput(parseInt(tmpAmtToPaid,10)+parseInt(TotalAmtToPaidMinimum,10)),true);
	selectedFlagMinimum=selectedFlagMinimum+1;
}

function addValidationMinimumTax(row)
{/*
	resetErrorList();
	if(validateFormFields(paymentRegTaxHeadJson,paymentRegTaxDetailsJson,paymentRegPmtTtypeJson))
	{
		var checkDuplicateFlag = true//checkDuplicateForObligation(row,'minimumTaxTable');
		if(checkDuplicateFlag==false)
		{
			return false;
		}
		if(removeCommaFrmInput(document.getElementById('in_MinimumTable_4').value)<=0)
		{
			alert(amtPaid);
			return false;
		}
		if(addConfirm('a_minimumTaxTable'))
		{
			if(document.getElementById('a_minimumTaxTable').innerHTML!="Modify")
			{
				addrow('minimumTaxTable', '2', '9','3','validateDeleteRowIntominimumTaxTable','validateModifyRowIntominimumTaxTable','N','N');
			}
			else 
			{
				return true;
			}
		}
	}
	else
	{
		getErrTabToggle('TabView','2');	
		tabview_switch('TabView', '2');
		hideAndShowTable("errorDiv");
		document.getElementById('btnTbl').style.display="none";
		return false;
	}
*/
}

function beforeDeleteIntoMinimumTable()
{
	if(modifyFlagMinimum==1)
	{
		alert(confirmModifyingOperation);
		return false;
	}
}

function afterDeleteIntoMinimumTable()
{
	deleteFlagMinimum = 1;
	selectedFlagAdvanceTax = selectedFlagAdvanceTax -1;
}

function validateDeleteRowIntoMinimumTable(tab_str, rowno, cols) 
{
	if(deleteFlagMinimum==1 && modifyFlagMinimum==0)
	{
		var table = document.getElementById('MinimumTable');
		totalAmt = removeCommaFrmInput(document.getElementById('txtTotalAmountPaidOblig').value);
		var tempAmt = table.rows[rowno].cells[5].innerHTML;
		totalAmt =  parseInt(totalAmt,10) - parseInt(removeCommaFrmInput(tempAmt),10);
		document.getElementById('txtTotalAmountPaidOblig').value = convertToKenyanShillingFormatVal(totalAmt, true);
		deleteFlagMinimum = 0;
	}
	else
	{
		deleteFlagMinimum = 0;
	}
}
function beforeModifyIntoMinimumTable(row) 
{
	if(addMinimum())
	{
		var checkDuplicateFlag = addMinimum(row);
		if(checkDuplicateFlag==false)
		{
			return false;
		}
		else
		{
			var taxPeriod = document.getElementById('cmbTaxPeriod').selectedIndex;
			var taxPeriodYear =document.getElementById('cmbTaxPeriod')[taxPeriod].text;
			document.getElementById('in_advanceTaxTable_4').value=taxPeriodYear;
			document.getElementById('in_MinimumTablee_14').value=document.getElementById('cmbTaxPeriod').value;
			document.getElementById('in_MinimumTable_8').value=document.getElementById('cmbTaxSubHead').value;
			totalAmt=removeCommaFrmInput(document.getElementById('txtTotalAmountPaidOblig').value);
		}
	}
	else
	{
		return false;
	}
}
function afterModifyIntoMinimumTable() 
{
	modifyFlagMinimum = 0;
	commonModifyFlag=0;
	var table = document.getElementById('MinimumTable');  
	var modifyAmt;
	if(document.all)
	{
		modifyAmt=table.rows[rowno].cells[5].innerText;
	}
	else
	{
		modifyAmt=table.rows[rowno].cells[5].textContent;
	}
	totalAmt = parseInt(removeCommaFrmInput(totalAmt),10) + parseInt(removeCommaFrmInput(modifyAmt),10) - parseInt(removeCommaFrmInput(TotalAmtToPaidMinimum),10);
	document.getElementById('txtTotalAmountPaidOblig').value = convertToKenyanShillingFormatVal(totalAmt, true);
	document.getElementById('cmbTaxPeriod').selectedIndex='0';
	document.getElementById('cmbTaxPeriodMonth').selectedIndex='0';
	document.getElementById('cmbTaxPeriodMonth').disabled=true;
	document.getElementById('cmbTaxPeriodYear').selectedIndex='0';
	document.getElementById('cmbTaxSubHead').selectedIndex='0';
	document.getElementById('in_MinimumTable_6').selectedIndex=0;//inst num
	document.getElementById('in_MinimumTable_13').selectedIndex=0;//prediction base
	document.getElementById('in_MinimumTable_12').value = Obligation_Type_Tax;
	document.getElementById('in_MinimumTable_9').value = 0;
	document.getElementById('in_MinimumTable_7').value=0;
	document.getElementById('in_MinimumTable_5').value="";
	document.getElementById('CmbTaxPeriodTd').style.display = 'none';
	document.getElementById('tdCmbTaxPeriod').style.display = 'none';
	document.getElementById('noTaxPeriodTd').style.display = '';
	document.getElementById('noTaxPeriodTd1').style.display = '';
}


function validateModifyRowIntoMinimumTable(tab_str, rowno, cols) 
{
	modifyFlagMinimum=1;
	commonModifyFlag=1;
	document.getElementById('cmbTaxSubHead').value=document.getElementById('in_MinimumTable_8').value;
	fetchTaxPeriod();
	TotalAmtToPaidMinimum=removeCommaFrmInput(document.getElementById('in_MinimumTable_5').value);
	document.getElementById('CmbTaxPeriodTd').style.display = '';
	document.getElementById('tdCmbTaxPeriod').style.display = '';
	document.getElementById('tdCmbTaxPeriodMonth').style.display = 'none';
	document.getElementById('tdCmbTaxPeriodYear').style.display = 'none';
	document.getElementById('CmbTaxPeriodMonthLabelTd').style.display = 'none';
	document.getElementById('CmbTaxPeriodYearLabelTd').style.display = 'none';
	document.getElementById('cmbTaxPeriod').value=document.getElementById('in_MinimumTable_14').value;
}

function clearMinimumDetails()
{
	if(clear_table('MinimumTable', '12'))
	{
		document.getElementById('cmbTaxPeriod').selectedIndex='0';
		//document.getElementById('cmbTaxPeriodMonth').selectedIndex='0';
		//document.getElementById('cmbTaxPeriodMonth').disabled=true;
		//document.getElementById('cmbTaxPeriodYear').selectedIndex='0';
		//document.getElementById('in_MinimumTable_6').selectedIndex=0;//inst num
		//document.getElementById('in_MinimumTable_13').selectedIndex=0;//prediction base
		//document.getElementById('cmbTaxSubHead').selectedIndex='0';
		modifyFlagMinimum=0;
		commonModifyFlag=0;
	}
}
function addMinimum(row)
{
	resetErrorList();
	var taxPeriodValue = document.getElementById('cmbTaxPeriod').value;
	var taxPeriodValueArr =taxPeriodValue.split('-');
	document.getElementById('in_MinimumTable_10').value = taxPeriodValueArr[0];
	document.getElementById('in_MinimumTable_11').value = taxPeriodValueArr[1];
	document.getElementById('in_MinimumTable_4').value = taxPeriodValue;
	// var toDate=taxPeriodValueArr[1];
	//onChangeCmbTaxPriod(document.getElementById('cmbTaxPeriod'));
	if(validateFormFields(paymentRegTaxHeadJson,paymentRegTaxDetailsJson,paymentRegPmtTtypeJson))
	{
		if(validateFormFields(paymentRegTaxPeriodDetailsJson))
		{
			//if(validateFormFields(minimumJson))
			//{
				var checkDuplicateFlag = true //checkDuplicateForObligation(row,'MinimumTable');
								
				if(checkDuplicateFlag==false)
				{
					return false;
				}
				if (document.getElementById('in_MinimumTable_5').value<='0')
				{
					alert(paidAmtMoreThanZero);
					return false;
				}
				else
				{
					if(addConfirm('a_MinimumTable'))
					{
						if(document.getElementById('a_MinimumTable').innerHTML!="Modify")
						{
							addrow('MinimumTable', '3', '12','4','validateDeleteRowIntoMinimumTable','validateModifyRowIntoMinimumTable','N','N');
						}
						else
						{
							return true;
						}
					}
				}
			}
			else
			{
				//document.getElementById('in_MinimumTable_13').selectedIndex=0;
				getErrTabToggle('TabView','2');	
				tabview_switch('TabView', '2');
				hideAndShowTable("errorDiv");
				document.getElementById('btnTbl').style.display="none";
				return false;
			}
	}

	else
	{
		//document.getElementById('in_MinimumTable_13').selectedIndex=0;
		getErrTabToggle('TabView','2');	
		tabview_switch('TabView', '2');
		hideAndShowTable("errorDiv");
		document.getElementById('btnTbl').style.display="none";
		return false;
	}
	

	/*}*/
	/*else
	{
		//document.getElementById('in_MinimumTable_13').selectedIndex=0;
		getErrTabToggle('TabView','2');	
		tabview_switch('TabView', '2');
		hideAndShowTable("errorDiv");
		document.getElementById('btnTbl').style.display="none";
		return false;
	}*/



}


function validateMinimumDtls(id)
{
	//resetErrorList();
	var rtnFlag = validateFormFieldOnEvent(id, minimumJson);
	getErrTabToggle('TabView','2');
	if(!rtnFlag)
	{
		tabview_switch('TabView', '2');
		hideAndShowTable("errorDiv");
		document.getElementById('btnTbl').style.display="none";
		return rtnFlag;
	}
	else{
		var amtPaid = removeCommaFrmInput(document.getElementById(id).value);
	document.getElementById(id).value = convertToKenyanShillingFormatVal(amtPaid,true);

	if(document.getElementById('cmbTaxHead').value ==  AGENCY_NOTICE || document.getElementById('cmbTaxHead').value ==  AUCTION_NOTICE){
		validateAmountForAgencyAndAuction(amtPaid);
		return true;
	}
	if(document.getElementById('cmbTaxHead').value ==  AGENCY_REVENUE && document.getElementById('cmbTaxSubHead').value ==  stampDutyObligationId){
		var result=convertToKenyanShillingFormatVal(amtPaid,true);
		document.getElementById(id).value = result;
		document.getElementById('txtTotalAmountPayableOTR').value = result;
		return true;
	}else{
		var result=convertToKenyanShillingFormatVal(amtPaid,true);
		document.getElementById(id).value = result;
		return true;
	}

	}
	
}
function onchangeEstimatedTaxValue()
{
	if(removeCommaFrmInput(document.getElementById('in_MinimumTable_7').value)>0)
	{
		var percentage = getPercentage();
		var amt= Math.round(parseInt(removeCommaFrmInput(document.getElementById('in_MinimumTable_7').value),10)*percentage);
		document.getElementById('in_MinimumTable_5').value= convertToKenyanShillingFormatVal(amt,true);
	}
	else if(removeCommaFrmInput(document.getElementById('in_MinimumTable_7').value)<0)
	{
		document.getElementById('in_MinimumTable_5').value= convertToKenyanShillingFormatVal(0,true);
	}
}

function onchangeGrossTurnover()
{
	// alert("nmefika");
	if(removeCommaFrmInput(document.getElementById('in_MinimumTable_13').value)>0)
	{
		let percentage = 0.01;
		var amt= Math.round(parseInt(removeCommaFrmInput(document.getElementById('in_MinimumTable_13').value),10)*percentage);
		document.getElementById('in_MinimumTable_5').value= convertToKenyanShillingFormatVal(amt,true);
		document.getElementById('in_MinimumTable_7').value=convertToKenyanShillingFormatVal(amt,true);
	}
	else //if(removeCommaFrmInput(document.getElementById('in_MinimumTable_grossTurnover').value)<0)
	{
		document.getElementById('in_MinimumTable_5').value= convertToKenyanShillingFormatVal(0,true);
		document.getElementById('in_MinimumTable_7').value= convertToKenyanShillingFormatVal(0,true);
	}
}

//changes done for CR IT Detachment
function checkForOblig(obj)
{
	var obligId=document.getElementById('hidObligationId').value;
	var taxPeriod =obj.value;
	var yearIndex = taxPeriod.charAt(0);
	taxPeriod = taxPeriod.substring(1,taxPeriod.length);
	if(yearIndex == "P" || yearIndex =="p")
	{
		var taxPeriodArr = taxPeriod.split("-");
		var frmDate = taxPeriodArr[0];
		var toDate = taxPeriodArr[1];

		if(obligId==itResident && document.getElementById('in_MinimumTable_7').value==0)
		{
			FetchObligationDetail.fetchObligationDetail(document.getElementById('hidTaxPayerId').value,itNonResident,frmDate,toDate,null,function(data) {
				if(data != null)
				{	
					document.getElementById('hidPaymentDetailDTOList').value = data;
					var paymentDetailDtlDTOList = data;
					if(paymentDetailDtlDTOList!= null)
					{	
						document.getElementById('in_MinimumTable_7').value =convertToKenyanShillingFormatVal((Math.ceil(paymentDetailDtlDTOList[0].imposedPrincipalAmount)),true); 
						document.getElementById('in_MinimumTable_7').readOnly=true;
						document.getElementById('in_MinimumTable_7').className='readonlyInput form101_textfcurr_width textonlyRight';
						document.getElementById('hidAccMonthForInst').value=paymentDetailDtlDTOList[0].accMonth;
						document.getElementById('hidIsActiveInAgri').value=paymentDetailDtlDTOList[0].isActive;
						onchangeEstimatedTaxValue();
					}
				}

			});
		}
		else if(obligId==itNonResident && document.getElementById('in_MinimumTable_7').value==0)
		{
			FetchObligationDetail.fetchObligationDetail(document.getElementById('hidTaxPayerId').value,itResident,frmDate,toDate,null,function(data) {
				if(data != null)
				{	
					document.getElementById('hidPaymentDetailDTOList').value = data;
					var paymentDetailDtlDTOList = data;
					if(paymentDetailDtlDTOList!= null)
					{	
						document.getElementById('in_MinimumTable_7').value =convertToKenyanShillingFormatVal((Math.ceil(paymentDetailDtlDTOList[0].imposedPrincipalAmount)),true); 
						document.getElementById('in_MinimumTable_7').readOnly=true;
						document.getElementById('in_MinimumTable_7').className='readonlyInput form101_textfcurr_width textonlyRight';
						document.getElementById('hidAccMonthForInst').value=paymentDetailDtlDTOList[0].accMonth;
						document.getElementById('hidIsActiveInAgri').value=paymentDetailDtlDTOList[0].isActive;
						onchangeEstimatedTaxValue();
					}
				}

			});
		}
	}

	else if(yearIndex == "C" || yearIndex =="c")
	{
		var taxPeriodArr = taxPeriod.split("-");
		var frmDate = taxPeriodArr[0];
		var toDate = taxPeriodArr[1];

		if(obligId==itResident && document.getElementById('in_MinimumTable_7').value==0)
		{
			FetchObligationDetail.fetchObligationDetail(document.getElementById('hidTaxPayerId').value,document.getElementById('hidObligationId').value,frmDate,toDate,null,function(data) {
				if(data != null)
				{	
					document.getElementById('hidPaymentDetailDTOList').value = data;
					var paymentDetailDtlDTOList = data;
					if(paymentDetailDtlDTOList!= null)
					{	
						document.getElementById('in_MinimumTable_7').value =convertToKenyanShillingFormatVal((Math.ceil(paymentDetailDtlDTOList[0].imposedPrincipalAmount)),true); 
					document.getElementById('in_MinimumTable_7').readOnly=true;
					document.getElementById('in_MinimumTable_7').className='readonlyInput form101_textfcurr_width textonlyRight';
						document.getElementById('in_MinimumTable_5').value= 0;
						document.getElementById('in_MinimumTable_7').value= '';
						document.getElementById('in_MinimumTable_7').readOnly=false;
						document.getElementById('in_MinimumTable_7').className='form101_textfcurr form101_textfcurr_width textonlyRight';
						document.getElementById('hidAccMonthForInst').value=paymentDetailDtlDTOList[0].accMonth;
						document.getElementById('hidIsActiveInAgri').value=paymentDetailDtlDTOList[0].isActive;
						//onchangeEstimatedTaxValue();
					}
				}

			});
		}

		else if(obligId==itNonResident && document.getElementById('in_MinimumTable_7').value==0)
		{
			FetchObligationDetail.fetchObligationDetail(document.getElementById('hidTaxPayerId').value,document.getElementById('hidObligationId').value,frmDate,toDate,null,function(data) {
				if(data != null)
				{	
					document.getElementById('hidPaymentDetailDTOList').value = data;
					var paymentDetailDtlDTOList = data;
					if(paymentDetailDtlDTOList!= null)
					{	
						document.getElementById('in_MinimumTable_7').value =convertToKenyanShillingFormatVal((Math.ceil(paymentDetailDtlDTOList[0].imposedPrincipalAmount)),true); 
						document.getElementById('in_MinimumTable_7').readOnly=true;
						document.getElementById('in_MinimumTable_7').className='readonlyInput form101_textfcurr_width textonlyRight';
						document.getElementById('in_MinimumTable_5').value= 0;
						document.getElementById('in_MinimumTable_7').value= '';
						document.getElementById('in_MinimumTable_7').readOnly=false;
						document.getElementById('in_MinimumTable_7').className='form101_textfcurr form101_textfcurr_width textonlyRight';
						document.getElementById('hidAccMonthForInst').value=paymentDetailDtlDTOList[0].accMonth;
						document.getElementById('hidIsActiveInAgri').value=paymentDetailDtlDTOList[0].isActive;
						//onchangeEstimatedTaxValue();
					}
				}

			});
		}
	}
	
}
//end